<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>java使用sse</title>
    <link href="/2022/11/08/java%E4%BD%BF%E7%94%A8sse/"/>
    <url>/2022/11/08/java%E4%BD%BF%E7%94%A8sse/</url>
    
    <content type="html"><![CDATA[<p>SSE(Server-Sent Events)比WebSocket更轻量化的服务器主动推送信息的方法</p><span id="more"></span><h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h1><h2 id="1-1-什么是SSE"><a href="#1-1-什么是SSE" class="headerlink" title="1.1 什么是SSE"></a>1.1 什么是SSE</h2><p>SSE(<code>Server Sent Event</code>)，服务器发送事件，顾名思义，也就是客户端可以获取到服务器发送的事件.</p><p>HTTP 协议无法做到服务端主动推送信息给客户端。但是，有一种变通方法，就是服务器向客户端声明，接下来要发送的是流信息(类似于hls)。</p><p>也就是说，发送的不是一次性的数据包，而是一个数据流，会连续不断地发送过来。这时，客户端不会关闭连接(使用长连接)，会一直等着服务器发过来的新的数据流，视频播放(HLS)就是这样的例子。本质上，这种通信就是以流信息的方式，完成一次用时很长的下载。</p><p>SSE 就是利用这种机制，使用流信息向浏览器推送信息。它基于 HTTP 协议，目前除了 IE&#x2F;Edge，其他浏览器都支持。</p><h2 id="1-2-SSE与WebSocket"><a href="#1-2-SSE与WebSocket" class="headerlink" title="1.2 SSE与WebSocket"></a>1.2 SSE与WebSocket</h2><p>SSE 与 WebSocket 作用相似，都是建立浏览器与服务器之间的通信渠道，然后服务器向浏览器推送信息。</p><p>总体来说，WebSocket 更强大和灵活。因为它是全双工通道，可以双向通信；SSE 是单向通道，只能服务器向浏览器发送，因为流信息本质上就是下载。如果浏览器向服务器发送信息，就变成了另一次 HTTP 请求。</p><ul><li><p>SSE 使用 HTTP 协议，现有的服务器软件都支持。WebSocket 是一个独立协议。</p></li><li><p>SSE 属于轻量级，使用简单；WebSocket 协议相对复杂。</p></li><li><p>SSE 默认支持断线重连，WebSocket 需要自己实现。</p></li><li><p>SSE 一般只用来传送文本，二进制数据需要编码后传送，WebSocket 默认支持传送二进制数据。</p></li><li><p>SSE 支持自定义发送的消息类型。</p></li><li><p><strong>sse 是单通道，只能服务端向客户端发消息；而 webscoket 是双通道</strong></p></li></ul><h2 id="1-3-应用场景"><a href="#1-3-应用场景" class="headerlink" title="1.3 应用场景"></a>1.3 应用场景</h2><p>SSE常用于会实时刷新的数据的需求中,比如</p><ul><li>实时显示网站在线人数</li><li>汇率实时显示</li><li>弹窗消息实时通知</li><li>……</li></ul><h1 id="2-实战使用"><a href="#2-实战使用" class="headerlink" title="2. 实战使用"></a>2. 实战使用</h1><p><strong>客户端代码:</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">    <span class="hljs-keyword">var</span> source = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSource</span>(<span class="hljs-string">&quot;http://127.0.0.1:9313/sse/subscribe?id=3&quot;</span>);</span><br><span class="language-javascript">    source.<span class="hljs-property">onopen</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event);</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript">    source.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> data = event.<span class="hljs-property">data</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> origin = event.<span class="hljs-property">origin</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> lastEventId = event.<span class="hljs-property">lastEventId</span>;</span><br><span class="language-javascript">      <span class="hljs-comment">// handle message</span></span><br><span class="language-javascript">      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data)</span><br><span class="language-javascript">    &#125;;</span><br><span class="language-javascript">  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>sse-test<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><strong>服务端代码:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SseTestService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * SSE连接池,&lt;br/&gt;</span><br><span class="hljs-comment">     * SpringBean的作用域默认为单例模式,整个web容器中只会存在一个SseTestService的实例对象,</span><br><span class="hljs-comment">     * 所以可以用该实例对象的属性当做一个SSE连接池,存放不同的SSE连接</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ConcurrentHashMap&lt;String, SseEmitter&gt; sseCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 建立长连接</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> SseEmitter <span class="hljs-title function_">subscribe</span><span class="hljs-params">(String id)</span> &#123;<br>        <span class="hljs-comment">// 超时时间设置为10min(每过10min连接关闭)</span><br>        <span class="hljs-type">SseEmitter</span> <span class="hljs-variable">sseEmitter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SseEmitter</span>(<span class="hljs-number">1000L</span> * <span class="hljs-number">60</span> * <span class="hljs-number">10</span>);<br>        <span class="hljs-comment">// 存入连接池</span><br>        sseCache.put(id, sseEmitter);<br>        sseEmitter.onTimeout(() -&gt; sseCache.remove(id));<br>        <span class="hljs-comment">// 异步请求因任何原因（包括超时和网络错误）完成时的回调</span><br>        sseEmitter.onCompletion(() -&gt; sseCache.remove(id));<br>        <span class="hljs-keyword">return</span> sseEmitter;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 推送数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> content</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">push</span><span class="hljs-params">(String id, String content)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">SseEmitter</span> <span class="hljs-variable">sseEmitter</span> <span class="hljs-operator">=</span> sseCache.get(id);<br>        <span class="hljs-keyword">if</span> (sseEmitter != <span class="hljs-literal">null</span>) &#123;<br>            sseEmitter.send(content);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 主动关闭连接</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">over</span><span class="hljs-params">(String id)</span> &#123;<br>        <span class="hljs-type">SseEmitter</span> <span class="hljs-variable">sseEmitter</span> <span class="hljs-operator">=</span> sseCache.get(id);<br>        <span class="hljs-keyword">if</span> (sseEmitter != <span class="hljs-literal">null</span>) &#123;<br>            sseEmitter.complete();<br>            sseCache.remove(id);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>参考资料:</strong></p><p><a href="https://cloud.tencent.com/developer/article/1620176">https://cloud.tencent.com/developer/article/1620176</a></p><p><a href="https://www.ruanyifeng.com/blog/2017/05/server-sent_events.html">https://www.ruanyifeng.com/blog/2017/05/server-sent_events.html</a></p>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>异步</tag>
      
      <tag>SSE</tag>
      
      <tag>服务端推送</tag>
      
      <tag>半双工</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>javaWeb异步请求</title>
    <link href="/2022/11/07/javaWeb%E5%BC%82%E6%AD%A5%E8%AF%B7%E6%B1%82/"/>
    <url>/2022/11/07/javaWeb%E5%BC%82%E6%AD%A5%E8%AF%B7%E6%B1%82/</url>
    
    <content type="html"><![CDATA[<p>Java Web 中的异步请求</p><span id="more"></span><p><a href="https://mp.weixin.qq.com/s?__biz=MzU3MTAzNTMzMQ==&mid=2247484567&idx=1&sn=de01a82e80c748aa6bb9fde8a51cae5b">文章链接</a></p>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springboot</tag>
      
      <tag>java</tag>
      
      <tag>web</tag>
      
      <tag>异步</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java使用opencv</title>
    <link href="/2022/11/04/Java%E4%BD%BF%E7%94%A8opencv/"/>
    <url>/2022/11/04/Java%E4%BD%BF%E7%94%A8opencv/</url>
    
    <content type="html"><![CDATA[<p>在Java中使用opencv处理图像</p><span id="more"></span><h1 id="1-需求缘由"><a href="#1-需求缘由" class="headerlink" title="1. 需求缘由"></a>1. 需求缘由</h1><p>在写爬虫时,我们有时会使用Selenium自动输入用户名和密码获取登录权限</p><p>但是有的网站会有数字字母验证码,这些验证码十分碍事,只能人工操作手动输入,而且要手动操作的话就无法在无头模式下运行浏览器了.</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/img.png" alt="常见的数字验证码"></p><p>已知的解决方案是获取验证码图片,使用OCR文字识别获取验证码文字内容</p><p>可以使用的OCR有</p><ul><li>百度的OCR接口,每日有使用次数</li><li>Paddle-OCR开源库,搭建自己的OCR服务</li><li>惠普的tesseract-ocr工具</li><li>…..</li></ul><p>百度的免费接口有使用次数,且无法在内网环境中使用,所以并不适用</p><p>由于我们需要识别的内容的字母和数字,惠普的tesseract-ocr工具就很好用</p><p>当我们使用tesseract-ocr工具去识别验证码原图时,由于验证码有很多的干扰线,会导致识别结果有很多错误</p><p>所以我们需要对原始的验证码图片进行图像处理,这时候就需要用上opencv了</p><h1 id="2-在Java中使用opencv"><a href="#2-在Java中使用opencv" class="headerlink" title="2. 在Java中使用opencv"></a>2. 在Java中使用opencv</h1><h2 id="2-1-下载opencv"><a href="#2-1-下载opencv" class="headerlink" title="2.1 下载opencv"></a>2.1 下载opencv</h2><p><a href="https://opencv.org/releases/">下载地址</a></p><p>下载所需的版本</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221104154504385.png" alt="版本选择"></p><p>我电脑是windows,下载的是一个exe安装文件,运行安装后文件目录如下</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221104154753665.png" alt="opencv目录"></p><p>build是已经打包好的文件</p><p>sources是opencv的源码</p><p>我们在build-java中可以看到自己需要的文件,主要是jar包和dll文件</p><h2 id="2-2-引入jar包"><a href="#2-2-引入jar包" class="headerlink" title="2.2 引入jar包"></a>2.2 引入jar包</h2><p>把jar包引入我们的项目中,dll文件也复制到项目目录中</p><h2 id="2-3-使用opencv处理图像"><a href="#2-3-使用opencv处理图像" class="headerlink" title="2.3 使用opencv处理图像"></a>2.3 使用opencv处理图像</h2><p>处理步骤:</p><ol><li>读取原图</li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/img-t.png" alt="img原图"></p><ol start="2"><li>消除色彩,变为黑白图</li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/img2.png" alt="img黑白"></p><ol start="3"><li>灰度二值化</li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/img3.png" alt="img灰度二值化"></p><ol start="4"><li>线消噪</li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/img4.png" alt="img线消噪"></p><ol start="5"><li>灰度反转</li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/img5.png" alt="img灰度反转"></p><p>代码如下:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Test.class.getClassLoader().getResource(<span class="hljs-string">&quot;//&quot;</span>).getPath();<br>    System.load(path+<span class="hljs-string">&quot;opencv/opencv_java455.dll&quot;</span>);<br>    <span class="hljs-comment">// 原图</span><br>    <span class="hljs-type">Mat</span> <span class="hljs-variable">image</span> <span class="hljs-operator">=</span> imread(<span class="hljs-string">&quot;E:\\pic\\img.png&quot;</span>);<br>    System.out.println( <span class="hljs-string">&quot;原图 = &quot;</span> + image.dump() );<br>    <span class="hljs-comment">// 变黑白照片</span><br>    Imgproc.cvtColor(image, image,Imgproc.COLOR_BGR2GRAY);<br>    Imgcodecs.imwrite(<span class="hljs-string">&quot;E:\\pic\\img2-黑白.png&quot;</span>, image);<br>    <span class="hljs-type">Mat</span> <span class="hljs-variable">target3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mat</span>();<br>    <span class="hljs-comment">//灰度二值化,参数(原图,输出,处理灰度值大于200的,最大灰度,阈值类型)</span><br>    Imgproc.threshold(image, target3, <span class="hljs-number">230</span>, <span class="hljs-number">255</span>, Imgproc.THRESH_BINARY );<br>    System.out.println( <span class="hljs-string">&quot;灰度图像二值化 = &quot;</span> + target3.dump() );<br>    <span class="hljs-comment">//写入灰度图像</span><br>    Imgcodecs.imwrite(<span class="hljs-string">&quot;E:\\pic\\img3-灰度二值化.png&quot;</span>, target3);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">width</span> <span class="hljs-operator">=</span> target3.width();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> target3.height();<br>    <span class="hljs-comment">// 消除噪点</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; width-<span class="hljs-number">1</span>; i++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt; height-<span class="hljs-number">1</span>; j++) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-type">double</span>[] doubles = target3.get(j, i);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)doubles[<span class="hljs-number">0</span>];<br>            <span class="hljs-type">double</span>[] doubles1 = target3.get(j-<span class="hljs-number">1</span>, i);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">up</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)doubles1[<span class="hljs-number">0</span>];<br>            <span class="hljs-type">double</span>[] doubles2 = target3.get(j+<span class="hljs-number">1</span>, i);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">down</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)doubles2[<span class="hljs-number">0</span>];<br>            <span class="hljs-type">double</span>[] doubles3 = target3.get(j, i-<span class="hljs-number">1</span>);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)doubles3[<span class="hljs-number">0</span>];<br>            <span class="hljs-type">double</span>[] doubles4 = target3.get(j, i+<span class="hljs-number">1</span>);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)doubles4[<span class="hljs-number">0</span>];<br>            <span class="hljs-comment">// 该像素点的上下左右是不是空白的</span><br>            <span class="hljs-keyword">if</span> (up &gt; <span class="hljs-number">250</span>)&#123;<br>                count += <span class="hljs-number">1</span>;<br>            &#125;<span class="hljs-keyword">if</span> (down&gt; <span class="hljs-number">250</span>)&#123;<br>                count += <span class="hljs-number">1</span>;<br>            &#125;<span class="hljs-keyword">if</span> (left &gt; <span class="hljs-number">250</span>)&#123;<br>                count += <span class="hljs-number">1</span>;<br>            &#125;<span class="hljs-keyword">if</span> (right &gt; <span class="hljs-number">250</span>)&#123;<br>                count += <span class="hljs-number">1</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">2</span>)&#123;<br>                <span class="hljs-type">double</span>[] value = &#123;<span class="hljs-number">255.0</span>&#125;;<br>                target3.put(j,i,value);<br>            &#125;<br>        &#125;<br>    &#125;<br>    Imgcodecs.imwrite(<span class="hljs-string">&quot;E:\\pic\\img4-线消噪.png&quot;</span>, target3);<br>    <span class="hljs-comment">// 灰度反转</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; width; i++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; j &lt; height; j++) &#123;<br>            <span class="hljs-type">double</span>[] doubles = target3.get(j, i);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)doubles[<span class="hljs-number">0</span>];<br>            <span class="hljs-keyword">if</span>(num == <span class="hljs-number">255</span>)&#123;<br>                <span class="hljs-type">double</span>[] value = &#123;<span class="hljs-number">0.0</span>&#125;;<br>                target3.put(j,i,value);<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (num == <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-type">double</span>[] value = &#123;<span class="hljs-number">255.0</span>&#125;;<br>                target3.put(j,i,value);<br>            &#125;<br>        &#125;<br>    &#125;<br>    Imgcodecs.imwrite(<span class="hljs-string">&quot;E:\\pic\\img5-灰度反转.png&quot;</span>, target3);<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>opencv</tag>
      
      <tag>图像处理</tag>
      
      <tag>图像识别</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nexus搭建yum私服</title>
    <link href="/2022/10/28/nexus/"/>
    <url>/2022/10/28/nexus/</url>
    
    <content type="html"><![CDATA[<p>使用Nexus在Windows搭建yum私服,供内网环境的Centos使用</p><span id="more"></span><h1 id="1-问题"><a href="#1-问题" class="headerlink" title="1. 问题"></a>1. 问题</h1><p>在生产环境中,很多Centos服务器都部署在内网环境中,如果需要安装软件只能手动编译源码或者下载rpm包进行安装.</p><p>在使用rpm包安装时,经常会出现缺失依赖的情况,这时候我们需要自己下载依赖,不仅繁琐,还经常出现依赖包等级过低,需要升级才能安装的情况.</p><p>这时候我们不禁怀念有外网时可以<code>yum install xxx</code>的舒服</p><h1 id="2-解决思路"><a href="#2-解决思路" class="headerlink" title="2. 解决思路"></a>2. 解决思路</h1><h2 id="2-1-搭建yum私服"><a href="#2-1-搭建yum私服" class="headerlink" title="2.1 搭建yum私服"></a>2.1 搭建yum私服</h2><p>我们自用的Centos经常会添加阿里云,腾讯云的yum镜像服务.那么自然,也可以添加我们自己的yum镜像私服</p><p>如果我们在内网的另一台电脑部署一个yum私服,然后在centos服务器中添加我们的yum私服地址.就可以通过<code>yum install xxx</code>从私服安装软件并自动解决依赖问题</p><h2 id="2-2-上传rpm包至yum私服中"><a href="#2-2-上传rpm包至yum私服中" class="headerlink" title="2.2 上传rpm包至yum私服中"></a>2.2 上传rpm包至yum私服中</h2><p>为了能让内网中的centos访问yum私服,我们是在内网的另一台电脑(也可以是centos服务器本身)搭建的yum私服,这台电脑同样是没有外网的,那yum私服中所需要的rpm包从哪来呢?</p><p>虽然内网电脑无法上网,但是作为程序员肯定是有自己的笔记本的呀,自己的笔记本肯定是能使用外网的.</p><p>在自己笔记本的centos虚拟机下载软件所需所有依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">repotrack firefox -p /opt/firefox-all-dep-test<br><span class="hljs-meta prompt_"># </span><span class="language-bash">repotrack 可以不止可以下载软件包和软件依赖,还能下载依赖的依赖</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">-p 指定下载位置</span><br></code></pre></td></tr></table></figure><p>下载后复制到内网电脑中(怎么复制?当然是ftp把虚拟机的文件移到宿主机上,然后u盘复制呀!), 上传至内网安装的yum私服中</p><p>上传方式如下</p><ul><li><strong>windows下使用cmd</strong></li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-keyword">for</span> %i <span class="hljs-keyword">in</span> (*) <span class="hljs-keyword">do</span> curl -v --user <span class="hljs-string">&quot;admin:123&quot;</span> --upload-file %i http://localhost:9797/repository/local-yum/7/os/x86_64/Packages/%i<br><span class="hljs-comment"># 遍历此文件夹下的所有文件,上传至我们的yum私服中</span><br></code></pre></td></tr></table></figure><ul><li><strong>linux下使用bash</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">for i in `ls`;do curl -v --user &#x27;admin:123&#x27; --upload-file $i http://172.16.1.100:9797/repository/local-yum/7/os/x86_64/Packages/$i;done<br><span class="hljs-meta prompt_"># </span><span class="language-bash">遍历此文件夹下的所有文件,上传至我们的yum私服中</span><br></code></pre></td></tr></table></figure><hr><h1 id="3-实操"><a href="#3-实操" class="headerlink" title="3. 实操"></a>3. 实操</h1><h2 id="3-1-安装-Nexus3"><a href="#3-1-安装-Nexus3" class="headerlink" title="3.1 安装 Nexus3"></a>3.1 安装 Nexus3</h2><ul><li><strong>下载Nexus</strong></li></ul><p>[Nexus3官方下载地址]<a href="https://help.sonatype.com/repomanager3/product-information/download/download-archives---repository-manager-3">https://help.sonatype.com/repomanager3/product-information/download/download-archives---repository-manager-3</a></p><p>这里我下载的windows</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028135451011.png" alt="image-20221028135451011"></p><ul><li><strong>解压</strong></li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028135543204.png" alt="image-20221028135543204"></p><p>在nexus-3.42.0-01文件夹中,有一个<code>etc</code>文件夹</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028135633908.png" alt="image-20221028135633908"></p><p><code>etc</code>文件夹内有<code>nexus-default.properties</code>配置文件</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028135725361.png" alt="image-20221028135725361"></p><p>默认端口是8081,这里改成自己的想设置的端口</p><ul><li><strong>安装nexus服务</strong></li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028140831163.png" alt="image-20221028140831163"></p><p>管理员模式打开cmd,进入bin目录,输入以下命令安装nexus</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nexus.exe /install nexus<br></code></pre></td></tr></table></figure><ul><li><strong>启动nexus服务</strong></li></ul><p>管理员模式打开cmd,进入bin目录,输入以下命令启动nexus服务</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">nexus.exe /<span class="hljs-built_in">run</span><br></code></pre></td></tr></table></figure><p>看见以下文字表示服务启动成功</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028141105901.png" alt="image-20221028141105901"></p><ul><li><strong>访问页面</strong></li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/08f4c17365424e60a9077bd164905a28.png" alt="nexus登录"></p><p>右上角Sign in 登录,账号为admin,密码在弹框中有提示</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/9e4c25926a6140f8a083ecec95e8364e.png" alt="nexus密码"></p><h2 id="3-2-搭建yum仓库"><a href="#3-2-搭建yum仓库" class="headerlink" title="3.2 搭建yum仓库"></a>3.2 搭建yum仓库</h2><ul><li><strong>新建blob存储</strong></li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028142109308.png" alt="进入页面"></p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028142144770.png" alt="新建blob"></p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028142208477.png" alt="image-20221028142208477"></p><ul><li><strong>创建hosts类型的yum仓库</strong></li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028142916068.png" alt="新建yum库"></p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028142936464.png" alt="选择hosts类型的yum"></p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028143031491.png" alt="输入信息"></p><ul><li><strong>创建group类型的yum仓库</strong></li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028143211399.png" alt="group类型yum仓库"></p><h2 id="3-3-Centos创建yum源"><a href="#3-3-Centos创建yum源" class="headerlink" title="3.3 Centos创建yum源"></a>3.3 Centos创建yum源</h2><ul><li><strong>进入如下目录</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd /etc/yum.repos.d/<br></code></pre></td></tr></table></figure><ul><li><strong>创建repo文件</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim nexus.repo<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs repo">[nexus]<br>name=nexus-repo<br>baseurl=http://172.16.1.100:9797/repository/group-yum/7/os/x86_64<br>enabled=1<br>gpgcheck=0<br></code></pre></td></tr></table></figure><ul><li><strong>查看源</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum repolist<br></code></pre></td></tr></table></figure><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028151530415.png" alt="image-20221028151530415"></p><h2 id="3-4-上传依赖至yum私服"><a href="#3-4-上传依赖至yum私服" class="headerlink" title="3.4 上传依赖至yum私服"></a>3.4 上传依赖至yum私服</h2><ul><li><strong>在可访问外网的centos虚拟机下 下载软件和依赖</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">repotrack firefox -p /opt/firefox-all-dep-test<br><span class="hljs-meta prompt_"># </span><span class="language-bash">repotrack 可以不止可以下载软件包和软件依赖,还能下载依赖的依赖</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">-p 指定下载位置</span><br></code></pre></td></tr></table></figure><ul><li><p><strong>使用ftp工具将下载的文件复制的宿主机</strong></p></li><li><p><strong>在宿主机执行命令上传软件和依赖</strong></p></li></ul><p>windows下使用cmd</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-keyword">for</span> %i <span class="hljs-keyword">in</span> (*) <span class="hljs-keyword">do</span> curl -v --user <span class="hljs-string">&quot;admin:123&quot;</span> --upload-file %i http://localhost:9797/repository/local-yum/7/os/x86_64/Packages/%i<br><span class="hljs-comment"># 遍历此文件夹下的所有文件,上传至我们的yum私服中</span><br></code></pre></td></tr></table></figure><p>linux下使用bash</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">for i in `ls`;do curl -v --user &#x27;admin:123&#x27; --upload-file $i http://172.16.1.100:9797/repository/local-yum/7/os/x86_64/Packages/$i;done<br><span class="hljs-meta prompt_"># </span><span class="language-bash">遍历此文件夹下的所有文件,上传至我们的yum私服中</span><br></code></pre></td></tr></table></figure><p>可以看到成功上传</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028152236774.png" alt="image-20221028152236774"></p><h2 id="3-5-centos使用yum下载软件"><a href="#3-5-centos使用yum下载软件" class="headerlink" title="3.5 centos使用yum下载软件"></a>3.5 centos使用yum下载软件</h2><ul><li><strong>清空缓存</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum clean all<br></code></pre></td></tr></table></figure><ul><li><strong>缓存包信息</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum makecache<br></code></pre></td></tr></table></figure><ul><li><strong>下载</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install firefox --enablerepo=nexus-local<br><span class="hljs-meta prompt_"># </span><span class="language-bash">--enablerepo 使用指定的yum仓库下载</span><br></code></pre></td></tr></table></figure><p>忘记镜像名使用如下命令查看镜像源</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum repolist<br></code></pre></td></tr></table></figure><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028152630034.png" alt="image-20221028152630034"></p>]]></content>
    
    
    <categories>
      
      <category>nexus</category>
      
    </categories>
    
    
    <tags>
      
      <tag>内网</tag>
      
      <tag>linux</tag>
      
      <tag>yum</tag>
      
      <tag>nexus</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Maven依赖导出</title>
    <link href="/2022/10/28/Maven%E4%BE%9D%E8%B5%96%E5%AF%BC%E5%87%BA/"/>
    <url>/2022/10/28/Maven%E4%BE%9D%E8%B5%96%E5%AF%BC%E5%87%BA/</url>
    
    <content type="html"><![CDATA[<p>使用mvn命令导出maven工程依赖的所有jar包</p><span id="more"></span><h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h1><p>在没有网络的时候,我们无法使用maven管理项目依赖.这是如果需要搭建springboot项目的话,就只能引入jar包</p><p>但是springboot依赖的jar包这么多,怎么知道要引入哪些呢</p><h1 id="2-导出jar包"><a href="#2-导出jar包" class="headerlink" title="2. 导出jar包"></a>2. 导出jar包</h1><p>可以先在有网络环境下搭建maven项目,pom配置好依赖后,使用以下命令将依赖的jar包导出本地的lib文件夹下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mvn dependency:copy-dependencies -DoutputDirectory=lib <br><span class="hljs-meta prompt_"># </span><span class="language-bash">lib文件夹可更改为其它文件夹</span><br></code></pre></td></tr></table></figure><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028103307859.png" alt="image-20221028103307859"></p><h1 id="3-导入jar包"><a href="#3-导入jar包" class="headerlink" title="3. 导入jar包"></a>3. 导入jar包</h1><ul><li><p>idea新建个普通的Java项目</p></li><li><p>点击Project Structure</p></li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028103457001.png" alt="image-20221028103457001"></p><ul><li>选择jar包</li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028103716902.png" alt="image-20221028103716902"></p><ul><li>引入lib</li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028103814383.png" alt="image-20221028103814383"></p><ul><li>最后根据springboot的文件目录创建java和resources目录,分别右键java和resources目录<code>Mark Directoty As</code></li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221028104204052.png" alt="image-20221028104204052"></p>]]></content>
    
    
    <categories>
      
      <category>maven</category>
      
    </categories>
    
    
    <tags>
      
      <tag>maven</tag>
      
      <tag>mvn</tag>
      
      <tag>内网</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>java11-java17新特性</title>
    <link href="/2022/10/12/java%E6%96%B0%E7%89%B9%E6%80%A7/"/>
    <url>/2022/10/12/java%E6%96%B0%E7%89%B9%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<p>Springboot宣布最新的3.0最低只支持Java 17版本,大部分开发者由于一直使用Java 8,并不了解Java 11到Java17更新了什么,<br>本文将介绍Java11到Java17的更新内容</p><span id="more"></span><p>文章转载来源:民工哥技术之路 <a href="https://mp.weixin.qq.com/s/SVleHYFQeePNT7q67UoL4Q">https://mp.weixin.qq.com/s/SVleHYFQeePNT7q67UoL4Q</a></p><h1 id="Java-11-特性详解"><a href="#Java-11-特性详解" class="headerlink" title="Java 11 特性详解"></a>Java 11 特性详解</h1><h2 id="基于嵌套的访问控制"><a href="#基于嵌套的访问控制" class="headerlink" title="基于嵌套的访问控制"></a>基于嵌套的访问控制</h2><p>与 Java 语言中现有的嵌套类型概念一致, 嵌套访问控制是一种控制上下文访问的策略，允许逻辑上属于同一代码实体，但被编译之后分为多个分散的 class 文件的类，无需编译器额外的创建可扩展的桥接访问方法，即可访问彼此的私有成员，并且这种改进是在 Java 字节码级别的。</p><p>在 Java 11 之前的版本中，编译之后的 class 文件中通过 InnerClasses 和 Enclosing Method 两种属性来帮助编译器确认源码的嵌套关系，每一个嵌套的类会编译到自己所在的 class 文件中，不同类的文件通过上面介绍的两种属性的来相互连接。这两种属性对于编译器确定相互之间的嵌套关系已经足够了，但是并不适用于访问控制。这里大家可以写一段包含内部类的代码，并将其编译成 class 文件，然后通过 javap 命令行来分析，碍于篇幅，这里就不展开讨论了。</p><p>Java 11 中引入了两个新的属性：一个叫做 NestMembers 的属性，用于标识其它已知的静态 nest 成员；另外一个是每个 nest 成员都包含的 NestHost 属性，用于标识出它的 nest 宿主类。</p><h2 id="标准-HTTP-Client-升级"><a href="#标准-HTTP-Client-升级" class="headerlink" title="标准 HTTP Client 升级"></a>标准 HTTP Client 升级</h2><p>Java 11 对 Java 9 中引入并在 Java 10 中进行了更新的 Http Client API 进行了标准化，在前两个版本中进行孵化的同时，Http Client 几乎被完全重写，并且现在完全支持异步非阻塞。</p><p>新版 Java 中，Http Client 的包名由 jdk.incubator.http 改为 java.net.http，该 API 通过 CompleteableFutures 提供非阻塞请求和响应语义，可以联合使用以触发相应的动作，并且 RX Flo w 的概念也在 Java 11 中得到了实现。现在，在用户层请求发布者和响应发布者与底层套接字之间追踪数据流更容易了。这降低了复杂性，并最大程度上提高了 HTTP&#x2F;1 和 HTTP&#x2F;2 之间的重用的可能性。</p><p>Java 11 中的新 Http Client API，提供了对 HTTP&#x2F;2 等业界前沿标准的支持，同时也向下兼容 HTTP&#x2F;1.1，精简而又友好的 API 接口，与主流开源 API（如：Apache HttpClient、Jetty、OkHttp 等）类似甚至拥有更高的性能。与此同时它是 Java 在 Reactive-Stream 方面的第一个生产实践，其中广泛使用了 Java Flow API，终于让 Java 标准 HTTP 类库在扩展能力等方面，满足了现代互联网的需求，是一个难得的现代 Http&#x2F;2 Client API 标准的实现，Java 工程师终于可以摆脱老旧的 HttpURLConnection 了。下面模拟 Http GET 请求并打印返回内容：</p><p>清单 1. GET 请求示例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">HttpClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> HttpClient.newHttpClient();<br><span class="hljs-type">HttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> HttpRequest.newBuilder()<br>      .uri(URI.create(<span class="hljs-string">&quot;http://openjdk.java.net/&quot;</span>))<br>      .build();<br>client.sendAsync(request, BodyHandlers.ofString())<br>      .thenApply(HttpResponse::body)<br>      .thenAccept(System.out::println)<br>      .join();<br></code></pre></td></tr></table></figure><h2 id="Epsilon：低开销垃圾回收器"><a href="#Epsilon：低开销垃圾回收器" class="headerlink" title="Epsilon：低开销垃圾回收器"></a>Epsilon：低开销垃圾回收器</h2><p>Epsilon 垃圾回收器的目标是开发一个控制内存分配，但是不执行任何实际的垃圾回收工作。它提供一个完全消极的 GC 实现，分配有限的内存资源，最大限度的降低内存占用和内存吞吐延迟时间。</p><p>Java 版本中已经包含了一系列的高度可配置化的 GC 实现。各种不同的垃圾回收器可以面对各种情况。但是有些时候使用一种独特的实现，而不是将其堆积在其他 GC 实现上将会是事情变得更加简单。</p><p>下面是 no-op GC 的几个使用场景：</p><ul><li><strong>性能测试</strong>：什么都不执行的 GC 非常适合用于 GC 的差异性分析。no-op （无操作）GC 可以用于过滤掉 GC 诱发的性能损耗，比如 GC 线程的调度，GC 屏障的消耗，GC 周期的不合适触发，内存位置变化等。此外有些延迟者不是由于 GC 引起的，比如 scheduling hiccups, compiler transition hiccups，所以去除 GC 引发的延迟有助于统计这些延迟。</li><li><strong>内存压力测试</strong>：在测试 Java 代码时，确定分配内存的阈值有助于设置内存压力常量值。这时 no-op 就很有用，它可以简单地接受一个分配的内存分配上限，当内存超限时就失败。例如：测试需要分配小于 1G 的内存，就使用-Xmx1g 参数来配置 no-op GC，然后当内存耗尽的时候就直接 crash。</li><li><strong>VM 接口测试</strong>：以 VM 开发视角，有一个简单的 GC 实现，有助于理解 VM-GC 的最小接口实现。它也用于证明 VM-GC 接口的健全性。</li><li><strong>极度短暂 job 任务</strong>：一个短声明周期的 job 任务可能会依赖快速退出来释放资源，这个时候接收 GC 周期来清理 heap 其实是在浪费时间，因为 heap 会在退出时清理。并且 GC 周期可能会占用一会时间，因为它依赖 heap 上的数据量。延迟改进：对那些极端延迟敏感的应用，开发者十分清楚内存占用，或者是几乎没有垃圾回收的应用，此时耗时较长的 GC 周期将会是一件坏事。</li><li><strong>吞吐改进</strong>：即便对那些无需内存分配的工作，选择一个 GC 意味着选择了一系列的 GC 屏障，所有的 OpenJDK GC 都是分代的，所以他们至少会有一个写屏障。避免这些屏障可以带来一点点的吞吐量提升。</li></ul><p>Epsilon 垃圾回收器和其他 OpenJDK 的垃圾回收器一样，可以通过参数 <code>-XX:+UseEpsilonGC</code> 开启。</p><p>Epsilon 线性分配单个连续内存块。可复用现存 VM 代码中的 TLAB 部分的分配功能。非 TLAB 分配也是同一段代码，因为在此方案中，分配 TLAB 和分配大对象只有一点点的不同。Epsilon 用到的 barrier 是空的(或者说是无操作的)。因为该 GC</p><p>执行任何的 GC 周期，不用关系对象图，对象标记，对象复制等。引进一种新的 barrier-set 实现可能是该 GC 对 JVM 最大的变化。</p><h2 id="简化启动单个源代码文件的方法"><a href="#简化启动单个源代码文件的方法" class="headerlink" title="简化启动单个源代码文件的方法"></a>简化启动单个源代码文件的方法</h2><p>Java 11 版本中最令人兴奋的功能之一是增强 Java 启动器，使之能够运行单一文件的 Java 源代码。此功能允许使用 Java 解释器直接执行 Java 源代码。源代码在内存中编译，然后由解释器执行。唯一的约束在于所有相关的类必须定义在同一个 Java 文件中。</p><p>此功能对于开始学习 Java 并希望尝试简单程序的人特别有用，并且能与 jshell 一起使用，将成为任何初学者学习语言的一个很好的工具集。不仅初学者会受益，专业人员还可以利用这些工具来探索新的语言更改或尝试未知的 API。</p><p>如今单文件程序在编写小实用程序时很常见，特别是脚本语言领域。从中开发者可以省去用 Java 编译程序等不必要工作，以及减少新手的入门障碍。在基于 Java 10 的程序实现中可以通过三种方式启动：</p><ul><li>作为 * .class 文件</li><li>作为 * .jar 文件中的主类</li><li>作为模块中的主类</li></ul><p>而在最新的 Java 11 中新增了一个启动方式，即可以在源代码中声明类，例如：如果名为 HelloWorld.java 的文件包含一个名为 hello.World 的类，那么该命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">java HelloWorld.java</span><br></code></pre></td></tr></table></figure><p>也等同于：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">javac HelloWorld.java</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">java -<span class="hljs-built_in">cp</span> . hello.World</span><br></code></pre></td></tr></table></figure><h2 id="用于-Lambda-参数的局部变量语法"><a href="#用于-Lambda-参数的局部变量语法" class="headerlink" title="用于 Lambda 参数的局部变量语法"></a>用于 Lambda 参数的局部变量语法</h2><p>在 Lambda 表达式中使用局部变量类型推断是 Java 11 引入的唯一与语言相关的特性，这一节，我们将探索这一新特性。</p><p>从 Java 10 开始，便引入了局部变量类型推断这一关键特性。类型推断允许使用关键字 var 作为局部变量的类型而不是实际类型，编译器根据分配给变量的值推断出类型。这一改进简化了代码编写、节省了开发者的工作时间，因为不再需要显式声明局部变量的类型，而是可以使用关键字 var，且不会使源代码过于复杂。</p><p>可以使用关键字 var 声明局部变量，如下所示：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">var</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Hello Java 11&quot;</span>;<br>System.out.println(s);<br></code></pre></td></tr></table></figure><p>但是在 Java 10 中，还有下面几个限制：</p><ul><li>只能用于局部变量上</li><li>声明时必须初始化</li><li>不能用作方法参数</li><li>不能在 Lambda 表达式中使用</li></ul><p>Java 11 与 Java 10 的不同之处在于允许开发者在 Lambda 表达式中使用 var 进行参数声明。乍一看，这一举措似乎有点多余，因为在写代码过程中可以省略 Lambda 参数的类型，并通过类型推断确定它们。但是，添加上类型定义同时使用 @Nonnull 和 @Nullable 等类型注释还是很有用的，既能保持与局部变量的一致写法，也不丢失代码简洁。</p><p>Lambda 表达式使用隐式类型定义，它形参的所有类型全部靠推断出来的。隐式类型 Lambda 表达式如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">(x, y) -&gt; x.process(y)<br></code></pre></td></tr></table></figure><p>Java 10 为局部变量提供隐式定义写法如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">var</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Foo</span>();<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x : xs) &#123; ... &#125;<br><span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> ...) &#123; ... &#125; <span class="hljs-keyword">catch</span> ...<br></code></pre></td></tr></table></figure><p>为了 Lambda 类型表达式中正式参数定义的语法与局部变量定义语法的不一致，且为了保持与其他局部变量用法上的一致性，希望能够使用关键字 var 隐式定义 Lambda 表达式的形参：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">(<span class="hljs-keyword">var</span> x, <span class="hljs-keyword">var</span> y) -&gt; x.process(y)<br></code></pre></td></tr></table></figure><p>于是在 Java 11 中将局部变量和 Lambda 表达式的用法进行了统一，并且可以将注释应用于局部变量和 Lambda 表达式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Nonnull</span> <span class="hljs-type">var</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Foo</span>();<br>(<span class="hljs-meta">@Nonnull</span> <span class="hljs-keyword">var</span> x, <span class="hljs-meta">@Nullable</span> <span class="hljs-keyword">var</span> y) -&gt; x.process(y)<br></code></pre></td></tr></table></figure><h2 id="低开销的-Heap-Profiling"><a href="#低开销的-Heap-Profiling" class="headerlink" title="低开销的 Heap Profiling"></a>低开销的 Heap Profiling</h2><p>Java 11 中提供一种低开销的 Java 堆分配采样方法，能够得到堆分配的 Java 对象信息，并且能够通过 JVMTI 访问堆信息。</p><p>引入这个低开销内存分析工具是为了达到如下目的：</p><ul><li>足够低的开销，可以默认且一直开启</li><li>能通过定义好的程序接口访问</li><li>能够对所有堆分配区域进行采样</li><li>能给出正在和未被使用的 Java 对象信息</li></ul><p>对用户来说，了解它们堆里的内存分布是非常重要的，特别是遇到生产环境中出现的高 CPU、高内存占用率的情况。目前有一些已经开源的工具，允许用户分析应用程序中的堆使用情况，比如：Java Flight Recorder、jmap、YourKit 以及 VisualVM tools.。但是这些工具都有一个明显的不足之处：无法得到对象的分配位置，headp dump 以及 heap histogram 中都没有包含对象分配的具体信息，但是这些信息对于调试内存问题至关重要，因为它能够告诉开发人员他们的代码中发生的高内存分配的确切位置，并根据实际源码来分析具体问题，这也是 Java 11 中引入这种低开销堆分配采样方法的原因。</p><h2 id="支持-TLS-1-3-协议"><a href="#支持-TLS-1-3-协议" class="headerlink" title="支持 TLS 1.3 协议"></a>支持 TLS 1.3 协议</h2><p>Java 11 中包含了传输层安全性（TLS）1.3 规范（RFC 8446）的实现，替换了之前版本中包含的 TLS，包括 TLS 1.2，同时还改进了其他 TLS 功能，例如 OCSP 装订扩展（RFC 6066，RFC 6961），以及会话散列和扩展主密钥扩展（RFC 7627），在安全性和性能方面也做了很多提升。</p><p>新版本中包含了 Java 安全套接字扩展（JSSE）提供 SSL，TLS 和 DTLS 协议的框架和 Java 实现。目前，JSSE API 和 JDK 实现支持 SSL 3.0，TLS 1.0，TLS 1.1，TLS 1.2，DTLS 1.0 和 DTLS 1.2。</p><p>同时 Java 11 版本中实现的 TLS 1.3，重新定义了以下新标准算法名称：</p><ul><li>TLS 协议版本名称：TLSv1.3</li><li>SSLContext 算法名称：TLSv1.3</li><li>TLS 1.3 的 TLS 密码套件名称：TLS_AES_128_GCM_SHA256，TLS_AES_256_GCM_SHA384</li><li>用于 X509KeyManager 的 keyType：RSASSA-PSS</li><li>用于 X509TrustManager 的 authType：RSASSA-PSS</li></ul><p>还为 TLS 1.3 添加了一个新的安全属性 jdk.tls.keyLimits。当处理了特定算法的指定数据量时，触发握手后，密钥和 IV 更新以导出新密钥。还添加了一个新的系统属性 jdk.tls.server.protocols，用于在 SunJSSE 提供程序的服务器端配置默认启用的协议套件。</p><p>之前版本中使用的 KRB5 密码套件实现已从 Java 11 中删除，因为该算法已不再安全。同时注意，TLS 1.3 与以前的版本不直接兼容。</p><p>升级到 TLS 1.3 之前，需要考虑如下几个兼容性问题：</p><ul><li>TLS 1.3 使用半关闭策略，而 TLS 1.2 以及之前版本使用双工关闭策略，对于依赖于双工关闭策略的应用程序，升级到 TLS 1.3 时可能存在兼容性问题。</li><li>TLS 1.3 使用预定义的签名算法进行证书身份验证，但实际场景中应用程序可能会使用不被支持的签名算法。</li><li>TLS 1.3 再支持 DSA 签名算法，如果在服务器端配置为仅使用 DSA 证书，则无法升级到 TLS 1.3。</li><li>TLS 1.3 支持的加密套件与 TLS 1.2 和早期版本不同，若应用程序硬编码了加密算法单元，则在升级的过程中需要修改相应代码才能升级使用 TLS 1.3。</li><li>TLS 1.3 版本的 session 用行为及秘钥更新行为与 1.2 及之前的版本不同，若应用依赖于 TLS 协议的握手过程细节，则需要注意。</li></ul><h2 id="ZGC：可伸缩低延迟垃圾收集器"><a href="#ZGC：可伸缩低延迟垃圾收集器" class="headerlink" title="ZGC：可伸缩低延迟垃圾收集器"></a>ZGC：可伸缩低延迟垃圾收集器</h2><p>ZGC 即 Z Garbage Collector（垃圾收集器或垃圾回收器），这应该是 Java 11 中最为瞩目的特性，没有之一。ZGC 是一个可伸缩的、低延迟的垃圾收集器，主要为了满足如下目标进行设计：</p><ul><li>GC 停顿时间不超过 10ms</li><li>即能处理几百 MB 的小堆，也能处理几个 TB 的大堆</li><li>应用吞吐能力不会下降超过 15%（与 G1 回收算法相比）</li><li>方便在此基础上引入新的 GC 特性和利用 colord</li><li>针以及 Load barriers 优化奠定基础</li><li>当前只支持 Linux&#x2F;x64 位平台 停顿时间在 10ms 以下，10ms 其实是一个很保守的数据，即便是 10ms 这个数据，也是 GC 调优几乎达不到的极值。根据 SPECjbb 2015 的基准测试，128G 的大堆下最大停顿时间才 1.68ms，远低于 10ms，和 G1 算法相比，改进非常明显。</li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/640" alt="ZGC"></p><p>本图片引用自：The Z Garbage Collector – An Introduction</p><p>不过目前 ZGC 还处于实验阶段，目前只在 Linux&#x2F;x64 上可用，如果有足够的需求，将来可能会增加对其他平台的支持。同时作为实验性功能的 ZGC 将不会出现在 JDK 构建中，除非在编译时使用 configure 参数：<code>--with-jvm-features=zgc</code> 显式启用。</p><p>在实验阶段，编译完成之后，已经迫不及待的想试试 ZGC，需要配置以下 JVM 参数，才能使用 ZGC，具体启动 ZGC 参数如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">-XX：+ UnlockExperimentalVMOptions -XX：+ UseZGC -Xmx10g<br></code></pre></td></tr></table></figure><p>其中参数：-Xmx 是 ZGC 收集器中最重要的调优选项，大大解决了程序员在 JVM 参数调优上的困扰。ZGC 是一个并发收集器，必须要设置一个最大堆的大小，应用需要多大的堆，主要有下面几个考量：</p><ul><li>对象的分配速率，要保证在 GC 的时候，堆中有足够的内存分配新对象。</li><li>一般来说，给 ZGC 的内存越多越好，但是也不能浪费内存，所以要找到一个平衡。</li></ul><h2 id="飞行记录器"><a href="#飞行记录器" class="headerlink" title="飞行记录器"></a>飞行记录器</h2><p>飞行记录器之前是商业版 JDK 的一项分析工具，但在 Java 11 中，其代码被包含到公开代码库中，这样所有人都能使用该功能了。</p><p>Java 语言中的飞行记录器类似飞机上的黑盒子，是一种低开销的事件信息收集框架，主要用于对应用程序和 JVM 进行故障检查、分析。飞行记录器记录的主要数据源于应用程序、JVM 和 OS，这些事件信息保存在单独的事件记录文件中，故障发生后，能够从事件记录文件中提取出有用信息对故障进行分析。</p><p>启用飞行记录器参数如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">-XX:StartFlightRecording<br></code></pre></td></tr></table></figure><p>也可以使用 bin&#x2F;jcmd 工具启动和配置飞行记录器：</p><p>清单 2. 飞行记录器启动、配置参数示例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">jcmd &lt;pid&gt; JFR.start</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">jcmd &lt;pid&gt; JFR.dump filename=recording.jfr</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">jcmd &lt;pid&gt; JFR.stop</span><br></code></pre></td></tr></table></figure><p><strong>JFR 使用测试</strong>：</p><p>清单 3. JFR 使用示例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlightRecorderTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Event</span> &#123;<br>    <span class="hljs-meta">@Label(&quot;Hello World&quot;)</span><br>    <span class="hljs-meta">@Description(&quot;Helps the programmer getting started&quot;)</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloWorld</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Event</span> &#123;<br>        <span class="hljs-meta">@Label(&quot;Message&quot;)</span><br>        String message;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">HelloWorld</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HelloWorld</span>();<br>        event.message = <span class="hljs-string">&quot;hello, world!&quot;</span>;<br>        event.commit();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在运行时加上如下参数：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">java -XX:StartFlightRecording=duration=1s, filename=recording.jfr<br></code></pre></td></tr></table></figure><p>下面读取上一步中生成的 JFR 文件：recording.jfr</p><p>清单 4. 飞行记录器分析示例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readRecordFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(<span class="hljs-string">&quot;D:\\ java \\recording.jfr&quot;</span>);<br>    <span class="hljs-keyword">final</span> List&lt;RecordedEvent&gt; recordedEvents = RecordingFile.readAllEvents(path);<br>    <span class="hljs-keyword">for</span> (RecordedEvent event : recordedEvents) &#123;<br>        System.out.println(event.getStartTime() + <span class="hljs-string">&quot;,&quot;</span> + event.getValue(<span class="hljs-string">&quot;message&quot;</span>));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="动态类文件常量"><a href="#动态类文件常量" class="headerlink" title="动态类文件常量"></a>动态类文件常量</h2><p>为了使 JVM 对动态语言更具吸引力，Java 的第七个版本已将 invokedynamic 引入其指令集。</p><p>不过 Java 开发人员通常不会注意到此功能，因为它隐藏在 Java 字节代码中。通过使用 invokedynamic，可以延迟方法调用的绑定，直到第一次调用。例如，Java 语言使用该技术来实现 Lambda 表达式，这些表达式仅在首次使用时才显示出来。这样做，invokedynamic 已经演变成一种必不可少的语言功能。</p><p>Java 11 引入了类似的机制，扩展了 Java 文件格式，以支持新的常量池：CONSTANT_Dynamic，它在初始化的时候，像 invokedynamic 指令生成代理方法一样，委托给 bootstrap 方法进行初始化创建，对上层软件没有很大的影响，降低开发新形式的可实现类文件约束带来的成本和干扰。</p><h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>Java 在更新发布周期为每半年发布一次之后，在合并关键特性、快速得到开发者反馈等方面，做得越来越好。Java 11 版本的发布也带来了不少新特性和功能增强、性能提升、基础能力的全面进步和突破，本文针对其中对使用人员影响重大的以及主要的特性做了介绍。Java 12 即将到来，您准备好了吗？</p><p>本文仅代表作者个人观点，不代表其所在单位的意见，如有不足之处，还望您能够海涵。希望您能够反馈意见，交流心得，一同进步。</p><p>文章转载自 <a href="https://developer.ibm.com/zh/technologies/java/articles/the-new-features-of-java-11/">https://developer.ibm.com/zh/technologies/java/articles/the-new-features-of-java-11/</a></p><hr><h1 id="Java-12-特性详解"><a href="#Java-12-特性详解" class="headerlink" title="Java 12 特性详解"></a>Java 12 特性详解</h1><h2 id="Shenandoah：一个低停顿垃圾收集器（实验阶段）"><a href="#Shenandoah：一个低停顿垃圾收集器（实验阶段）" class="headerlink" title="Shenandoah：一个低停顿垃圾收集器（实验阶段）"></a>Shenandoah：一个低停顿垃圾收集器（实验阶段）</h2><p>Java 12 中引入一个新的垃圾收集器：Shenandoah，它是作为一中低停顿时间的垃圾收集器而引入到 Java 12 中的，其工作原理是通过与 Java 应用程序中的执行线程同时运行，用以执行其垃圾收集、内存回收任务，通过这种运行方式，给虚拟机带来短暂的停顿时间。</p><p>Shenandoah 垃圾回收器是 Red Hat 在 2014 年宣布进行的一项垃圾收集器研究项目，旨在针对 JVM 上的内存收回实现低停顿的需求。该设计将与应用程序线程并发，通过交换 CPU 并发周期和空间以改善停顿时间，使得垃圾回收器执行线程能够在 Java 线程运行时进行堆压缩，并且标记和整理能够同时进行，因此避免了在大多数 JVM 垃圾收集器中所遇到的问题。</p><p>据 Red Hat 研发 Shenandoah 团队对外宣称，Shenandoah 垃圾回收器的暂停时间与堆大小无关，这意味着无论将堆设置为 200 MB 还是 200 GB，都将拥有一致的系统暂停时间，不过实际使用性能将取决于实际工作堆的大小和工作负载。</p><p>图 1. Shenandoah GC 工作周期如下所示：</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/640" alt="图片"></p><p>上图对应工作周期如下：</p><ul><li>1.Init Mark 启动并发标记 阶段</li><li>2.并发标记遍历堆阶段</li><li>3.并发标记完成阶段</li><li>4.并发整理回收无活动区域阶段</li><li>5.并发 Evacuation 整理内存区域阶段</li><li>6.Init Update Refs 更新引用初始化 阶段</li><li>7.并发更新引用阶段</li><li>8.Final Update Refs 完成引用更新阶段</li><li>9.并发回收无引用区域阶段</li></ul><p>需要了解不是唯有 GC 停顿可能导致常规应用程序响应时间比较长。具有较长的 GC 停顿时间会导致系统响应慢的问题，但响应时间慢并非一定是 GC 停顿时间长导致的，队列延迟、网络延迟、其他依赖服务延迟和操作提供调度程序抖动等都可能导致响应变慢。使用 Shenandoah 时需要全面了解系统运行情况，综合分析系统响应时间。各种 GC 工作负载对比如下所示：</p><p>图 2. 各种 GC 工作负载对比：</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/640" alt="图片"></p><p><strong>下面推荐几个配置或调试 Shenandoah 的 JVM 参数:</strong></p><ul><li>-XX:+AlwaysPreTouch：使用所有可用的内存分页，减少系统运行停顿，为避免运行时性能损失。</li><li>-Xmx &#x3D;&#x3D; -Xmsv：设置初始堆大小与最大值一致，可以减轻伸缩堆大小带来的压力，与 AlwaysPreTouch 参数配合使用，在启动时提交所有内存，避免在最终使用中出现系统停顿。</li><li>-XX:+ UseTransparentHugePages：能够大大提高大堆的性能，同时建议在 Linux 上使用时将 &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;enabled 和 &#x2F;sys&#x2F;kernel&#x2F;mm&#x2F;transparent_hugepage&#x2F;defragv 设置为：madvise，同时与 AlwaysPreTouch 一起使用时，init 和 shutdownv 速度会更快，因为它将使用更大的页面进行预处理。</li><li>-XX:+UseNUMA：虽然 Shenandoah 尚未明确支持 NUMA（Non-Uniform Memory Access），但最好启用此功能以在多插槽主机上启用 NUMA 交错。与 AlwaysPreTouch 相结合，它提供了比默认配置更好的性能。</li><li>-XX:+DisableExplicitGC：忽略代码中的 System.gc() 调用。当用户在代码中调用 System.gc() 时会强制 Shenandoah 执行 STW Full GC ，应禁用它以防止执行此操作，另外还可以使用 -XX:+ExplicitGCInvokesConcurrent，在 调用 System.gc() 时执行 CMS GC 而不是 Full GC，建议在有 System.gc() 调用的情况下使用。</li><li>不过目前 Shenandoah 垃圾回收器还被标记为实验项目，需要使用参数：- XX:+UnlockExperimentalVMOptions 启用。更多有关如何配置、调试 Shenandoah 的信息，请参阅 henandoah wiki。</li></ul><h2 id="增加一套微基准套件"><a href="#增加一套微基准套件" class="headerlink" title="增加一套微基准套件"></a>增加一套微基准套件</h2><p>Java 12 中添加一套新的基本的微基准测试套件，该套微基准测试套件基于 JMH（Java Microbenchmark Harness），使开发人员可以轻松运行现有的微基准测试并创建新的基准测试，其目标在于提供一个稳定且优化过的基准，其中包括将近 100 个基准测试的初始集合，并且能够轻松添加新基准、更新基准测试和提高查找已有基准测试的便利性。</p><p>微基准套件与 JDK 源代码位于同一个目录中，并且在构建后将生成单个 Jar 文件。但它是一个单独的项目，在支持构建期间不会执行，以方便开发人员和其他对构建微基准套件不感兴趣的人在构建时花费比较少的构建时间。</p><p>要构建微基准套件，用户需要运行命令：make build-microbenchmark，类似的命令还有：make test TEST&#x3D;”micro:java.lang.invoke” 将使用默认设置运行 java.lang.invoke 相关的微基准测试。关于配置本地环境可以参照文档 docs&#x2F;testing.md|html。</p><h2 id="Switch-表达式扩展（预览功能）"><a href="#Switch-表达式扩展（预览功能）" class="headerlink" title="Switch 表达式扩展（预览功能）"></a>Switch 表达式扩展（预览功能）</h2><p>Java 11 以及之前 Java 版本中的 Switch 语句是按照类似 C、C++ 这样的语言来设计的，在默认情况下支持 fall-through 语法。虽然这种传统的控制流通常用于编写低级代码，但 Switch 控制语句通常运用在高级别语言环境下的，因此其容易出错性掩盖其灵活性。</p><p>在 Java 12 中重新拓展了 Switch 让它具备了新的能力，通过扩展现有的 Switch 语句，可将其作为增强版的 Switch 语句或称为 “Switch 表达式”来写出更加简化的代码。</p><p>Switch 表达式也是作为预览语言功能的第一个语言改动被引入新版 Java 中来的，预览语言功能的想法是在 2018 年初被引入 Java 中的，本质上讲，这是一种引入新特性的测试版的方法。通过这种方式，能够根据用户反馈进行升级、更改，在极端情况下，如果没有被很好的接纳，则可以完全删除该功能。预览功能的关键在于它们没有被包含在 Java SE 规范中。</p><p>在 Java 11 以及之前版本中传统形式的 Switch 语句写法如下：</p><p>清单 1. Switch 语句示例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> dayNumber;<br> <br><span class="hljs-keyword">switch</span> (day) &#123;<br> <br>    <span class="hljs-keyword">case</span> MONDAY:<br>    <span class="hljs-keyword">case</span> FRIDAY:<br>    <span class="hljs-keyword">case</span> SUNDAY:<br>        dayNumber = <span class="hljs-number">6</span>;<br>        <span class="hljs-keyword">break</span>; <br>    <span class="hljs-keyword">case</span> TUESDAY:<br>        dayNumber = <span class="hljs-number">7</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> THURSDAY:<br> <br>    <span class="hljs-keyword">case</span> SATURDAY:<br> <br>        dayNumber = <span class="hljs-number">8</span>;<br> <br>        <span class="hljs-keyword">break</span>;<br> <br>    <span class="hljs-keyword">case</span> WEDNESDAY:<br> <br>        dayNumber = <span class="hljs-number">9</span>;<br> <br>        <span class="hljs-keyword">break</span>;<br> <br>    <span class="hljs-keyword">default</span>:<br> <br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;Huh? &quot;</span> + day);<br> <br>&#125;<br></code></pre></td></tr></table></figure><p>上面代码中多处出现 break 语句，显得代码比较冗余，同时如果某处漏写一段 break 语句，将导致程序一直向下穿透执行的逻辑错误，出现异常结果，同时这种写法比较繁琐，也容易出问题。</p><p>换做 Java 12 中的 Switch 表达式，上述语句写法如下：</p><p>清单 2. Switch 表达式示例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">dayNumber</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (day) &#123;<br>    <span class="hljs-keyword">case</span> MONDAY, FRIDAY, SUNDAY -&gt; <span class="hljs-number">6</span>;<br>    <span class="hljs-keyword">case</span> TUESDAY                -&gt; <span class="hljs-number">7</span>;<br>    <span class="hljs-keyword">case</span> THURSDAY, SATURDAY     -&gt; <span class="hljs-number">8</span>;<br>    <span class="hljs-keyword">case</span> WEDNESDAY              -&gt; <span class="hljs-number">9</span>;<br>    <span class="hljs-keyword">default</span>                      -&gt; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;Huh? &quot;</span> + day);<br>&#125;<br></code></pre></td></tr></table></figure><p>使用 Java 12 中 Switch 表达式的写法，省去了 break 语句，避免了因少些 break 而出错，同时将多个 case 合并到一行，显得简洁、清晰也更加优雅的表达逻辑分支，其具体写法就是将之前的 case 语句表成了：case L -&gt;，即如果条件匹配 case L，则执行 标签右侧的代码 ，同时标签右侧的代码段只能是表达式、代码块或 throw 语句。为了保持兼容性，case 条件语句中依然可以使用字符 : ，这时 fall-through 规则依然有效的，即不能省略原有的 break 语句，但是同一个 Switch 结构里不能混用 -&gt; 和 : ，否则会有编译错误。并且简化后的 Switch 代码块中定义的局部变量，其作用域就限制在代码块中，而不是蔓延到整个 Switch 结构，也不用根据不同的判断条件来给变量赋值。</p><p>Java 11 以及之前版本中，Switch 表达式支持下面类型：byte、char、short、int、Byte、Character、Short、Integer、enum、tring，在未来的某个 Java 版本有可能会允许支持 float、double 和 long （以及上面类型的封装类型）。</p><h2 id="引入-JVM-常量-API"><a href="#引入-JVM-常量-API" class="headerlink" title="引入 JVM 常量 API"></a>引入 JVM 常量 API</h2><p>Java 12 中引入 JVM 常量 API，用来更容易地对关键类文件 (key class-file) 和运行时构件（artefact）的名义描述 (nominal description) 进行建模，特别是对那些从常量池加载的常量，这是一项非常技术性的变化，能够以更简单、标准的方式处理可加载常量。</p><p>此项改进主要在新的 java.lang.invoke.constant 包中定义了一系列基于值的符号引用类型，能够描述每种可加载常量。符号引用以纯粹 nominal 的形式描述可加载常量，与类加载或可访问 性上下文分开。同时有些类可以作为自己的符号引用（例如 String），而对于可链接常量，另外定义了一系列符号引用类型，具体包括：ClassDesc (Class 的可加载常量标称描述符) ，MethodTypeDesc(方法类型常量标称描述符) ，MethodHandleDesc (方法句柄常量标称描述符) 和 DynamicConstantDesc (动态常量标称描述符) ，它们包含描述这些常量的 nominal 信息。</p><h2 id="改进-AArch64-实现"><a href="#改进-AArch64-实现" class="headerlink" title="改进 AArch64 实现"></a>改进 AArch64 实现</h2><p>Java 12 中将只保留一套 AArch64 实现，删除所有与 arm64 实现相关的代码，只保留 32 位 ARM 端口和 64 位 aarch64 的端口。删除此套实现将允许所有开发人员将目标集中在剩下的这个 64 位 ARM 实现上，消除维护两套端口所需的重复工作。</p><p>当前 Java 11 中存在两套 64 位 AArch64 端口，它们主要存在于 src&#x2F;hotspot&#x2F;cpu&#x2F;arm 和 open&#x2F;src&#x2F;hotspot&#x2F;cpu&#x2F;aarch64 目录中。这两套代码中都实现了 AArch64，Java 12 中将删除目录 open&#x2F;src&#x2F;hotspot&#x2F;cpu&#x2F;arm 中关于 64-bit 的这套实现，只保留其中有关 32-bit 的实现，余下目录的 open&#x2F;src&#x2F;hotspot&#x2F;cpu&#x2F;aarch64 代码部分就成了 AArch64 的默认实现。</p><h2 id="使用默认类数据共享（CDS）存档"><a href="#使用默认类数据共享（CDS）存档" class="headerlink" title="使用默认类数据共享（CDS）存档"></a>使用默认类数据共享（CDS）存档</h2><p>类数据共享机制 (Class Data Sharing ，简称 CDS) ，允许将一组类预处理为共享归档文件，以便在运行时能够进行内存映射以减少 Java 程序的启动时间，当多个 Java 虚拟机（JVM）共享相同的归档文件时，还可以减少动态内存的占用量，同时减少多个虚拟机在同一个物理或虚拟的机器上运行时的资源占用。</p><p>自 Java 8 以来，在基本 CDS 功能上进行了许多增强、改进，启用 CDS 后应用的启动时间和内存占用量显着减少。使用 Java 11 早期版本在 64 位 Linux 平台上运行 HelloWorld 进行测试，测试结果显示启动时间缩短有 32 ％，同时在其他 64 位平台上，也有类似或更高的启动性能提升。</p><p>Java 12 针对 64 位平台下的 JDK 构建过程进行了增强改进，使其默认生成类数据共享（CDS）归档，以进一步达到改进应用程序的启动时间的目的，同时也避免了需要手动运行：-Xshare:dump 的需要，修改后的 JDK 将在 lib&#x2F;server 目录中保留构建时生成的 CDS 存档。</p><p>当然如果需要，也可以添加其他 GC 参数，来调整堆大小等，以获得更优的内存分布情况，同时用户也可以像之前一样创建自定义的 CDS 存档文件。</p><h2 id="改善-G1-垃圾收集器，使其能够中止混合集合"><a href="#改善-G1-垃圾收集器，使其能够中止混合集合" class="headerlink" title="改善 G1 垃圾收集器，使其能够中止混合集合"></a>改善 G1 垃圾收集器，使其能够中止混合集合</h2><p>G1 是垃圾收集器，设计用于具有大量内存的多处理器机器，提高了垃圾回收效率。该垃圾收集器 设计的主要目标之一是满足用户设置的预期的 JVM 停顿时间，G1 采用一个高级分析引擎来选择在收集期间要处理的工作量，此选择过程的结果是一组称为 GC 回收集的区域。一旦收集器确定了 GC 回收集 并且 GC 回收、整理工作已经开始，则 G1 收集器必须完成收集集合集的所有区域中的所有活动对象之后才能停止；但是如果收集器选择过大的 GC 回收集，可能会导致 G1 回收器停顿时间超过预期时间。</p><p>Java 12 中将把 GC 回收集（混合收集集合）拆分为必需和可选两部分，使 G1 垃圾回收器能中止垃圾回收过程。其中必需处理的部分包括 G1 垃圾收集器不能递增处理的 GC 回收集的部分（如：年轻代），同时也可以包含老年代以提高处理效率。将 GC 回收集拆分为必需和可选部分时，需要为可选 GC 回收集部分维护一些其他数据，这会产生轻微的 CPU 开销，但小于 1 ％的变化，同时在 G1 回收器处理 GC 回收集期间，本机内存使用率也可能会增加，使用上述情况只适用于包含可选 GC 回收部分的 GC 混合回收集合。</p><p>在 G1 垃圾回收器完成收集需要必需回收的部分之后，便开始收集可选的部分，如果还有时间的话，但是粗粒度的处理，可选部分的处理粒度取决于剩余的时间，一次只能处理可选部分的一个子集区域。在完成可选收集部分的收集后，G1 垃圾回收器可以根据剩余时间决定是否停止收集。如果在处理完 必需处理的 部分后，属于时间不足，总时间花销接近预期时间，G1 垃圾回收器也可以中止可选部分的回收以达到满足预期停顿时间的目标。</p><h2 id="增强-G1-垃圾收集器，使其能自动返回未用堆内存给操作系统"><a href="#增强-G1-垃圾收集器，使其能自动返回未用堆内存给操作系统" class="headerlink" title="增强 G1 垃圾收集器，使其能自动返回未用堆内存给操作系统"></a>增强 G1 垃圾收集器，使其能自动返回未用堆内存给操作系统</h2><p>上节中介绍了 Java 12 中增强了 G1 垃圾收集器关于混合收集集合的处理策略，这节主要介绍在 Java 12 中同时也对 G1 垃圾回收器进行了改进，使其能够在空闲时自动将 Java 堆内存返还给操作系统，这也是 Java 12 中的另外一项重大改进。</p><p>目前 Java 11 版本中包含的 G1 垃圾收集器 暂时无法及时将已提交的 Java 堆内存返回给操作系统， G1 垃圾收集器仅在进行完整 GC (Full GC) 或并发处理周期时才能将 Java 堆返回内存。由于 G1 回收器尽可能避免完整 GC，并且只触发基于 Java 堆占用和分配活动的并发周期，因此在许多情况下 G 1 垃圾回收器不能回收 Java 堆内存，除非有外部强制执行。</p><p>在使用云平台的容器环境中，这种不利之处特别明显。即使在虚拟机不活动，但如果仍然使用其分配的内存资源，哪怕是其中的一小部分，G1 回收器也仍将保留所有已分配的 Java 堆内存。而这将导致用户需要始终为所有资源付费，哪怕是实际并未用到，而云提供商也无法充分利用其硬件。如果在次期间虚拟机能够检测到 Java 堆内存的实际使用情况，并在利用空闲时间自动将 Java 堆内存返还，则两者都将受益。</p><p>为了尽可能的向操作系统返回空闲内存，G1 垃圾收集器将在应用程序不活动期间定期生成或持续循环检查整体 Java 堆使用情况，以便 G 1 垃圾收集器能够更及时的将 Java 堆中不使用内存部分返还给操作系统。对于长时间处于空闲状态的应用程序，此项改进将使 JVM 的内存利用率更加高效。</p><p>如果应用程序为非活动状态，在下面两种情况下，G1 回收器会触发定期垃圾收集：</p><p>自上次垃圾回收完成 以来已超过 G1PeriodicGCInterva l 毫秒， 并且此时没有正在进行的垃圾回收任务。如果 G1PeriodicGCInterval 值为零表示禁用快速回收内存的定期垃圾收集。<br>应用所在主机系统上执行方法 getloadavg()，一分钟内系统返回的平均负载值低于 G1PeriodicGCSystemLoadThreshold。如果 G1PeriodicGCSystemLoadThreshold 值为零，则此条件不生效。<br>如果不满足上述条件中的任何一个，则取消当期的定期垃圾回收。等一个 G1PeriodicGCInterval 时间周期后，将重新考虑是否执行定期垃圾回收。</p><p>G1 定期垃圾收集的类型根据 G1PeriodicGCInvokesConcurrent 参数的值确定：如果设置值了，G1 垃圾回收器将继续上一个或者启动一个新并发周期；如果没有设置值，则 G1 回收器将执行一个完整的 GC。在每次一次 GC 回收末尾，G1 回收器将调整当前的 Java 堆大小，此时便有可能会将未使用内存返还给操作系统。新的 Java 堆内存大小根据现有配置确定，具体包括下列配置：- XX:MinHeapFreeRatio、-XX:MaxHeapFreeRatio、-Xms、-Xmx。</p><p>默认情况下，G1 回收器在定期垃圾回收期间新启动或继续上一轮并发周期，将最大限度地减少应用程序的中断。如果定期垃圾收集严重影响程序执行，则需要考虑整个系统 CPU 负载，或让用户禁用定期垃圾收集。</p><p>转自：&lt;blog.csdn.net&#x2F;yunqiinsight&#x2F;article&#x2F;details&#x2F;100654085&gt;</p><h1 id="Java-13-特性详解"><a href="#Java-13-特性详解" class="headerlink" title="Java 13 特性详解"></a>Java 13 特性详解</h1><h2 id="动态应用程序类-数据共享"><a href="#动态应用程序类-数据共享" class="headerlink" title="动态应用程序类-数据共享"></a>动态应用程序类-数据共享</h2><p>在 Java 10 中，为了改善应用启动时间和内存空间占用，通过使用 APP CDS，加大了 CDS 的使用范围，允许自定义的类加载器也可以加载自定义类给多个 JVM 共享使用，具体介绍可以参考 Java 10 新特性介绍一文详细介绍，在此就不再继续展开。</p><p>Java 13 中对 Java 10 中引入的 应用程序类数据共享进行了进一步的简化、改进和扩展，即：允许在 Java 应用程序执行结束时动态进行类归档，具体能够被归档的类包括：所有已被加载，但不属于默认基层 CDS 的应用程序类和引用类库中的类。通过这种改进，可以提高应用程序类-数据使用上的简易性，减少在使用类-数据存档中需要为应用程序创建类加载列表的必要，简化使用类-数据共享的步骤，以便更简单、便捷地使用 CDS 存档。</p><p>在 Java 中，如果要执行一个类，首先需要将类编译成对应的字节码文件，以下是 JVM 装载、执行等需要的一系列准备步骤：假设给定一个类名，JVM 将在磁盘上查找到该类对应的字节码文件，并将其进行加载，验证字节码文件，准备，解析，初始化，根据其内部数据结构加载到内存中。当然，这一连串的操作都需要一些时间，这在 JVM 启动并且需要加载至少几百个甚至是数千个类时，加载时间就尤其明显。</p><p>Java 10 中的 App CDS 主要是为了将不变的类数据，进行一次创建，然后存储到归档中，以便在应用重启之后可以对其进行内存映射而直接使用，同时也可以在运行的 JVM 实例之间共享使用。但是在 Java 10 中使用 App CDS 需要进行如下操作：</p><ul><li>创建需要进行类归档的类列表</li><li>创建归档</li><li>使用归档方式启动</li></ul><p>在使用归档文件启动时，JVM 将归档文件映射到其对应的内存中，其中包含所需的大多数类，而</p><p>需要使用多么复杂的类加载机制。甚至可以在并发运行的 JVM 实例之间共享内存区域，通过这种方式可以释放需要在每个 JVM 实例中创建相同信息时浪费的内存，从而节省了内存空间。</p><p>在 Java 12 中，默认开启了对 JDK 自带 JAR 包类的存档，如果想关闭对自带类库的存档，可以在启动参数中加上：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">-Xshare:off<br></code></pre></td></tr></table></figure><p>而在 Java 13 中，可以不用提供归档类列表，而是通过更简洁的方式来创建包含应用程序类的归档。具体可以使用参数 <code>-XX:ArchiveClassesAtExit</code> 来控制应用程序在退出时生成存档，也可以使用 <code>-XX:SharedArchiveFile</code> 来使用动态存档功能，详细使用见如下示例。</p><p>清单 1. 创建存档文件示例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">java -XX:ArchiveClassesAtExit=helloworld.jsa -<span class="hljs-built_in">cp</span> helloworld.jar Hello</span><br></code></pre></td></tr></table></figure><p>清单 2. 使用存档文件示例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">java -XX:SharedArchiveFile=hello.jsa -<span class="hljs-built_in">cp</span> helloworld.jar Hello</span><br></code></pre></td></tr></table></figure><p>上述就是在 Java 应用程序执行结束时动态进行类归档，并且在 Java 10 的基础上，将多条命令进行了简化，可以更加方便地使用类归档功能。</p><h2 id="增强-ZGC-释放未使用内存"><a href="#增强-ZGC-释放未使用内存" class="headerlink" title="增强 ZGC 释放未使用内存"></a>增强 ZGC 释放未使用内存</h2><p>ZGC 是 Java 11 中引入的最为瞩目的垃圾回收特性，是一种可伸缩、低延迟的垃圾收集器，不过在 Java 11 中是实验性的引入，主要用来改善 GC 停顿时间，并支持几百 MB 至几个 TB 级别大小的堆，并且应用吞吐能力下降不会超过 15%，目前只支持 Linux&#x2F;x64 位平台的这样一种新型垃圾收集器。</p><p>通过在实际中的使用，发现 ZGC 收集器中并没有像 Hotspot 中的 G1 和 Shenandoah 垃圾收集器一样，能够主动将未使用的内存释放给操作系统的功能。对于大多数应用程序来说，CPU 和内存都属于有限的紧缺资源，特别是现在使用的云上或者虚拟化环境中。如果应用程序中的内存长期处于空闲状态，并且还不能释放给操作系统，这样会导致其他需要内存的应用无法分配到需要的内存，而这边应用分配的内存还处于空闲状态，处于”忙的太忙，闲的太闲”的非公平状态，并且也容易导致基于虚拟化的环境中，因为这些实际并未使用的资源而多付费的情况。由此可见，将未使用内存释放给系统主内存是一项非常有用且亟需的功能。</p><p>ZGC 堆由一组称为 ZPages 的堆区域组成。在 GC 周期中清空 ZPages 区域时，它们将被释放并返回到页面缓存 ZPageCache 中，此缓存中的 ZPages 按最近最少使用（LRU）的顺序，并按照大小进行组织。在 Java 13 中，ZGC 将向操作系统返回被标识为长时间未使用的页面，这样它们将可以被其他进程重用。同时释放这些未使用的内存给操作系统不会导致堆大小缩小到参数设置的最小大小以下，如果将最小和最大堆大小设置为相同的值，则不会释放任何内存给操作系统。</p><p>Java 13 中对 ZGC 的改进，主要体现在下面几点：</p><ul><li>释放未使用内存给操作系统</li><li>支持最大堆大小为 16TB</li><li>添加参数：-XX:SoftMaxHeapSize 来软限制堆大小</li></ul><p>这里提到的是软限制堆大小，是指 GC 应努力是堆大小不要超过指定大小，但是如果实际需要，也还是允许 GC 将堆大小增加到超过 SoftMaxHeapSize 指定值。主要用在下面几种情况：当希望降低堆占用，同时保持应对堆空间临时增加的能力，亦或想保留充足内存空间，以能够应对内存分配，而不会因为内存分配意外增加而陷入分配停滞状态。不应将 SoftMaxHeapSize 设置为大于最大堆大小（-Xmx 的值，如果未在命令行上设置，则此标志应默认为最大堆大小。</p><p>Java 13 中，ZGC 内存释放功能，默认情况下是开启的，不过可以使用参数：-XX：-ZUncommit 显式关闭，同时如果将最小堆大小 (-Xms) 配置为等于最大堆大小 (-Xmx)，则将隐式禁用此功能。</p><p>还可以使用参数：<code>-XX：ZUncommitDelay = &lt;seconds&gt;</code>（默认值为 300 秒）来配置延迟释放，此延迟时间可以指定释放多长时间之前未使用的内存。</p><h2 id="Socket-API-重构"><a href="#Socket-API-重构" class="headerlink" title="Socket API 重构"></a>Socket API 重构</h2><p>Java 中的 Socket API 已经存在了二十多年了，尽管这么多年来，一直在维护和更新中，但是在实际使用中遇到一些局限性，并且不容易维护和调试，所以要对其进行大修大改，才能跟得上现代技术的发展，毕竟二十多年来，技术都发生了深刻的变化。Java 13 为 Socket API 带来了新的底层实现方法，并且在 Java 13 中是默认使用新的 Socket 实现，使其易于发现并在排除问题同时增加可维护性。</p><p>Java Socket API（java.net.ServerSocket 和 java.net.Socket）包含允许监听控制服务器和发送数据的套接字对象。可以使用 ServerSocket 来监听连接请求的端口，一旦连接成功就返回一个 Socket 对象，可以使用该对象读取发送的数据和进行数据写回操作，而这些类的繁重工作都是依赖于 SocketImpl 的内部实现，服务器的发送和接收两端都基于 SOCKS 进行实现的。</p><p>在 Java 13 之前，通过使用 PlainSocketImpl 作为 SocketImpl 的具体实现。</p><p>Java 13 中的新底层实现，引入 NioSocketImpl 的实现用以替换 SocketImpl 的 PlainSocketImpl 实现，此实现与 NIO（新 I&#x2F;O）实现共享相同的内部基础结构，并且与现有的缓冲区高速缓存机制集成在一起，因此不需要使用线程堆栈。除了这些更改之外，还有其他一些更便利的更改，如使用 java.lang.ref.Cleaner 机制来关闭套接字（如果 SocketImpl 实现在尚未关闭的套接字上被进行了垃圾收集），以及在轮询时套接字处于非阻塞模式时处理超时操作等方面。</p><p>为了最小化在重新实现已使用二十多年的方法时出现问题的风险，在引入新实现方法的同时，之前版本的实现还未被移除，可以通过使用下列系统属性以重新使用原实现方法：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">-Djdk.net.usePlainSocketImpl = true<br></code></pre></td></tr></table></figure><p>另外需要注意的是，SocketImpl 是一种传统的 SPI 机制，同时也是一个抽象类，并未指定具体的实现，所以，新的实现方式尝试模拟未指定的行为，以达到与原有实现兼容的目的。但是，在使用新实现时，有些基本情况可能会失败，使用上述系统属性可以纠正遇到的问题，下面两个除外。</p><ul><li>老版本中，PlainSocketImpl 中的 getInputStream() 和 getOutputStream() 方法返回的 InputStream 和 OutputStream 分别来自于其对应的扩展类型 FileInputStream 和 FileOutputStream，而这个在新版实现中则没有。</li><li>使用自定义或其它平台的 SocketImpl 的服务器套接字无法接受使用其他（自定义或其它平台）类型 SocketImpl 返回 Sockets 的连接。</li></ul><p>通过这些更改，Java Socket API 将更易于维护，更好地维护将使套接字代码的可靠性得到改善。同时 NIO 实现也可以在基础层面完成，从而保持 Socket 和 ServerSocket 类层面上的不变。</p><h2 id="Switch-表达式扩展（预览功能）-1"><a href="#Switch-表达式扩展（预览功能）-1" class="headerlink" title="Switch 表达式扩展（预览功能）"></a>Switch 表达式扩展（预览功能）</h2><p>在 Java 12 中引入了 Switch 表达式作为预览特性，而在 Java 13 中对 Switch 表达式做了增强改进，在块中引入了 yield 语句来返回值，而不是使用 break。这意味着，Switch 表达式（返回值）应该使用 yield，而 Switch 语句（不返回值）应该使用 break，而在此之前，想要在 Switch 中返回内容，还是比较麻烦的，只不过目前还处于预览状态。</p><p>在 Java 13 之后，Switch 表达式中就多了一个关键字用于跳出 Switch 块的关键字 yield，主要用于返回一个值，它和 return 的区别在于：return 会直接跳出当前循环或者方法，而 yield 只会跳出当前 Switch块，同时在使用 yield 时，需要有 default 条件。</p><p>在 Java 12 之前，传统 Switch 语句写法为：</p><p>清单 3. 传统形式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getText</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">switch</span> (number) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span>:<br>            result = <span class="hljs-string">&quot;one or two&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>            result = <span class="hljs-string">&quot;three&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>:<br>            result = <span class="hljs-string">&quot;four or five or six&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            result = <span class="hljs-string">&quot;unknown&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>    &#125;;<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>在 Java 12 之后，关于 Switch 表达式的写法改进为如下：</p><p>清单 4. 标签简化形式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getText</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (number) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span> -&gt; <span class="hljs-string">&quot;one or two&quot;</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span> -&gt; <span class="hljs-string">&quot;three&quot;</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span> -&gt; <span class="hljs-string">&quot;four or five or six&quot;</span>;<br>        <span class="hljs-keyword">default</span> -&gt; <span class="hljs-string">&quot;unknown&quot;</span>;<br>    &#125;;<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>而在 Java 13 中，value break 语句不再被编译，而是用 yield 来进行值返回，上述写法被改为如下写法：</p><p>清单 5. yield 返回值形式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getText</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">switch</span> (number) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span>:<br>            yield <span class="hljs-string">&quot;one or two&quot;</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>            yield <span class="hljs-string">&quot;three&quot;</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>:<br>            yield <span class="hljs-string">&quot;four or five or six&quot;</span>;<br>        <span class="hljs-keyword">default</span>:<br>            yield <span class="hljs-string">&quot;unknown&quot;</span>;<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="文本块（预览功能）"><a href="#文本块（预览功能）" class="headerlink" title="文本块（预览功能）"></a>文本块（预览功能）</h2><p>一直以来，Java 语言在定义字符串的方式是有限的，字符串需要以双引号开头，以双引号结尾，这导致字符串不能够多行使用，而是需要通过换行转义或者换行连接符等方式来变通支持多行，但这样会增加编辑工作量，同时也会导致所在代码段难以阅读、难以维护。</p><p>Java 13 引入了文本块来解决多行文本的问题，文本块以三重双引号开头，并以同样的以三重双引号结尾终止，它们之间的任何内容都被解释为字符串的一部分，包括换行符，避免了对大多数转义序列的需要，并且它仍然是普通的 java.lang.String 对象，文本块可以在 Java 中可以使用字符串文字的任何地方使用，而与编译后的代码没有区别，还增强了 Java 程序中的字符串可读性。并且通过这种方式，可以更直观地表示字符串，可以支持跨越多行，而且不会出现转义的视觉混乱，将可以广泛提高 Java 类程序的可读性和可写性。</p><p>在 Java 13 之前，多行字符串写法为：</p><p>清单 6. 多行字符串写法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;&lt;html&gt;\n&quot;</span> +<br>              <span class="hljs-string">&quot;   &lt;body&gt;\n&quot;</span> +<br>              <span class="hljs-string">&quot;      &lt;p&gt;Hello, World&lt;/p&gt;\n&quot;</span> +<br>              <span class="hljs-string">&quot;   &lt;/body&gt;\n&quot;</span> +<br>              <span class="hljs-string">&quot;&lt;/html&gt;\n&quot;</span>;<br><br><br> <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span><span class="hljs-string">&quot;&#123;\n&quot;</span> +<br>              <span class="hljs-string">&quot;   \&quot;name\&quot;:\&quot;mkyong\&quot;,\n&quot;</span> +<br>              <span class="hljs-string">&quot;   \&quot;age\&quot;:38\n&quot;</span> +<br>              <span class="hljs-string">&quot;&#125;\n&quot;</span>;<br></code></pre></td></tr></table></figure><p>在 Java 13 引入文本块之后，写法为：</p><p>清单 7. 多行文本块写法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">                &lt;html&gt;</span><br><span class="hljs-string">                    &lt;body&gt;</span><br><span class="hljs-string">                        &lt;p&gt;Hello, World&lt;/p&gt;</span><br><span class="hljs-string">                    &lt;/body&gt;</span><br><span class="hljs-string">                &lt;/html&gt;</span><br><span class="hljs-string">                &quot;&quot;&quot;</span>;<br><br> <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">                &#123;</span><br><span class="hljs-string">                    &quot;name&quot;:&quot;mkyong&quot;,</span><br><span class="hljs-string">                    &quot;age&quot;:38</span><br><span class="hljs-string">                &#125;</span><br><span class="hljs-string">                &quot;&quot;&quot;</span>;<br></code></pre></td></tr></table></figure><p>文本块是作为预览功能引入到 Java 13 中的，这意味着它们不包含在相关的 Java 语言规范中，这样做的好处是方便用户测试功能并提供反馈，后续更新可以根据反馈来改进功能，或者必要时甚至删除该功能，如果该功能立即成为 Java SE 标准的一部分，则进行更改将变得更加困难。重要的是要意识到预览功能不是 beta 形式。</p><p>由于预览功能不是规范的一部分，因此有必要为编译和运行时明确启用它们。需要使用下面两个命令行参数来启用预览功能：</p><p>清单 8. 启用预览功能</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">javac --enable-preview --release 13 Example.java</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">java --enable-preview Example</span><br></code></pre></td></tr></table></figure><h2 id="结束语-1"><a href="#结束语-1" class="headerlink" title="结束语"></a>结束语</h2><p>Java 在更新发布周期为每半年发布一次之后，在合并关键特性、快速得到开发者反馈等方面，做得越来越好。从 Java 11 到 Java 13，目前确实是严格保持半年更新的节奏。Java 13 版本的发布带来了些新特性和功能增强、性能提升和改进尝试，不过 Java 13 不是 LTS 版本，本文针对其中对使用人员影响重大的以及主要的特性做了介绍，如有兴趣，您可以自行下载相关代码，继续深入研究。</p><p>本文转载自&lt; <a href="https://developer.ibm.com/zh/technologies/java/articles/the-new-features-of-java-13/&gt;">https://developer.ibm.com/zh/technologies/java/articles/the-new-features-of-java-13/&gt;</a></p><h1 id="Java-14-特性详解"><a href="#Java-14-特性详解" class="headerlink" title="Java 14 特性详解"></a>Java 14 特性详解</h1><h2 id="instanceof-模式匹配（预览阶段）"><a href="#instanceof-模式匹配（预览阶段）" class="headerlink" title="instanceof 模式匹配（预览阶段）"></a>instanceof 模式匹配（预览阶段）</h2><p>Java 14 中对 instanceof 的改进，主要目的是为了让创建对象更简单、简洁和高效，并且可读性更强、提高安全性。</p><p>在以往实际使用中，instanceof 主要用来检查对象的类型，然后根据类型对目标对象进行类型转换，之后进行不同的处理、实现不同的逻辑，具体可以参考清单 1：</p><p>清单 1. instanceof 传统使用方式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (person <span class="hljs-keyword">instanceof</span> Student) &#123;<br>    <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> (Student) person;<br>    student.say();<br>   <span class="hljs-comment">// other student operations</span><br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (person <span class="hljs-keyword">instanceof</span> Teacher) &#123;<br>    <span class="hljs-type">Teacher</span> <span class="hljs-variable">teacher</span> <span class="hljs-operator">=</span> (Teacher) person;<br>    teacher.say();<br>    <span class="hljs-comment">// other teacher operations</span><br>&#125;<br></code></pre></td></tr></table></figure><p>上述代码中，我们首先需要对 person 对象进行类型判断，判断 person 具体是 Student 还是 Teacher，因为这两种角色对应不同操作，亦即对应到的实际逻辑实现，判断完 person 类型之后，然后强制对 person 进行类型转换为局部变量，以方便后续执行属于该角色的特定操作。</p><p>上面这种写法，有下面两个问题：</p><ul><li>每次在检查类型之后，都需要强制进行类型转换。</li><li>类型转换后，需要提前创建一个局部变量来接收转换后的结果，代码显得多余且繁琐。</li></ul><p>Java 14 中，对 instanceof 进行模式匹配改进之后，上面示例代码可以改写成：</p><p>清单 2. instanceof 模式匹配使用方式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (person <span class="hljs-keyword">instanceof</span> Student student) &#123;<br>    student.say();<br>   <span class="hljs-comment">// other student operations</span><br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (person <span class="hljs-keyword">instanceof</span> Teacher teacher) &#123;<br>    teacher.say();<br>    <span class="hljs-comment">// other teacher operations</span><br>&#125;<br></code></pre></td></tr></table></figure><p>清单 2 中，首先在 if 代码块中，对 person 对象进行类型匹配，校验 person 对象是否为 Student 类型，如果类型匹配成功，则会转换为 Student 类型，并赋值给模式局部变量 student，并且只有当模式匹配表达式匹配成功是才会生效和复制，同时这里的 student 变量只能在 if 块中使用，而不能在 else if&#x2F;else 中使用，否则会报编译错误。</p><p>注意，如果 if 条件中有 &amp;&amp; 运算符时，当 instanceof 类型匹配成功，模式局部变量的作用范围也可以相应延长，如下面代码：</p><p>清单 3. Instanceof 模式匹配 &amp;&amp; 方式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String s &amp;&amp; s.length() &gt; <span class="hljs-number">5</span>) &#123;.. s.contains(..) ..&#125;<br></code></pre></td></tr></table></figure><p>另外，需要注意，这种作用范围延长，并不适用于或 || 运算符，因为即便 || 运算符左边的 instanceof 类型匹配没有成功也不会造成短路，依旧会执行到||运算符右边的表达式，但是此时，因为 instanceof 类型匹配没有成功，局部变量并未定义赋值，此时使用会产生问题。</p><p>与传统写法对比，可以发现模式匹配不但提高了程序的安全性、健壮性，另一方面，不需要显式的去进行二次类型转换，减少了大量不必要的强制类型转换。模式匹配变量在模式匹配成功之后，可以直接使用，同时它还被限制了作用范围，大大提高了程序的简洁性、可读性和安全性。instanceof 的模式匹配，为 Java 带来的有一次便捷的提升，能够剔除一些冗余的代码，写出更加简洁安全的代码，提高码代码效率。</p><h2 id="G1-的-NUMA-可识别内存分配"><a href="#G1-的-NUMA-可识别内存分配" class="headerlink" title="G1 的 NUMA 可识别内存分配"></a>G1 的 NUMA 可识别内存分配</h2><p>Java 14 改进非一致性内存访问（NUMA）系统上的 G1 垃圾收集器的整体性能，主要是对年轻代的内存分配进行优化，从而提高 CPU 计算过程中内存访问速度。</p><p>NUMA 是 <strong>non-unified memory access</strong> 的缩写，主要是指在当前的多插槽物理计算机体系中，比较普遍是多核的处理器，并且越来越多的具有 NUMA 内存访问体系结构，即内存与每个插槽或内核之间的距离并不相等。同时套接字之间的内存访问具有不同的性能特征，对更远的套接字的访问通常具有更多的时间消耗。这样每个核对于每一块或者某一区域的内存访问速度会随着核和物理内存所在的位置的远近而有不同的时延差异。</p><p>Java 中，堆内存分配一般发生在线程运行的时候，当创建了一个新对象时，该线程会触发 G1 去分配一块内存出来，用来存放新创建的对象，在 G1 内存体系中，其实就是一块 region（大对象除外，大对象需要多个 region），在这个分配新内存的过程中，如果支持了 NUMA 感知内存分配，将会优先在与当前线程所绑定的 NUMA 节点空闲内存区域来执行 allocate 操作，同一线程创建的对象，尽可能的保留在年轻代的同一 NUMA 内存节点上，因为是基于同一个线程创建的对象大部分是短存活并且高概率互相调用的。</p><p>具体启用方式可以在 JVM 参数后面加上如下参数:</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">-<span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:+UseNUMA</span><br></code></pre></td></tr></table></figure><p>通过这种方式来启用可识别的内存分配方式，能够提高一些大型计算机的 G1 内存分配回收性能。改进 NullPointerExceptions 提示信息</p><p>Java 14 改进 NullPointerException 的可查性、可读性，能更准确地定位 null 变量的信息。该特性能够帮助开发者和技术支持人员提高生产力，以及改进各种开发工具和调试工具的质量，能够更加准确、清楚地根据动态异常与程序代码相结合来理解程序。</p><p>相信每位开发者在实际编码过程中都遇到过 NullPointerException，每当遇到这种异常的时候，都需要根据打印出来的详细信息来分析、定位出现问题的原因，以在程序代码中规避或解决。例如，假设下面代码出现了一个 NullPointerException：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">book.id</span> = <span class="hljs-number">99</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>打印出来的 NullPointerException 信息如下：</p><p>清单 4. NullPointerException 信息</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;main&quot;</span> java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.NullPointerException</span><br>    at Book<span class="hljs-selector-class">.main</span>(Book<span class="hljs-selector-class">.java</span>:<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><p>像上面这种异常，因为代码比较简单，并且异常信息中也打印出来了行号信息，开发者可以很快速定位到出现异常位置：book 为空而导致的 NullPointerException，而对于一些复杂或者嵌套的情况下出现 NullPointerException 时，仅根据打印出来的信息，很难判断实际出现问题的位置，具体见下面示例：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">shoopingcart.buy.book.id</span> = <span class="hljs-number">99</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>对于这种比较复杂的情况下，仅仅单根据异常信息中打印的行号，则比较难判断出现 NullPointerException 的原因。</p><p>而 Java 14 中，则做了对 NullPointerException 打印异常信息的改进增强，通过分析程序的字节码信息，能够做到准确的定位到出现 NullPointerException 的变量，并且根据实际源代码打印出详细异常信息，对于上述示例，打印信息如下：</p><p>清单 5. NullPointerException 详细信息</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;main&quot;</span> java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.NullPointerException</span>: <br>        Cannot assign field <span class="hljs-string">&quot;book&quot;</span> because <span class="hljs-string">&quot;shoopingcart.buy&quot;</span> is null<br>    at Book<span class="hljs-selector-class">.main</span>(Book<span class="hljs-selector-class">.java</span>:<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><p>对比可以看出，改进之后的 NullPointerException 信息，能够准确打印出具体哪个变量导致的 NullPointerException，减少了由于仅带行号的异常提示信息带来的困惑。该改进功能可以通过如下参数开启：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">-<span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:+ShowCodeDetailsInExceptionMessages</span><br></code></pre></td></tr></table></figure><p>该增强改进特性，不仅适用于属性访问，还适用于方法调用、数组访问和赋值等有可能会导致 NullPointerException 的地方。</p><h2 id="Record-类型（预览功能）"><a href="#Record-类型（预览功能）" class="headerlink" title="Record 类型（预览功能）"></a>Record 类型（预览功能）</h2><p>Java 14 富有建设性地将 Record 类型作为预览特性而引入。Record 类型允许在代码中使用紧凑的语法形式来声明类，而这些类能够作为不可变数据类型的封装持有者。Record 这一特性主要用在特定领域的类上；与枚举类型一样，Record 类型是一种受限形式的类型，主要用于存储、保存数据，并且没有其它额外自定义行为的场景下。</p><p>在以往开发过程中，被当作数据载体的类对象，在正确声明定义过程中，通常需要编写大量的无实际业务、重复性质的代码，其中包括：构造函数、属性调用、访问以及 equals() 、hashCode()、toString() 等方法，因此在 Java 14 中引入了 Record 类型，其效果有些类似 Lombok 的 @Data 注解、Kotlin 中的 data class，但是又不尽完全相同，它们的共同点都是类的部分或者全部可以直接在类头中定义、描述，并且这个类只用于存储数据而已。对于 Record 类型，具体可以用下面代码来说明：</p><p>清单 6. Record 类型定义</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String address;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>对上述代码进行编译，然后反编译之后可以看到如下结果：</p><p>清单 7. Record 类型反编译结果</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> extends java.lang.Record &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> java.lang.<span class="hljs-type">String</span> name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> java.lang.<span class="hljs-type">String</span> age;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Person</span><span class="hljs-params">(java.lang.<span class="hljs-type">String</span> name, java.lang.<span class="hljs-type">String</span> age)</span> </span>&#123; <span class="hljs-comment">/* compiled code */</span> &#125;<br><br>    <span class="hljs-keyword">public</span> java.lang.<span class="hljs-function"><span class="hljs-type">String</span> <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-comment">/* compiled code */</span> &#125;<br><br>    <span class="hljs-keyword">public</span> java.lang.<span class="hljs-function"><span class="hljs-type">String</span> <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-comment">/* compiled code */</span> &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-comment">/* compiled code */</span> &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(java.lang.Object o)</span> </span>&#123; <span class="hljs-comment">/* compiled code */</span> &#125;<br><br>    <span class="hljs-keyword">public</span> java.lang.<span class="hljs-function"><span class="hljs-type">String</span> <span class="hljs-title">name</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-comment">/* compiled code */</span> &#125;<br><br>    <span class="hljs-keyword">public</span> java.lang.<span class="hljs-function"><span class="hljs-type">String</span> <span class="hljs-title">age</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-comment">/* compiled code */</span> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>根据反编译结果，可以得出，当用 Record 来声明一个类时，该类将自动拥有下面特征：</p><ul><li>拥有一个构造方法</li><li>获取成员属性值的方法：name()、age()</li><li>hashCode() 方法和 euqals() 方法</li><li>toString() 方法</li><li>类对象和属性被 final 关键字修饰，不能被继承，类的示例属性也都被 final 修饰，不能再被赋值使用。</li><li>还可以在 Record 声明的类中定义静态属性、方法和示例方法。注意，不能在 Record 声明的类中定义示例字段，类也不能声明为抽象类等。</li></ul><p>可以看到，该预览特性提供了一种更为紧凑的语法来声明类，并且可以大幅减少定义类似数据类型时所需的重复性代码。</p><p>另外 Java 14 中为了引入 Record 这种新的类型，在 java.lang.Class 中引入了下面两个新方法：</p><p>清单 8. Record 新引入至 Class 中的方法</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs scss">RecordComponent<span class="hljs-selector-attr">[]</span> <span class="hljs-built_in">getRecordComponents</span>()<br>boolean <span class="hljs-built_in">isRecord</span>()<br></code></pre></td></tr></table></figure><p>其中 getRecordComponents() 方法返回一组 java.lang.reflect.RecordComponent 对象组成的数组，java.lang.reflect.RecordComponent也是一个新引入类，该数组的元素与 Record 类中的组件相对应，其顺序与在记录声明中出现的顺序相同，可以从该数组中的每个 RecordComponent 中提取到组件信息，包括其名称、类型、泛型类型、注释及其访问方法。</p><p>而 isRecord() 方法，则返回所在类是否是 Record 类型，如果是，则返回 true。</p><h2 id="Switch-表达式（正式版）"><a href="#Switch-表达式（正式版）" class="headerlink" title="Switch 表达式（正式版）"></a>Switch 表达式（正式版）</h2><p>switch 表达式在之前的 Java 12 和 Java 13 中都是处于预览阶段，而在这次更新的 Java 14 中，终于成为稳定版本，能够正式可用。</p><p>switch 表达式带来的不仅仅是编码上的简洁、流畅，也精简了 switch 语句的使用方式，同时也兼容之前的 switch 语句的使用；之前使用 switch 语句时，在每个分支结束之前，往往都需要加上 break 关键字进行分支跳出，以防 switch 语句一直往后执行到整个 switch 语句结束，由此造成一些意想不到的问题。switch 语句一般使用冒号 ：来作为语句分支代码的开始，而 switch 表达式则提供了新的分支切换方式，即 -&gt; 符号右则表达式方法体在执行完分支方法之后，自动结束 switch 分支，同时 -&gt; 右则方法块中可以是表达式、代码块或者是手动抛出的异常。以往的 switch 语句写法如下：</p><p>清单 9. Switch 语句</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> dayOfWeek;<br><span class="hljs-keyword">switch</span> (day) &#123;<br>    <span class="hljs-keyword">case</span> MONDAY:<br>    <span class="hljs-keyword">case</span> FRIDAY:<br>    <span class="hljs-keyword">case</span> SUNDAY:<br>        dayOfWeek = <span class="hljs-number">6</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> TUESDAY:<br>        dayOfWeek = <span class="hljs-number">7</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> THURSDAY:<br>    <span class="hljs-keyword">case</span> SATURDAY:<br>        dayOfWeek = <span class="hljs-number">8</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> WEDNESDAY:<br>        dayOfWeek = <span class="hljs-number">9</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        dayOfWeek = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">break</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>而现在 Java 14 可以使用 switch 表达式正式版之后，上面语句可以转换为下列写法：</p><p>清单 10. Switch 表达式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">dayOfWeek</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (day) &#123;<br>    <span class="hljs-keyword">case</span> MONDAY, FRIDAY, SUNDAY -&gt; <span class="hljs-number">6</span>;<br>    <span class="hljs-keyword">case</span> TUESDAY                -&gt; <span class="hljs-number">7</span>;<br>    <span class="hljs-keyword">case</span> THURSDAY, SATURDAY     -&gt; <span class="hljs-number">8</span>;<br><span class="hljs-keyword">case</span> WEDNESDAY              -&gt; <span class="hljs-number">9</span>;<br>    <span class="hljs-keyword">default</span>              -&gt; <span class="hljs-number">0</span>;<br><br>&#125;;<br></code></pre></td></tr></table></figure><p>很明显，switch 表达式将之前 switch 语句从编码方式上简化了不少，但是还是需要注意下面几点：</p><ul><li>需要保持与之前 switch 语句同样的 case 分支情况。</li><li>之前需要用变量来接收返回值，而现在直接使用 yield 关键字来返回 case 分支需要返回的结果。</li><li>现在的 switch 表达式中不再需要显式地使用 return、break 或者 continue 来跳出当前分支。</li><li>现在不需要像之前一样，在每个分支结束之前加上 break 关键字来结束当前分支，如果不加，则会默认往后执行，直到遇到 break 关键字或者整个 switch 语句结束，在 Java 14 表达式中，表达式默认执行完之后自动跳出，不会继续往后执行。</li><li>对于多个相同的 case 方法块，可以将 case 条件并列，而不需要像之前一样，通过每个 case 后面故意不加 break 关键字来使用相同方法块。</li></ul><p>使用 switch 表达式来替换之前的 switch 语句，确实精简了不少代码，提高了编码效率，同时也可以规避一些可能由于不太经意而出现的意想不到的情况，可见 Java 在提高使用者编码效率、编码体验和简化使用方面一直在不停的努力中，同时也期待未来有更多的类似 lambda、switch 表达式这样的新特性出来。</p><h2 id="删除-CMS-垃圾回收器"><a href="#删除-CMS-垃圾回收器" class="headerlink" title="删除 CMS 垃圾回收器"></a>删除 CMS 垃圾回收器</h2><p>CMS 是老年代垃圾回收算法，通过标记-清除的方式进行内存回收，在内存回收过程中能够与用户线程并行执行。CMS 回收器可以与 Serial 回收器和 Parallel New 回收器搭配使用，CMS 主要通过并发的方式，适当减少系统的吞吐量以达到追求响应速度的目的，比较适合在追求 GC 速度的服务器上使用。</p><p>因为 CMS 回收算法在进行 GC 回收内存过程中是使用并行方式进行的，如果服务器 CPU 核数不多的情况下，进行 CMS 垃圾回收有可能造成比较高的负载。同时在 CMS 并行标记和并行清理时，应用线程还在继续运行，程序在运行过程中自然会创建新对象、释放不用对象，所以在这个过程中，会有新的不可达内存地址产生，而这部分的不可达内存是出现在标记过程结束之后，本轮 CMS 回收无法在周期内将它们回收掉，只能留在下次垃圾回收周期再清理掉。这样的垃圾就叫做浮动垃圾。由于垃圾收集和用户线程是并发执行的，因此 CMS 回收器不能像其他回收器那样进行内存回收，需要预留一些空间用来保存用户新创建的对象。由于 CMS 回收器在老年代中使用标记-清除的内存回收策略，势必会产生内存碎片，内存当碎片过多时，将会给大对象分配带来麻烦，往往会出现老年代还有空间但不能再保存对象的情况。</p><p>所以，早在几年前的 Java 9 中，就已经决定放弃使用 CMS 回收器了，而这次在 Java 14 中，是继之前 Java 9 中放弃使用 CMS 之后，彻底将其禁用，并删除与 CMS 有关的选项，同时清除与 CMS 有关的文档内容，至此曾经辉煌一度的 CMS 回收器，也将成为历史。</p><p>当在 Java 14 版本中，通过使用参数：<code>-XX:+UseConcMarkSweepGC</code>，尝试使用 CMS 时，将会收到下面信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">Java HotSpot(TM) 64-Bit Server VM warning: Ignoring option UseConcMarkSweepGC; \<br>support was removed in &lt;version&gt;<br></code></pre></td></tr></table></figure><h2 id="ZGC-支持-MacOS-和-Windows-系统（实验阶段）"><a href="#ZGC-支持-MacOS-和-Windows-系统（实验阶段）" class="headerlink" title="ZGC 支持 MacOS 和 Windows 系统（实验阶段）"></a>ZGC 支持 MacOS 和 Windows 系统（实验阶段）</h2><p>ZGC 是最初在 Java 11 中引入，同时在后续几个版本中，不断进行改进的一款基于内存 Region，同时使用了内存读屏障、染色指针和内存多重映射等技，并且以可伸缩、低延迟为目标的内存垃圾回收器器，不过在 Java 14 之前版本中，仅仅只支持在 Linux&#x2F;x64 位平台。</p><p>此次 Java 14，同时支持 MacOS 和 Windows 系统，解决了开发人员需要在桌面操作系统中使用 ZGC 的问题。</p><p>在 MacOS 和 Windows 下面开启 ZGC 的方式，需要添加如下 JVM 参数：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">-XX:+UnlockExperimentalVMOptions -XX:+UseZGC<br></code></pre></td></tr></table></figure><h2 id="弃用-ParallelScavenge-和-SerialOld-GC-的组合使用"><a href="#弃用-ParallelScavenge-和-SerialOld-GC-的组合使用" class="headerlink" title="弃用 ParallelScavenge 和 SerialOld GC 的组合使用"></a>弃用 ParallelScavenge 和 SerialOld GC 的组合使用</h2><p>由于 Parallel Scavenge 和 Serial Old 垃圾收集算法组合起来使用的情况比较少，并且在年轻代中使用并行算法，而在老年代中使用串行算法，这种并行、串行混搭使用的情况，本身已属罕见同时也很冒险。由于这两 GC 算法组合很少使用，却要花费巨大工作量来进行维护，所以在 Java 14 版本中，考虑将这两 GC 的组合弃用。</p><p>具体弃用情况如下，通过弃用组合参数：<code>-XX:+UseParallelGC -XX:-UseParallelOldGC</code>，来弃用年轻代、老年期中并行、串行混搭使用的情况；同时，对于单独使用参数：<code>-XX:-UseParallelOldGC</code> 的地方，也将显示该参数已被弃用的警告信息。</p><h2 id="文本块（第二预览版本）"><a href="#文本块（第二预览版本）" class="headerlink" title="文本块（第二预览版本）"></a>文本块（第二预览版本）</h2><p>Java 13 引入了文本块来解决多行文本的问题，文本块主要以三重双引号开头，并以同样的以三重双引号结尾终止，它们之间的任何内容都被解释为文本块字符串的一部分，包括换行符，避免了对大多数转义序列的需要，并且它仍然是普通的 java.lang.String 对象，文本块可以在 Java 中能够使用字符串的任何地方进行使用，而与编译后的代码没有区别，还增强了 Java 程序中的字符串可读性。并且通过这种方式，可以更直观地表示字符串，可以支持跨越多行，而且不会出现转义的视觉混乱，将可以广泛提高 Java 类程序的可读性和可写性。</p><p>Java 14 在 Java 13 引入的文本块的基础之上，新加入了两个转义符，分别是：\ 和 \s，这两个转义符分别表达涵义如下：</p><ul><li><code>\</code>：行终止符，主要用于阻止插入换行符；</li><li><code>\s</code>：表示一个空格。可以用来避免末尾的白字符被去掉。</li></ul><p>在 Java 13 之前，多行字符串写法为：</p><p>清单 11. 多行字符串写法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">literal</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Lorem ipsum dolor sit amet, consectetur adipiscing &quot;</span> +<br>                 <span class="hljs-string">&quot;elit, sed do eiusmod tempor incididunt ut labore &quot;</span> +<br>                 <span class="hljs-string">&quot;et dolore magna aliqua.&quot;</span>;<br></code></pre></td></tr></table></figure><p>在 Java 14 新引入两个转义符之后，上述内容可以写为：</p><p>清单 12. 多行文本块加上转义符的写法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">              Lorem ipsum dolor sit amet, consectetur adipiscing \</span><br><span class="hljs-string">              elit, sed do eiusmod tempor incididunt ut labore \</span><br><span class="hljs-string">              et dolore magna aliqua.\</span><br><span class="hljs-string">              &quot;&quot;&quot;</span>;<br></code></pre></td></tr></table></figure><p>上述两种写法，text 实际还是只有一行内容。</p><p>对于转义符：<code>\s</code>，用法如下，能够保证下列文本每行正好都是六个字符长度：</p><p>清单 13. 多行文本块加上转义符的写法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">colors</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">             red  \s</span><br><span class="hljs-string">            green\s</span><br><span class="hljs-string">             blue \s</span><br><span class="hljs-string">             &quot;&quot;&quot;</span>;<br></code></pre></td></tr></table></figure><p>Java 14 带来的这两个转义符，能够简化跨多行字符串编码问题，通过转义符，能够避免对换行等特殊字符串进行转移，从而简化代码编写，同时也增强了使用 String 来表达 HTML、XML、SQL 或 JSON 等格式字符串的编码可读性，且易于维护。</p><p>同时 Java 14 还对 String 进行了方法扩展：</p><ul><li><code>stripIndent()</code> ：用于从文本块中去除空白字符</li><li><code>translateEscapes()</code>：用于翻译转义字符</li><li><code>formatted(Object... args)</code>：用于格式化</li></ul><h2 id="结束语-2"><a href="#结束语-2" class="headerlink" title="结束语"></a>结束语</h2><p>Java 在更新版本周期为每半年发布一次之后，目前来看，确实是严格保持每半年更新的节奏。Java 14 版本的发布带来了不少新特性、功能实用性的增强、性能提升和 GC 方面的改进尝试。本文仅针对其中对使用人员影响较大的以及其中主要的特性做了介绍，如有兴趣，您还可以自行下载相关代码，继续深入研究。</p><p>本文转载自 <a href="https://developer.ibm.com/zh/technologies/java/articles/the-new-features-of-java-14/">https://developer.ibm.com/zh/technologies/java/articles/the-new-features-of-java-14/</a></p><h1 id="Java-15-特性详解"><a href="#Java-15-特性详解" class="headerlink" title="Java 15 特性详解"></a>Java 15 特性详解</h1><h2 id="Edwards-Curve-数字签名算法-EdDSA"><a href="#Edwards-Curve-数字签名算法-EdDSA" class="headerlink" title="Edwards-Curve 数字签名算法 (EdDSA)"></a>Edwards-Curve 数字签名算法 (EdDSA)</h2><p>Edwards-Curve 数字签名算法（EdDSA），一种根据 RFC 8032 规范所描述的 Edwards-Curve 数字签名算法（EdDSA）实现加密签名，实现了一种 RFC 8032 标准化方案，但它不能代替 ECDSA。</p><p>与 JDK 中的现有签名方案相比，EdDSA 具有更高的安全性和性能，因此备受关注。它已经在OpenSSL和BoringSSL等加密库中得到支持，在区块链领域用的比较多。</p><p>EdDSA是一种现代的椭圆曲线方案，具有JDK中现有签名方案的优点。EdDSA将只在SunEC提供商中实现。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// example: generate a key pair and sign</span><br><span class="hljs-type">KeyPairGenerator</span> <span class="hljs-variable">kpg</span> <span class="hljs-operator">=</span> KeyPairGenerator.getInstance(<span class="hljs-string">&quot;Ed25519&quot;</span>);<br><span class="hljs-type">KeyPair</span> <span class="hljs-variable">kp</span> <span class="hljs-operator">=</span> kpg.generateKeyPair();<br><span class="hljs-comment">// algorithm is pure Ed25519</span><br><span class="hljs-type">Signature</span> <span class="hljs-variable">sig</span> <span class="hljs-operator">=</span> Signature.getInstance(<span class="hljs-string">&quot;Ed25519&quot;</span>);<br>sig.initSign(kp.getPrivate());<br>sig.update(msg);<br><span class="hljs-type">byte</span>[] s = sig.sign();<br><br><span class="hljs-comment">// example: use KeyFactory to contruct a public key</span><br><span class="hljs-type">KeyFactory</span> <span class="hljs-variable">kf</span> <span class="hljs-operator">=</span> KeyFactory.getInstance(<span class="hljs-string">&quot;EdDSA&quot;</span>);<br><span class="hljs-type">boolean</span> <span class="hljs-variable">xOdd</span> <span class="hljs-operator">=</span> ...<br><span class="hljs-type">BigInteger</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> ...<br><span class="hljs-type">NamedParameterSpec</span> <span class="hljs-variable">paramSpec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NamedParameterSpec</span>(<span class="hljs-string">&quot;Ed25519&quot;</span>);<br><span class="hljs-type">EdECPublicKeySpec</span> <span class="hljs-variable">pubSpec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EdECPublicKeySpec</span>(paramSpec, <span class="hljs-keyword">new</span> <span class="hljs-title class_">EdPoint</span>(xOdd, y));<br><span class="hljs-type">PublicKey</span> <span class="hljs-variable">pubKey</span> <span class="hljs-operator">=</span> kf.generatePublic(pubSpec);<br></code></pre></td></tr></table></figure><h2 id="密封的类和接口（预览）"><a href="#密封的类和接口（预览）" class="headerlink" title="密封的类和接口（预览）"></a>密封的类和接口（预览）</h2><p>封闭类（预览特性），可以是封闭类和或者封闭接口，用来增强 Java 编程语言，<strong>防止其他类或接口扩展或实现它们</strong>。</p><p>因为我们引入了<code>sealed</code> <code>class</code>或<code>interfaces</code>，这些class或者interfaces只允许被指定的类或者interface进行扩展和实现。</p><p>使用修饰符<code>sealed</code>，您可以将一个类声明为密封类。密封的类使用reserved关键字permits列出可以直接扩展它的类。子类可以是最终的，非密封的或密封的。</p><p>之前我们的代码是这样的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123; &#125; <span class="hljs-comment">//人</span><br> <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span> &#123; &#125;<span class="hljs-comment">//教师</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Worker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span> &#123; &#125;  <span class="hljs-comment">//工人</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span>&#123; &#125; <span class="hljs-comment">//学生</span><br></code></pre></td></tr></table></figure><p>但是我们现在要限制 Person类 只能被这三个类继承，不能被其他类继承，需要这么做。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 添加sealed修饰符，permits后面跟上只能被继承的子类名称</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> permits Teacher, Worker, Student&#123; &#125; <span class="hljs-comment">//人</span><br> <br><span class="hljs-comment">// 子类可以被修饰为 final</span><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span> &#123; &#125;<span class="hljs-comment">//教师</span><br> <br><span class="hljs-comment">// 子类可以被修饰为 non-sealed，此时 Worker类就成了普通类，谁都可以继承它</span><br><span class="hljs-keyword">non-sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Worker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span> &#123; &#125;  <span class="hljs-comment">//工人</span><br><span class="hljs-comment">// 任何类都可以继承Worker</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AnyClass</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Worker</span>&#123;&#125;<br> <br><span class="hljs-comment">//子类可以被修饰为 sealed,同上</span><br><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Person</span> permits MiddleSchoolStudent,GraduateStudent&#123; &#125; <span class="hljs-comment">//学生</span><br> <br><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MiddleSchoolStudent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Student</span> &#123; &#125;  <span class="hljs-comment">//中学生</span><br> <br><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GraduateStudent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Student</span> &#123; &#125;  <span class="hljs-comment">//研究生</span><br></code></pre></td></tr></table></figure><p>很强很实用的一个特性，可以限制类的层次结构。</p><h2 id="隐藏类"><a href="#隐藏类" class="headerlink" title="隐藏类"></a>隐藏类</h2><p>隐藏类是为框架（frameworks）所设计的，隐藏类不能直接被其他类的字节码使用，只能在运行时生成类并通过反射间接使用它们。</p><p>该提案通过启用标准 API 来定义 无法发现 且 具有有限生命周期 的隐藏类，从而提高 JVM 上所有语言的效率。JDK内部和外部的框架将能够动态生成类，而这些类可以定义隐藏类。通常来说基于JVM的很多语言都有动态生成类的机制，这样可以提高语言的灵活性和效率。</p><ul><li>隐藏类天生为框架设计的，在运行时生成内部的class。</li><li>隐藏类只能通过反射访问，不能直接被其他类的字节码访问。</li><li>隐藏类可以独立于其他类加载、卸载，这可以减少框架的内存占用。</li></ul><p><strong>Hidden Classes是什么呢</strong>？</p><p>Hidden Classes就是不能直接被其他class的二进制代码使用的class。Hidden Classes主要被一些框架用来生成运行时类，但是这些类不是被用来直接使用的，而是通过反射机制来调用。</p><p>比如在JDK8中引入的lambda表达式，JVM并不会在编译的时候将lambda表达式转换成为专门的类，而是在运行时将相应的字节码动态生成相应的类对象。</p><p>另外使用动态代理也可以为某些类生成新的动态类。</p><p><strong>那么我们希望这些动态生成的类需要具有什么特性呢</strong>？</p><ul><li><strong>不可发现性</strong>。因为我们是为某些静态的类动态生成的动态类，所以我们希望把这个动态生成的类看做是静态类的一部分。所以我们不希望除了该静态类之外的其他机制发现。</li><li><strong>访问控制</strong>。我们希望在访问控制静态类的同时，也能控制到动态生成的类。</li><li><strong>生命周期</strong>。动态生成类的生命周期一般都比较短，我们并不需要将其保存和静态类的生命周期一致。</li></ul><p><strong>API的支持</strong></p><p>所以我们需要一些API来定义无法发现的且具有有限生命周期的隐藏类。这将提高所有基于JVM的语言实现的效率。</p><p>比如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">java.lang.reflect.Proxy <span class="hljs-comment">// 可以定义隐藏类作为实现代理接口的代理类。 </span><br>java.lang.invoke.StringConcatFactory <span class="hljs-comment">// 可以生成隐藏类来保存常量连接方法； </span><br>java.lang.invoke.LambdaMetaFactory <span class="hljs-comment">//可以生成隐藏的nestmate类，以容纳访问封闭变量的lambda主体； </span><br></code></pre></td></tr></table></figure><p>普通类是通过调用<code>ClassLoader::defineClass</code>创建的，而隐藏类是通过调用<code>Lookup::defineHiddenClass</code>创建的。这使JVM从提供的字节中派生一个隐藏类，链接该隐藏类，并返回提供对隐藏类的反射访问的查找对象。调用程序可以通过返回的查找对象来获取隐藏类的Class对象。</p><h2 id="移除Nashorn-JavaScript引擎"><a href="#移除Nashorn-JavaScript引擎" class="headerlink" title="移除Nashorn JavaScript引擎"></a>移除Nashorn JavaScript引擎</h2><p>移除了 Nashorn JavaScript 脚本引擎、APIs，以及 jjs 工具。这些早在 JDK 11 中就已经被标记为 deprecated 了，JDK 15 被移除就很正常了。</p><p><strong>Nashorn引擎是什么</strong>？</p><p>Nashorn 是 JDK 1.8 引入的一个 JavaScript 脚本引擎，用来取代 Rhino 脚本引擎。Nashorn 是 ECMAScript-262 5.1 的完整实现，增强了 Java 和 JavaScript 的兼容性，并且大大提升了性能。</p><p><strong>为什么要移除</strong>？</p><p>官方的描述是，随着 ECMAScript 脚本语言的结构、API 的改编速度越来越快，维护 Nashorn 太有挑战性了，所以……。</p><h2 id="重新实现-DatagramSocket-API"><a href="#重新实现-DatagramSocket-API" class="headerlink" title="重新实现 DatagramSocket API"></a>重新实现 DatagramSocket API</h2><p>重新实现了老的 DatagramSocket API 接口，更改了 java.net.DatagramSocket 和 java.net.MulticastSocket 为更加简单、现代化的底层实现，更易于维护和调试。</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/640" alt="图片"></p><p><code>java.net.datagram.Socket</code>和<code>java.net.MulticastSocket</code>的当前实现可以追溯到JDK 1.0，那时IPv6还在开发中。因此，当前的多播套接字实现尝试调和IPv4和IPv6难以维护的方式。</p><ul><li>通过替换 java.net.datagram 的基础实现，重新实现旧版 DatagramSocket API。</li><li>更改<code>java.net.DatagramSocket</code> 和 <code>java.net.MulticastSocket</code> 为更加简单、现代化的底层实现。提高了 JDK 的可维护性和稳定性。</li><li>通过将<code>java.net.datagram.Socket</code>和<code>java.net.MulticastSocket</code> API的底层实现替换为更简单、更现代的实现来重新实现遗留的DatagramSocket API。</li></ul><p><strong>新的实现</strong>：</p><ul><li>易于调试和维护;</li><li>与Project Loom中正在探索的虚拟线程协同。</li></ul><h2 id="禁用偏向锁定"><a href="#禁用偏向锁定" class="headerlink" title="禁用偏向锁定"></a>禁用偏向锁定</h2><p>准备禁用和废除偏向锁，在 JDK 15 中，默认情况下禁用偏向锁，并弃用所有相关的命令行选项。</p><p>在默认情况下禁用偏向锁定，并弃用所有相关命令行选项。目标是确定是否需要继续支持偏置锁定的 <strong>高维护成本</strong> 的遗留同步优化， HotSpot虚拟机使用该优化来减少非竞争锁定的开销。尽管某些Java应用程序在禁用偏向锁后可能会出现性能下降，但偏向锁的性能提高通常不像以前那么明显。</p><p>该特性默认禁用了<code>biased locking(-XX:+UseBiasedLocking)</code>，并且废弃了所有相关的命令行选型(<code>BiasedLockingStartupDelay</code>, <code>BiasedLockingBulkRebiasThreshold</code>, <code>BiasedLockingBulkRevokeThreshold</code>, <code>BiasedLockingDecayTime</code>, <code>UseOptoBiasInlining</code>, <code>PrintBiasedLockingStatistics</code> and <code>PrintPreciseBiasedLockingStatistics</code>)</p><h2 id="instanceof-自动匹配模式"><a href="#instanceof-自动匹配模式" class="headerlink" title="instanceof 自动匹配模式"></a>instanceof 自动匹配模式</h2><p>模式匹配（第二次预览），第一次预览是 JDK 14 中提出来的。</p><p>Java 14 之前：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (object <span class="hljs-keyword">instanceof</span> Kid) &#123;<br>    <span class="hljs-type">Kid</span> <span class="hljs-variable">kid</span> <span class="hljs-operator">=</span> (Kid) object;<br>    <span class="hljs-comment">// ...</span><br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (object <span class="hljs-keyword">instanceof</span> Kiddle) &#123;<br>    <span class="hljs-type">Kid</span> <span class="hljs-variable">kid</span> <span class="hljs-operator">=</span> (Kid) object;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>Java 14+：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (object <span class="hljs-keyword">instanceof</span> Kid kid) &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (object <span class="hljs-keyword">instanceof</span> Kiddle kiddle) &#123;<br>    <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>Java 15 并没有对此特性进行调整，继续预览特性，只是为了收集更多的用户反馈，可能还不成熟吧。</p><h2 id="垃圾回收器ZGC-可伸缩低延迟垃圾收集器"><a href="#垃圾回收器ZGC-可伸缩低延迟垃圾收集器" class="headerlink" title="垃圾回收器ZGC: 可伸缩低延迟垃圾收集器"></a>垃圾回收器ZGC: 可伸缩低延迟垃圾收集器</h2><p>ZGC是Java 11引入的新的垃圾收集器（JDK9以后默认的垃圾回收器是G1），经过了多个实验阶段，自此终于成为正式特性。ZGC是一个重新设计的并发的垃圾回收器，可以极大的提升GC的性能。支持任意堆大小而保持稳定的低延迟（10ms以内），性能非常可观。目前默认垃圾回收器仍然是 G1，后续很有可以能将ZGC设为默认垃圾回收器。之前需要通过<code>-XX:+UnlockExperimentalVMOptions -XX:+UseZGC</code>来启用ZGC，现在只需要<code>-XX:+UseZGC</code>就可以。</p><p>以下是相关介绍：</p><p>ZGC 是一个可伸缩的、低延迟的垃圾收集器，主要为了满足如下目标进行设计：</p><ul><li>GC 停顿时间不超过 10ms</li><li>即能处理几百 MB 的小堆，也能处理几个 TB 的大堆</li><li>应用吞吐能力不会下降超过 15%（与 G1 回收算法相比）</li><li>方便在此基础上引入新的 GC 特性和利用 colord</li><li>针以及 Load barriers 优化奠定基础</li><li>当前只支持 Linux&#x2F;x64 位平台 停顿时间在 10ms 以下，10ms 其实是一个很保守的数据，即便是 10ms 这个数据，也是 GC 调优几乎达不到的极值。根据 SPECjbb 2015 的基准测试，128G 的大堆下最大停顿时间才 1.68ms，远低于 10ms，和 G1 算法相比，改进非常明显。</li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/640" alt="图片"></p><p>本图片引用自：The Z Garbage Collector – An Introduction</p><p>不过目前 ZGC 还处于实验阶段，目前只在 Linux&#x2F;x64 上可用，如果有足够的需求，将来可能会增加对其他平台的支持。同时作为实验性功能的 ZGC 将不会出现在 JDK 构建中，除非在编译时使用 configure 参数：<code>--with-jvm-features=zgc</code> 显式启用。</p><p>在实验阶段，编译完成之后，已经迫不及待的想试试 ZGC，需要配置以下 JVM 参数，才能使用 ZGC，具体启动 ZGC 参数如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">-XX：+ UnlockExperimentalVMOptions -XX：+ UseZGC -Xmx10g<br></code></pre></td></tr></table></figure><p>其中参数：-Xmx 是 ZGC 收集器中最重要的调优选项，大大解决了程序员在 JVM 参数调优上的困扰。ZGC 是一个并发收集器，必须要设置一个最大堆的大小，应用需要多大的堆，主要有下面几个考量：</p><ul><li>对象的分配速率，要保证在 GC 的时候，堆中有足够的内存分配新对象。</li><li>一般来说，给 ZGC 的内存越多越好，但是也不能浪费内存，所以要找到一个平衡。</li></ul><h2 id="文本块-Text-Blocks"><a href="#文本块-Text-Blocks" class="headerlink" title="文本块(Text Blocks)"></a>文本块(Text Blocks)</h2><p>文本块，是一个多行字符串，它可以避免使用大多数转义符号，自动以可预测的方式格式化字符串，并让开发人员在需要时可以控制格式。</p><p>Text Blocks首次是在JDK 13中以预览功能出现的，然后在JDK 14中又预览了一次，终于在JDK 15中被确定下来，可放心使用了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">           SELECT * from USER \</span><br><span class="hljs-string">           WHERE `id` = 1 \</span><br><span class="hljs-string">           ORDER BY `id`, `name`;\</span><br><span class="hljs-string">           &quot;&quot;&quot;</span>;<br>    System.out.println(query);<br>&#125;<br></code></pre></td></tr></table></figure><p>运行程序，输出（可以看到展示为一行了）：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">USER</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-symbol">`id`</span> = <span class="hljs-number">1</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-symbol">`id`</span>, <span class="hljs-symbol">`name`</span>;<br></code></pre></td></tr></table></figure><p>####低暂停时间垃圾收集器 转正</p><blockquote><p>“</p><p>Shenandoah垃圾回收算法终于从实验特性转变为产品特性，这是一个从 JDK 12 引入的回收算法，该算法通过与正在运行的 Java 线程同时进行疏散工作来减少 GC 暂停时间。Shenandoah 的暂停时间与堆大小无关，无论堆栈是 200 MB 还是 200 GB，都具有相同的一致暂停时间。</p><p>”</p></blockquote><p><strong>怎么形容Shenandoah和ZGC的关系呢</strong>？异同点大概如下：</p><ul><li>相同点：性能几乎可认为是相同的</li><li>不同点：ZGC是Oracle JDK的。而Shenandoah只存在于OpenJDK中，因此使用时需注意你的JDK版本</li><li>打开方式：使用<code>-XX:+UseShenandoahGC</code>命令行参数打开。</li></ul><p>Shenandoah在JDK12被作为experimental引入，在JDK15变为Production；之前需要通过<code>-XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC</code>来启用，现在只需要<code>-XX:+UseShenandoahGC</code>即可启用</p><h2 id="移除了-Solaris-和-SPARC-端口。"><a href="#移除了-Solaris-和-SPARC-端口。" class="headerlink" title="移除了 Solaris 和 SPARC 端口。"></a>移除了 Solaris 和 SPARC 端口。</h2><p>移除了 Solaris&#x2F;SPARC、Solaris&#x2F;x64 和 Linux&#x2F;SPARC 端口的源代码及构建支持。这些端口在 JDK 14 中就已经被标记为 deprecated 了，JDK 15 被移除也不奇怪。</p><p>删除对Solaris&#x2F;SPARC、Solaris&#x2F;x64和Linux&#x2F;SPARC端口的源代码和构建支持，在JDK 14中被标记为废弃，在JDK15版本正式移除。许多正在开发的项目和功能（如Valhalla、Loom和Panama）需要进行重大更改以适应CPU架构和操作系统特定代码。</p><p>近年来，Solaris 和 SPARC 都已被 Linux 操作系统和英特尔处理器取代。放弃对 Solaris 和 SPARC 端口的支持将使 OpenJDK 社区的贡献者能够加速开发新功能，从而推动平台向前发展。</p><h2 id="外部存储器访问-API（孵化器版）"><a href="#外部存储器访问-API（孵化器版）" class="headerlink" title="外部存储器访问 API（孵化器版）"></a>外部存储器访问 API（孵化器版）</h2><p>外存访问 API（二次孵化），可以允许 Java 应用程序安全有效地访问 Java 堆之外的外部内存。</p><p>目的是引入一个 API，以允许 Java 程序安全、有效地访问 Java 堆之外的外部存储器。如本机、持久和托管堆。</p><p>有许多Java程序是访问外部内存的，比如Ignite和MapDB。该API将有助于避免与垃圾收集相关的成本以及与跨进程共享内存以及通过将文件映射到内存来序列化和反序列化内存内容相关的不可预测性 。该Java API目前没有为访问外部内存提供令人满意的解决方案。但是在新的提议中，API不应该破坏JVM的安全性。</p><p>Foreign-Memory Access API在JDK14被作为incubating API引入，在JDK15处于Second Incubator，提供了改进。</p><h2 id="Records-二次预览"><a href="#Records-二次预览" class="headerlink" title="Records (二次预览)"></a>Records (二次预览)</h2><p>Records 最早在 JDK 14 中成为预览特性，JDK 15 继续二次预览。</p><p><strong>如下内容来自Java14</strong></p><p>Record 类型允许在代码中使用紧凑的语法形式来声明类，而这些类能够作为不可变数据类型的封装持有者。Record 这一特性主要用在特定领域的类上；与枚举类型一样，Record 类型是一种受限形式的类型，主要用于存储、保存数据，并且没有其它额外自定义行为的场景下。</p><p>在以往开发过程中，被当作数据载体的类对象，在正确声明定义过程中，通常需要编写大量的无实际业务、重复性质的代码，其中包括：构造函数、属性调用、访问以及 equals() 、hashCode()、toString() 等方法，因此在 Java 14 中引入了 Record 类型，其效果有些类似 Lombok 的 @Data 注解、Kotlin 中的 data class，但是又不尽完全相同，它们的共同点都是类的部分或者全部可以直接在类头中定义、描述，并且这个类只用于存储数据而已。对于 Record 类型，具体可以用下面代码来说明：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String address;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>对上述代码进行编译，然后反编译之后可以看到如下结果：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">java</span>.lang.Record &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> java.lang.String name;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> java.lang.String age;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(java.lang.String name, java.lang.String age)</span> &#123; <span class="hljs-comment">/* compiled code */</span> &#125;<br><br>    <span class="hljs-keyword">public</span> java.lang.String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123; <span class="hljs-comment">/* compiled code */</span> &#125;<br><br>    <span class="hljs-keyword">public</span> java.lang.String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123; <span class="hljs-comment">/* compiled code */</span> &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123; <span class="hljs-comment">/* compiled code */</span> &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(java.lang.Object o)</span> &#123; <span class="hljs-comment">/* compiled code */</span> &#125;<br><br>    <span class="hljs-keyword">public</span> java.lang.String <span class="hljs-title function_">name</span><span class="hljs-params">()</span> &#123; <span class="hljs-comment">/* compiled code */</span> &#125;<br><br>    <span class="hljs-keyword">public</span> java.lang.String <span class="hljs-title function_">age</span><span class="hljs-params">()</span> &#123; <span class="hljs-comment">/* compiled code */</span> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>根据反编译结果，可以得出，当用 Record 来声明一个类时，该类将自动拥有下面特征：</p><ul><li>拥有一个构造方法</li><li>获取成员属性值的方法：name()、age()</li><li>hashCode() 方法和 euqals() 方法</li><li>toString() 方法</li><li>类对象和属性被 final 关键字修饰，不能被继承，类的示例属性也都被 final 修饰，不能再被赋值使用。</li><li>还可以在 Record 声明的类中定义静态属性、方法和示例方法。注意，不能在 Record 声明的类中定义示例字段，类也不能声明为抽象类等。</li></ul><p>可以看到，该预览特性提供了一种更为紧凑的语法来声明类，并且可以大幅减少定义类似数据类型时所需的重复性代码。</p><p>另外 Java 14 中为了引入 Record 这种新的类型，在 java.lang.Class 中引入了下面两个新方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">RecordComponent[] getRecordComponents()<br><span class="hljs-type">boolean</span> <span class="hljs-title function_">isRecord</span><span class="hljs-params">()</span><br></code></pre></td></tr></table></figure><p>其中 getRecordComponents() 方法返回一组 java.lang.reflect.RecordComponent 对象组成的数组，java.lang.reflect.RecordComponent也是一个新引入类，该数组的元素与 Record 类中的组件相对应，其顺序与在记录声明中出现的顺序相同，可以从该数组中的每个 RecordComponent 中提取到组件信息，包括其名称、类型、泛型类型、注释及其访问方法。</p><p>而 isRecord() 方法，则返回所在类是否是 Record 类型，如果是，则返回 true。</p><h2 id="废除-RMI-激活"><a href="#废除-RMI-激活" class="headerlink" title="废除 RMI 激活"></a>废除 RMI 激活</h2><p>RMI Activation被标记为Deprecate,将会在未来的版本中删除。RMI激活机制是RMI中一个过时的部分，<strong>自Java 8以来一直是可选的而非必选项</strong>。RMI激活机制增加了持续的维护负担。RMI的其他部分暂时不会被弃用。</p><p>RMI jdk1.2引入，EJB在RMI系统中，我们使用延迟激活。延迟激活将激活对象推迟到客户第一次使用（即第一次方法调用）之前。既然RMI Activation这么好用，为什么要废弃呢？</p><p>因为对于现代应用程序来说，分布式系统大部分都是基于Web的，web服务器已经解决了穿越防火墙，过滤请求，身份验证和安全性的问题，并且也提供了很多延迟加载的技术。</p><p>所以在现代应用程序中，RMI Activation已经很少被使用到了。并且在各种开源的代码库中，也基本上找不到RMI Activation的使用代码了。为了减少RMI Activation的维护成本，在JDK8中，RMI Activation被置为可选的。现在在JDK15中，终于可以废弃了。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li>OracleJDK 15 下载地址：</li></ul><p><a href="https://www.oracle.com/java/technologies/javase-downloads.html">https://www.oracle.com/java/technologies/javase-downloads.html</a></p><ul><li>OpenJDK 15 地址：</li></ul><p><a href="https://openjdk.java.net/projects/jdk/15/">https://openjdk.java.net/projects/jdk/15/</a></p><p>转自：&lt;pdai.tech&#x2F;md&#x2F;java&#x2F;java8up&#x2F;java15.html&gt;</p><h1 id="Java-16-特性详解"><a href="#Java-16-特性详解" class="headerlink" title="Java 16 特性详解"></a>Java 16 特性详解</h1><p>与 JDK 15 一样，JDK 16 也将是个短期版本，仅提供 6 个月的支持。预计于 2021 年 9 月发布的 JDK 17 将是一个长期支持（LTS）版本，会获得数年的支持。目前的 LTS 版本 JDK 11 则于 2018 年 9 月发布。</p><p>伴随着数千个性能、稳定性和安全性更新，Java 16 为用户提供了十七项主要的增强 &#x2F; 更改（称为 JDK 增强提案——JEP），包括三个孵化器模块和一个预览特性。</p><p>孵化器模块（Incubator Module）中引入了一些增强，这是一种将非最终 API 和非最终工具交给开发人员的方法，该方法允许用户提供反馈，从而改善 Java 平台的质量。</p><p>同样，一些增强被作为 Java SE 平台的预览特性、语言或 VM 特性引入，这些增强已完全指定、完全实现但不是永久性的。JDK 特性版本中提供了这些增强，以推动开发人员根据实际使用情况提供反馈，这可能会导致它们在将来的版本中永久保留。这为用户提供了及时反馈的机会，并让工具供应商有机会在大量 Java 开发人员在生产中使用特性之前为其提供支持。</p><p>Java 16 随附的 17 个 JEP 分为六个不同类别：</p><h2 id="新语言特性"><a href="#新语言特性" class="headerlink" title="新语言特性"></a>新语言特性</h2><p><strong>JEP 394，适用于 instanceof 的模式匹配</strong></p><p><strong>模式匹配</strong>（Pattern Matching）最早在 Java 14 中作为预览特性引入，在 Java 15 中还是预览特性。模式匹配通过对 instacneof 运算符进行模式匹配来增强 Java 编程语言。</p><p>模式匹配使程序中的通用逻辑（即从对象中有条件地提取组件）得以更简洁、更安全地表示。</p><p><strong>JEP 395，记录</strong></p><p>记录（Records）在 Java 14 和 Java 15 中作为预览特性引入。它提供了一种紧凑的语法来声明类，这些类是浅层不可变数据的透明持有者。这将大大简化这些类，并提高代码的可读性和可维护性。</p><p>JVM 改进</p><p><strong>JEP 376，ZGC 并发线程处理</strong></p><p>JEP 376 将 ZGC 线程栈处理从安全点转移到一个并发阶段，甚至在大堆上也允许在毫秒内暂停 GC 安全点。消除 ZGC 垃圾收集器中最后一个延迟源可以极大地提高应用程序的性能和效率。</p><p><strong>JEP 387，弹性元空间</strong></p><p>此特性可将未使用的 HotSpot 类元数据（即元空间，metaspace）内存更快速地返回到操作系统，从而减少元空间的占用空间。具有大量类加载和卸载活动的应用程序可能会占用大量未使用的空间。新方案将元空间内存按较小的块分配，它将未使用的元空间内存返回给操作系统来提高弹性，从而提高应用程序性能并降低内存占用。</p><p>新工具和库</p><p><strong>JEP 380，Unix-Domain 套接字通道</strong></p><p>Unix-domain 套接字一直是大多数 Unix 平台的一个特性，现在在 Windows 10 和 Windows Server 2019 也提供了支持。此特性为 java.nio.channels 包的套接字通道和服务器套接字通道 API 添加了 Unix-domain（AF_UNIX）套接字支持。它扩展了继承的通道机制以支持 Unix-domain 套接字通道和服务器套接字通道。Unix-domain 套接字用于同一主机上的进程间通信（IPC）。它们在很大程度上类似于 TCP&#x2F;IP，区别在于套接字是通过文件系统路径名而不是 Internet 协议（IP）地址和端口号寻址的。对于本地进程间通信，Unix-domain 套接字比 TCP&#x2F;IP 环回连接更安全、更有效。</p><p><strong>JEP 392，打包工具</strong></p><p>此特性最初是作为 Java 14 中的一个孵化器模块引入的，该工具允许打包自包含的 Java 应用程序。它支持原生打包格式，为最终用户提供自然的安装体验，这些格式包括 Windows 上的 msi 和 exe、macOS 上的 pkg 和 dmg，还有 Linux 上的 deb 和 rpm。它还允许在打包时指定启动时参数，并且可以从命令行直接调用，也可以通过 ToolProvider API 以编程方式调用。注意 jpackage 模块名称从 jdk.incubator.jpackage 更改为 jdk.jpackage。这将改善最终用户在安装应用程序时的体验，并简化了“应用商店”模型的部署。</p><p>为未来做好准备</p><p><strong>JEP 390，对基于值的类发出警告</strong></p><p>此特性将原始包装器类（java.lang.Integer、java.lang.Double 等）指定为基于值的（类似于 java.util.Optional 和 java.time.LocalDateTime），并在其构造器中添加 forRemoval（自 JDK 9 开始被弃用），这样会提示新的警告。在 Java 平台中尝试在任何基于值的类的实例上进行不正确的同步时，它会发出警告。</p><p>许多流行的开源项目已经在其源中删除了包装构造器调用来响应 Java 9 的弃用警告，并且鉴于“弃用移除”警告的紧迫性，我们可以期望更多开源项目跟上这一步伐。</p><p><strong>JEP 396，默认强封装 JDK 内部元素</strong></p><p>此特性会默认强封装 JDK 的所有内部元素，但关键内部 API（例如 sun.misc.Unsafe）除外。默认情况下，使用早期版本成功编译的访问 JDK 内部 API 的代码可能不再起作用。鼓励开发人员从使用内部元素迁移到使用标准 API 的方法上，以便他们及其用户都可以无缝升级到将来的 Java 版本。强封装由 JDK 9 的启动器选项–illegal-access 控制，到 JDK 15 默认改为 warning，从 JDK 16 开始默认为 deny。（目前）仍然可以使用单个命令行选项放宽对所有软件包的封装，将来只有使用–add-opens 打开特定的软件包才行。</p><p>孵化器和预览特性</p><p><strong>JEP 338，向量 API（孵化器）</strong></p><p>该孵化器 API 提供了一个 API 的初始迭代以表达一些向量计算，这些计算在运行时可靠地编译为支持的 CPU 架构上的最佳向量硬件指令，从而获得优于同等标量计算的性能，充分利用单指令多数据（SIMD）技术（大多数现代 CPU 上都可以使用的一种指令）。尽管 HotSpot 支持自动向量化，但是可转换的标量操作集有限且易受代码更改的影响。该 API 将使开发人员能够轻松地用 Java 编写可移植的高性能向量算法。</p><p><strong>JEP 389，外部链接器 API（孵化器）</strong></p><p>该孵化器 API 提供了静态类型、纯 Java 访问原生代码的特性，该 API 将大大简化绑定原生库的原本复杂且容易出错的过程。Java 1.1 就已通过 Java 原生接口（JNI）支持了原生方法调用，但并不好用。Java 开发人员应该能够为特定任务绑定特定的原生库。它还提供了外来函数支持，而无需任何中间的 JNI 粘合代码。</p><p><strong>JEP 393，外部存储器访问 API（第 3 个孵化器）</strong></p><p>在 Java 14 和 Java 15 中作为孵化器 API 引入的这个 API 使 Java 程序能够安全有效地对各种外部存储器（例如本机存储器、持久性存储器、托管堆存储器等）进行操作。它提供了外部链接器 API 的基础。</p><p><strong>JEP 397，密封类（第二预览）</strong></p><p>这个预览特性可以限制哪些类或接口可以扩展或实现它们；它允许类或接口的作者控制负责实现它的代码；它还提供了比访问修饰符更具声明性的方式来限制对超类的使用。它还通过对模式进行详尽的分析来支持模式匹配的未来发展。</p><p>提升 OpenJDK 开发人员的生产力</p><p>其余更改对 Java 开发人员（使用 Java 编写代码和运行应用程序的人员）不会直接可见，而只对 Java 开发人员（参与 OpenJDK 开发的人员）可见。</p><p><strong>JEP 347，启用 C++14 语言特性（在 JDK 源代码中）</strong></p><p>它允许在 JDK C++ 源代码中使用 C++14 语言特性，并提供在 HotSpot 代码中可以使用哪些特性的具体指导。在 JDK 15 中，JDK 中 C++ 代码使用的语言特性仅限于 C++98&#x2F;03 语言标准。它要求更新各种平台编译器的最低可接受版本</p><p><strong>JEP 357，从 Mercurial 迁移到 Git****；JEP 369，迁移到 GitHub</strong></p><p>这些 JEP 将 OpenJDK 社区的源代码存储库从 Mercurial（hg）迁移到 Git，并将它们托管在 GitHub 上以供 JDK 11 及更高版本使用，其中包括将 jcheck、webrev 和 defpath 工具等工具更新到 Git。Git 减小了元数据的大小（约 1&#x2F;4），可节省本地磁盘空间并减少克隆时间。与 Mercurial 相比，现代工具链可以更好地与 Git 集成。</p><p>Open JDK Git 存储库现在位于 <a href="https://github.com/openjdk">https://github.com/openjdk</a>。</p><p><strong>JEP 386，AlpineLinux 移植；JEP 388，Windows&#x2F;AArch64 移植</strong></p><p>这些 JEP 的重点不是移植工作本身，而是将它们集成到 JDK 主线存储库中；JEP 386 将 JDK 移植到 Alpine Linux 和其他使用 musl 作为 x64 上主要 C 库的发行版上。此外，JEP 388 将 JDK 移植到 Windows AArch64（ARM64）。</p><h2 id="工具链支持"><a href="#工具链支持" class="headerlink" title="工具链支持"></a>工具链支持</h2><p>工具链有助于提高开发人员的生产力。目前，对 Java 16 提供支持的 IDE 有 JetBrainsIDEA、EclipseIDE。</p><p>甲骨文表示，“我们继续欢迎领先的 IDE 供应商所做的努力，这些供应商的工具链解决方案为开发人员提供了对当前 Java 版本的支持”。</p><p>转自&lt;blog.csdn.net&#x2F;weixin_39787242&#x2F;article&#x2F;details&#x2F;114977845&gt;</p><h2 id="写在最后："><a href="#写在最后：" class="headerlink" title="写在最后："></a>写在最后：</h2><p>去年，Java 迎来 25 周年。根据 IDC 的最新报告“Java Turns 25”显示，超过 900 万名开发人员（全球专职开发人员中的 69%）在使用 Java——比其他任何语言都多。凭借自身不断提高平台性能、稳定性和安全性的能力，Java 一直是开发人员中最流行的编程语言，被誉为“宇宙第一语言”。</p><p>甲骨文在博文写道：</p><p>经过二十多年的持续创新，Java 一直在通过适应不断变化的技术格局来保持灵活性，同时维持平台独立性；通过保持向后兼容性来保证可靠性；在不牺牲安全性的前提下加速创新来保持优势。</p><h1 id="Java-17-特性详解"><a href="#Java-17-特性详解" class="headerlink" title="Java 17 特性详解"></a>Java 17 特性详解</h1><p>Java 开发工具包 (JDK) 17 将是一个长期支持 (LTS) 版本，预计来自 Oracle 的扩展支持将持续数年。该功能集定于 6 月 10 日冻结，届时 JDK 17 将进入初始阶段。作为 OpenJDK JDK 17 的一部分提交的功能包括：</p><ul><li><p>特定于上下文的反序列化过滤器允许应用程序通过调用 JVM 范围的过滤器工厂来配置特定于上下文和动态选择的反序列化过滤器，以便为每个序列化操作选择一个过滤器。在解释该提议背后的动机时，Oracle 表示反序列化不受信任的数据是一种固有的危险活动，因为传入数据流的内容决定了创建的对象、其字段的值以及它们之间的引用。在许多用途中，流中的字节是从未知、不受信任或未经身份验证的客户端接收的。通过仔细构建流，攻击者可以导致恶意执行任意类中的代码。如果对象构造具有改变状态或调用其他操作的副作用，则这些操作可能会危及应用程序对象的完整性，库对象和 Java 运行时。禁用序列化攻击的关键是防止任意类的实例被反序列化，从而防止直接或间接执行它们的方法。反序列化过滤器被引入Java 9使应用程序和库代码能够在反序列化之前验证传入的数据流。</p><p>代码java.io.ObjectInputFilter在创建反序列化流时提供验证逻辑。但是，依赖流的创建者来明确请求验证有局限性。JDK Enhancement Proposal 290通过引入可通过 API、系统属性或安全属性设置的 JVM 范围的反序列化过滤器解决了这些限制，但这种方法也有局限性，尤其是在复杂的应用程序中。更好的方法是配置每个流过滤器，这样它们就不需要每个流创建者的参与。计划中的增强应帮助开发人员为每个反序列化上下文和用例构建和应用适当的过滤器。</p></li><li><p>随着always-strict 浮点语义，浮点运算将变得始终严格，而不是同时具有严格浮点语义 ( strictfp) 和微妙不同的默认浮点语义。这将原始浮点语义恢复到语言和 VM中，匹配 Java 标准版 1.2 中引入严格和默认浮点模式之前的语义。这项工作的目标包括简化数字敏感库的开发，包括java.lang.Math和java.lang.StrictMath.</p><p>改变默认浮点语义的动力来自于原始Java语言和JVM语义之间的不良交互作用，以及流行的x86体系结构的x87浮点协处理器指令集的一些特性。在所有情况下匹配精确的浮点语义，包括非正规操作数和结果，需要大量额外指令的开销。在没有溢出或下溢的情况下匹配结果可以用较少的开销完成，而这正是javase1.2中引入的修改后的默认浮点语义所允许的。但是，大约从2001年开始在奔腾4和更高版本的处理器中发布的SSE2（第二代数据流单指令多数据扩展指令集）扩展可以以一种简单的方式支持严格的JVM浮点操作，而不会产生过多的开销。由于Intel和AMD支持SSE2和更高版本的扩展，这些扩展允许自然地支持严格浮点语义，因此使用不同于strict的默认浮点语义的技术动机已不复存在。</p></li><li><p>弃用安全管理器，准备在未来版本中移除。追溯到 Java 1.0，安全管理器一直是保护客户端 Java 代码的主要手段，很少用于保护服务器端代码。该提案的一个目标是评估是否需要新的 API 或机制来解决使用安全管理器的特定狭窄用例，例如阻塞System::exit。计划要求弃用安全管理器以与旧 Applet API 一起删除，该 API 也计划在 JDK 17 中弃用。</p></li><li><p>模式匹配switch预览版扩展了 Java 中的模式语言，允许switch针对多个模式测试表达式和语句，每个模式都有特定的操作。这使得复杂的面向数据的查询能够简洁而安全地表达。</p><p>此功能的目标包括扩展转换表达式和语句允许模式出现在case标签中，减轻了转换如果需要，引入两种模式：guarded patterns允许使用任意布尔表达式对模式匹配逻辑进行优化，以及parenthesized patterns解决了一些解析歧义。</p><p>在JDK 16，的运算符运算符被扩展为获取类型模式并执行模式匹配。提议的适度扩展允许简化熟悉的instanceof和cast习惯用法。</p></li><li><p>JDK 内部的强封装，除了关键的内部 API，如sun.misc.Unsafe，将不再可能通过单个命令行选项放松内部元素的强封装，这在 JDK 9 到 JDK 16 中是可行的。计划包括提高 JDK 的安全性和可维护性，并鼓励开发人员从内部元素迁移到标准 API。</p></li><li><p>删除远程方法调用 (RMI) 激活机制，同时保留 RMI 的其余部分。RMI 激活机制已过时和废弃，在JDK 15 中不推荐使用。</p></li><li><p>在外部函数和内存API引入了一个孵化器阶段，允许 Java 程序与 Java 运行时之外的代码和数据进行互操作。通过高效调用外部函数，即 JVM 之外的代码，安全访问外部内存，即非 JVM 管理的内存，API 使 Java 程序能够调用本地库和处理本地数据，而没有JNI（Java本机接口）的脆弱性和风险。</p></li><li><ul><li>提议的 API 是两个 API 的演变：外部内存访问 API 和外部链接器 API。<ul><li>外部内存访问 API 在 2019 年作为孵化 API 面向 Java 14，并在 Java 15 和 Java 16 中重新孵化。外部链接器 API 在 2020 年末面向 Java 16 作为孵化 API。API 计划的目标包括易用性、性能、通用性和安全性。</li></ul></li></ul></li><li><p>与平台无关的矢量 API作为孵化 API集成到JDK 16中，将在 JDK 17 中再次孵化，提供一种机制来表达矢量计算，这些计算在运行时可靠地编译为支持的 CPU 架构上的最佳矢量指令。这比等效的标量计算获得了更好的性能。在 JDK 17 中，向量 API 已针对性能和实现进行了增强，包括在字节向量与布尔数组之间进行转换的增强功能。</p></li><li><p>密封类和接口限制哪些其他类或接口可以扩展或实现它们。该提案的目标包括允许类或接口的作者控制由哪些代码负责实现它，提供一种比访问修饰符更具声明性的方式来限制超类的使用，并通过为模式的详尽分析提供基础来支持模式匹配的未来方向。</p></li><li><p>删除实验性 AOT 和 JIT 编译器，它们几乎没有使用，但需要大量维护工作。该计划要求维护 Java 级别的 JVM 编译器接口，以便开发人员可以继续使用外部构建的编译器版本进行 JIT 编译。AOT 编译（jaotc 工具）作为一个实验性特性被整合到JDK 9，它本身是用 Java 编写的，用于 AOT 编译。这些实验性功能未包含在JDK 16 中由 Oracle 发布的版本，没有人抱怨。根据规定的计划，将删除三个 JDK 模块：jdk.aot（jaotc 工具）；internal.vm.compiler，Graal 编译器；和 jdk.internal.vm.compiler.management，Graal MBean。与 AOT 编译相关的 HotSpot 代码也将被删除。</p></li><li><p>将 JDK 移植到 MacOS&#x2F;AArch64以响应Apple 将其 Macintosh 计算机从 x64 转换到 AArch64 的计划。适用于 Linux 的 Java 的 AArch64 端口已经存在，并且 Windows 的工作正在进行中。Java 构建者希望通过使用条件编译来重用来自这些端口的现有 AArch64 代码，这是 JDK 端口中的规范，以适应低级约定的差异，例如应用程序二进制接口和一组保留的处理器寄存器。MacOS&#x2F;AArch64 的更改可能会破坏现有的 Linux&#x2F;AArch64、Windows&#x2F;AArch64 和 MacOS&#x2F;x64 端口，但通过预集成测试将降低风险。</p></li><li><p>弃用 Applet API 以进行删除。这个 API 本质上是无关紧要的，因为所有 Web 浏览器供应商要么已经取消了对 Java 浏览器插件的支持，要么已经宣布了这样做的计划。Applet API 之前在 2017 年 9 月的java中已被弃用，但并未删除。</p></li><li><p>用于 MacOS 的新渲染管道，使用 Apple Metal API 作为使用已弃用 OpenGL API 的现有管道的替代方案。该提案旨在为使用 MacOS Metal 框架的 Java 2D API 提供功能齐全的渲染管道，并在 Apple 从未来版本的 MacOS 中删除 OpenGL API 时做好准备。该管道旨在与现有的 OpenGL 管道具有同等功能，在选定的应用程序和基准测试中具有相同或更好的性能。将创建适合当前 Java 2D 模型的干净架构。管道将与 OpenGL 管道共存直到过时。添加任何新的 Java 或 JDK API 并不是提案的目标。</p></li><li><p>增强的伪随机数生成器将为伪随机数生成器 (PRNG) 提供新的接口类型和实现，包括可跳转的 PRNG 和额外的一类可拆分 PRNG 算法 (LXM)。新接口RandomGenerator将为所有现有的和新的 PRNG 提供统一的 API。将提供四个专门的 RandomGenerator 接口。推动该计划的重点是 Java 伪随机数生成领域的多个改进领域。这项工作不需要提供许多其他 PRNG 算法的实现。但是已经添加了三种常用算法，这些算法已经广泛部署在其他编程语言环境中。该计划的目标包括：</p></li><li><ul><li>使在应用程序中交替使用各种 PRNG 算法变得更容易。<ul><li>改进了对基于流的编程的支持，提供了 PRNG 对象流。</li><li>消除现有 PRNG 类中的代码重复。</li><li>保留类的现有行为java.util.Random。</li></ul></li></ul></li></ul><p>9 月 14 日已被定为 JDK 17 的全面可用日期。生产版本之前将在 6 月和 7 月进行斜降阶段，并在 8 月发布候选版本。JDK 17 的早期访问开源版本可以在jdk.java.net上找到。</p><p>JDK 17 等 LTS 版本每三年发布一次。最后一个 LTS 版本JDK 11于 2018 年 9 月发布。Java 的新版本每六个月发布一次。</p><blockquote><p>JAVA 17 特性文章来源：<a href="https://www.jdon.com/56588">https://www.jdon.com/56588</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>java新特性</tag>
      
      <tag>java17</tag>
      
      <tag>java11</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>中国天气接口</title>
    <link href="/2022/10/11/%E4%B8%AD%E5%9B%BD%E5%A4%A9%E6%B0%94%E6%8E%A5%E5%8F%A3/"/>
    <url>/2022/10/11/%E4%B8%AD%E5%9B%BD%E5%A4%A9%E6%B0%94%E6%8E%A5%E5%8F%A3/</url>
    
    <content type="html"><![CDATA[<p>免费的天气API几乎都要申请令牌,之前的流行的中国天气网官方api接口<a href="http://wthrcdn.etouch.cn/weather_mini?city=%E5%8C%97%E4%BA%AC">http://wthrcdn.etouch.cn/weather_mini?city=北京</a>,也已经关闭了，但是我利用Fiddler对中国天气官网进行抓包后找到了新的接口</p><span id="more"></span><h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h1><p>免费的天气API几乎都要申请令牌,之前的流行的中国天气网官方api接口<a href="http://wthrcdn.etouch.cn/weather_mini?city=%E5%8C%97%E4%BA%AC">http://wthrcdn.etouch.cn/weather_mini?city=北京</a>,也已经关闭了，但是我利用Fiddler对中国天气官网进行抓包后找到了新的接口</p><p>这里提供一下我的解决思路</p><h1 id="2-新的中国天气网官方api接口"><a href="#2-新的中国天气网官方api接口" class="headerlink" title="2. 新的中国天气网官方api接口"></a>2. 新的中国天气网官方api接口</h1><h2 id="2-1-地址"><a href="#2-1-地址" class="headerlink" title="2.1 地址"></a>2.1 地址</h2><p>新的API地址: <a href="http://d1.weather.com.cn/dingzhi/101190101.html?_=1665469658464">http://d1.weather.com.cn/dingzhi/101190101.html?_=1665469658464</a></p><p>请求方式为GET</p><h2 id="2-2-参数"><a href="#2-2-参数" class="headerlink" title="2.2 参数"></a>2.2 参数</h2><p><strong>query参数</strong></p><p>问号后面的query参数名是下划线,值为查询的时间戳(13位),参数值不确定</p><p><strong>path参数</strong></p><p>还有一个path参数101190101,这个是城市的编码,可以去<a href="http://t.zoukankan.com/zhiqiangsimida-p-2774702.html">中国气象局城市编码</a>查询对应的编码</p><p><strong>header参数</strong></p><p>有一个固定请求头<code>Referer</code>,值为<code>http://www.weather.com.cn/</code></p><p>如果不加这个请求头,直接访问地址会返回403的</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221012152835878.png" alt="403"></p><h2 id="2-3-返回值"><a href="#2-3-返回值" class="headerlink" title="2.3 返回值"></a>2.3 返回值</h2><p>接口的返回值为一段js代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> cityDZ101190101 =&#123;<br>    <span class="hljs-string">&quot;weatherinfo&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;city&quot;</span>: <span class="hljs-string">&quot;101190101&quot;</span>,<br>        <span class="hljs-string">&quot;cityname&quot;</span>: <span class="hljs-string">&quot;南京&quot;</span>,<br>        <span class="hljs-string">&quot;fctime&quot;</span>: <span class="hljs-string">&quot;202210111100&quot;</span>,<br>        <span class="hljs-string">&quot;temp&quot;</span>: <span class="hljs-string">&quot;18℃&quot;</span>,<br>        <span class="hljs-string">&quot;tempn&quot;</span>: <span class="hljs-string">&quot;9℃&quot;</span>,<br>        <span class="hljs-string">&quot;weather&quot;</span>: <span class="hljs-string">&quot;晴&quot;</span>,<br>        <span class="hljs-string">&quot;weathercode&quot;</span>: <span class="hljs-string">&quot;d0&quot;</span>,<br>        <span class="hljs-string">&quot;weathercoden&quot;</span>: <span class="hljs-string">&quot;n0&quot;</span>,<br>        <span class="hljs-string">&quot;wd&quot;</span>: <span class="hljs-string">&quot;北风转东北风&quot;</span>,<br>        <span class="hljs-string">&quot;ws&quot;</span>: <span class="hljs-string">&quot;3-4级转&lt;3级&quot;</span><br>    &#125;<br>&#125;;<span class="hljs-keyword">var</span> alarmDZ101190101 =&#123;<br>    <span class="hljs-string">&quot;w&quot;</span>: []<br>&#125;<br></code></pre></td></tr></table></figure><p>有的朋友们可能纳闷了,一般接口不都是返回JSON格式的字符串吗,怎么这个返回的是一段JavaScript代码,其实这个是为了反爬虫的,之前老的API接口被太多人调用了,所以用了这个方法增加了接口调用的难度.</p><p>我们可以看见,这段js代码里面就两个对象,其中<code>cityDZ101190101</code>对象存放的就是我们需要的数据(<strong>注意:这个对象名并不是固定的,是”cityDZ+”城市编码”拼接而成的</strong>).但是我们没法直接拿来使用,我的解决方式是在java中调用JS引擎执行这段js代码,获取到我们需要的对象,对其进行解析</p><h1 id="3-java执行JS代码"><a href="#3-java执行JS代码" class="headerlink" title="3. java执行JS代码"></a>3. java执行JS代码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alan.demo;<br><br><span class="hljs-keyword">import</span> cn.hutool.http.HttpRequest;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;<br><br><span class="hljs-keyword">import</span> javax.script.ScriptEngine;<br><span class="hljs-keyword">import</span> javax.script.ScriptEngineManager;<br><span class="hljs-keyword">import</span> javax.script.ScriptException;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> tengguokun</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022-10-11 16:25:59</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ScriptException, NoSuchMethodException &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> HttpRequest.get(<span class="hljs-string">&quot;http://d1.weather.com.cn/dingzhi/101190101.html?_=1665479077835&quot;</span>).header(<br>                <span class="hljs-string">&quot;Referer&quot;</span>, <span class="hljs-string">&quot;http://www.weather.com.cn/&quot;</span>)<br>                .execute().body();<br>        <span class="hljs-comment">// 引擎管理者</span><br>        <span class="hljs-type">ScriptEngineManager</span> <span class="hljs-variable">scriptEngineManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScriptEngineManager</span>();<br>        <span class="hljs-comment">// 获取js引擎</span><br>        <span class="hljs-type">ScriptEngine</span> <span class="hljs-variable">jsEngine</span> <span class="hljs-operator">=</span> scriptEngineManager.getEngineByName(<span class="hljs-string">&quot;js&quot;</span>);<br>        <span class="hljs-comment">// 执行这段js代码</span><br>        jsEngine.eval(body);<br>        <span class="hljs-comment">// 获取js代码中的定义的对象</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">cityDZ101190101</span> <span class="hljs-operator">=</span> jsEngine.get(<span class="hljs-string">&quot;cityDZ101190101&quot;</span>);<br>        <span class="hljs-comment">// 解析为JSONObject,其实更推荐建一个专门的pojo类存放</span><br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObj</span> <span class="hljs-operator">=</span> (JSONObject)JSONObject.toJSON(cityDZ101190101);<br>        <span class="hljs-comment">// 获取返回值的weatherinfo对象</span><br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">weatherinfo</span> <span class="hljs-operator">=</span> jsonObj.getJSONObject(<span class="hljs-string">&quot;weatherinfo&quot;</span>);<br>        <span class="hljs-comment">// 获取温度</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> weatherinfo.getString(<span class="hljs-string">&quot;temp&quot;</span>);<br>        System.out.println(jsonObj.toJSONString());<br>        System.out.println(<span class="hljs-string">&quot;当前温度为:&quot;</span>+temp);<br>        <br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>可以获取到我们需要的所有数据</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20221011172029210.png" alt="debug结果"></p>]]></content>
    
    
    <categories>
      
      <category>记录</category>
      
    </categories>
    
    
    <tags>
      
      <tag>天气</tag>
      
      <tag>爬虫</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>redis入门</title>
    <link href="/2022/09/26/redis/"/>
    <url>/2022/09/26/redis/</url>
    
    <content type="html"><![CDATA[<p>redis常用命名,java中使用redis,springboot整合redis,redis工具类</p><span id="more"></span><h1 id="1-Nosql概述"><a href="#1-Nosql概述" class="headerlink" title="1. Nosql概述"></a>1. Nosql概述</h1><h2 id="1-1-为什么要用Nosql"><a href="#1-1-为什么要用Nosql" class="headerlink" title="1.1 为什么要用Nosql"></a>1.1 为什么要用Nosql</h2><p>大数据时代,一般的数据库无法进行分析处理</p><blockquote><p>1、单机Mysql时代</p></blockquote><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20211026135701807.png" alt="image-20211026135701807"></p><p>90年代,一个网站的访问量一般不会太大，单个数据库完全够用。</p><p>随着用户增多，网站出现以下问题</p><ol><li>数据量增加到一定程度，一个数据库就放不下了</li><li>数据的索引（B+ Tree）,一个机器内存也存放不下</li><li>访问量变大后（读写混合），一台服务器承受不住</li></ol><p>主要出现三种之一,就必须晋级.</p><blockquote><p>2、Memcached(缓存) + Mysql + 垂直拆分（读写分离）</p></blockquote><p>网站80%的情况都是在读，每次都要去查询数据库的话就十分的麻烦！所以说我们希望减轻数据库的压力，我们可以使用缓存来保证效率</p><p>优化过程经历了以下几个过程：</p><ol><li>优化数据库的数据结构和索引(难度大)</li><li>文件缓存，通过IO流获取比每次都访问数据库效率略高，但是流量爆炸式增长时候，IO流也承受不了</li><li>MemCache,当时最热门的技术，通过在数据库和数据库访问层之间加上一层缓存，第一次访问时查询数据库，将结果保存到缓存，后续的查询先检查缓存，若有直接拿去使用，效率显著提升</li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20211026140305097.png" alt="image-20211026140305097"></p><blockquote><p>3、分库分表 + 水平拆分 + Mysql集群</p></blockquote><p>&#x3D;&#x3D;数据库的本质:读,写&#x3D;&#x3D;</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20211026140727572.png" alt="image-20211026140727572"></p><blockquote><p>4、如今最近的年代</p></blockquote><p>如今信息量井喷式增长，各种各样的数据出现（用户定位数据，图片数据等），大数据的背景下关系型数据库（RDBMS）无法满足大量数据要求(数据量很多,变化很快)。Nosql数据库就能轻松解决这些问题。</p><p>图形数据库</p><p>JSON当数据库</p><blockquote><p>目前一个基本的互联网项目</p></blockquote><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20211026142014646.png" alt="image-20211026142014646"></p><blockquote><p>为什么要用NoSQL ？</p></blockquote><p>用户的个人信息，社交网络，地理位置。用户自己产生的数据，用户日志等等爆发式增长！<br>这时候我们就需要使用NoSQL数据库的，Nosql可以很好的处理以上的情况！</p><h2 id="1-2-什么是Nosql"><a href="#1-2-什么是Nosql" class="headerlink" title="1.2 什么是Nosql"></a>1.2 什么是Nosql</h2><p>NoSQL &#x3D; Not Only SQL（不仅仅是SQL）</p><p>Not Only Structured Query Language</p><p><strong>关系型数据库：</strong>列+行，同一个表下数据的结构是一样的。</p><p><strong>非关系型数据库：</strong>数据存储没有固定的格式，并且可以进行横向扩展。</p><p>NoSQL泛指非关系型数据库，随着web2.0互联网的诞生，传统的关系型数据库很难对付web2.0时代！尤其是超大规模的高并发的社区，暴露出来很多难以克服的问题，NoSQL在当今大数据环境下发展的十分迅速，Redis是发展最快的。</p><p>很多数据类型用户的个人信息,社交网络,地理位置,不需要存储固定格式,需要横向扩展</p><h2 id="1-3-Nosql特点"><a href="#1-3-Nosql特点" class="headerlink" title="1.3 Nosql特点"></a>1.3 Nosql特点</h2><ol><li>方便扩展（数据之间没有关系，很好扩展！）</li><li>大数据量高性能（Redis一秒可以写8万次，读11万次，NoSQL的缓存记录级，是一种细粒度的缓存，性能会比较高！）</li><li>数据类型是多样型的！（不需要事先设计数据库，随取随用）</li></ol><blockquote><p> 传统的 RDBMS 和 NoSQL</p></blockquote><p><strong>传统的 RDBMS(关系型数据库)</strong></p><ul><li>结构化组织</li><li>SQL</li><li>数据和关系都存在单独的表中 row col</li><li>操作，数据定义语言</li><li>严格的一致性</li><li>基础的事务</li><li>…</li></ul><p><strong>NoSQL</strong></p><ul><li>不仅仅是数据</li><li>没有固定的查询语言</li><li>键值对存储，列存储，文档存储，图形数据库（社交关系）</li><li>最终一致性</li><li>CAP定理和BASE(异地多话)</li><li>高性能，高可用，高扩展</li><li>…</li></ul><blockquote><p>了解:3v+3高</p></blockquote><p>大数据时代的3V ：主要是<strong>描述问题</strong>的</p><ol><li>海量Velume</li><li>多样Variety</li><li>实时Velocity</li></ol><p>大数据时代的3高 ： 主要是<strong>对程序的要求</strong></p><ol><li>高并发</li><li>高可扩</li><li>高性能</li></ol><p>真正在公司中的实践：NoSQL + RDBMS 一起使用才是最强的。</p><hr><h2 id="1-4-NoSQL的四大分类"><a href="#1-4-NoSQL的四大分类" class="headerlink" title="1.4 NoSQL的四大分类"></a>1.4 NoSQL的四大分类</h2><blockquote><p><strong>KV键值对</strong></p></blockquote><ul><li>新浪：<strong>Redis</strong></li><li>美团：Redis + Tair</li><li>阿里、百度：Redis + Memcache</li></ul><blockquote><p><strong>文档型数据库（bson数据格式）：</strong></p></blockquote><ul><li>MongoDB(掌握)<ul><li>基于分布式文件存储的数据库。C++编写，用于处理大量文档。</li><li>MongoDB是RDBMS和NoSQL的中间产品。MongoDB是非关系型数据库中功能最丰富的，NoSQL中最像关系型数据库的数据库。</li></ul></li><li>ConthDB</li></ul><blockquote><p><strong>列存储数据库</strong></p></blockquote><ul><li><strong>HBase</strong>(大数据必学)</li><li>分布式文件系统</li></ul><blockquote><p><strong>图关系数据库</strong></p></blockquote><p>存的不是图形,放的是关系.用于广告推荐，社交网络</p><ul><li><strong>Neo4j</strong>、InfoGrid</li></ul><p><strong>对比:</strong></p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20211026171455333.png" alt="image-20211026171455333"></p><hr><h1 id="2-Redis入门"><a href="#2-Redis入门" class="headerlink" title="2. Redis入门"></a>2. Redis入门</h1><h2 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h2><blockquote><p>Redis是什么?</p></blockquote><p>Redis（Remote Dictionary Server )，即远程字典服务。</p><p>是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</p><p>与memcached一样，为了保证效率，数据都是缓存在内存中。区别的是redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了master-slave(主从)同步。</p><blockquote><p>Redis能该干什么？</p></blockquote><ol><li>内存存储、持久化，内存是断电即失的，所以需要持久化（RDB、AOF）</li><li>高效率、用于高速缓冲</li><li>发布订阅系统</li><li>地图信息分析</li><li>计时器、计数器(eg：浏览量)</li><li>…</li></ol><blockquote><p>特性</p></blockquote><ol><li>多样的数据类型</li><li>持久化</li><li>集群</li><li>事务</li><li>….</li></ol><hr><h2 id="2-2-安装"><a href="#2-2-安装" class="headerlink" title="2.2 安装"></a>2.2 安装</h2><p>官网：<a href="https://redis.io/">https://redis.io/</a></p><p>推荐使用Linux服务器学习。</p><p>&#x3D;&#x3D;注意:windows版本在GitHub下载(windows的Redis已经停更很久了…)&#x3D;&#x3D;</p><h3 id="2-2-1-Windows安装"><a href="#2-2-1-Windows安装" class="headerlink" title="2.2.1 Windows安装"></a>2.2.1 Windows安装</h3><p><a href="https://github.com/dmajkic/redis">https://github.com/dmajkic/redis</a></p><ol><li>下载安装包</li><li>解压(只有5M)</li><li>开启Redis,双击运行服务即可</li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20211026172923132.png" alt="image-20211026172923132"></p><ol start="4"><li>使用redis客户端来连接redis</li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20211026173039422.png" alt="image-20211026173039422"></p><p>记住一句话:windows下使用确实简单,但是redis推荐使用linux</p><hr><h3 id="2-2-2-Linux安装"><a href="#2-2-2-Linux安装" class="headerlink" title="2.2.2 Linux安装"></a>2.2.2 Linux安装</h3><ol><li>下载安装包</li><li>解压,一般放&#x2F;opt下</li><li>基本环境安装</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install gcc-c++<br><span class="hljs-meta prompt_"># </span><span class="language-bash">然后进入redis目录下执行</span><br>make<br><span class="hljs-meta prompt_"># </span><span class="language-bash">然后执行</span><br>make install<br></code></pre></td></tr></table></figure><ol start="4"><li><p>redis默认安装路径<code>/usr/local/bin</code></p></li><li><p>在redis安装同级目录下创建目录<code>/usr/local/bin/tgkRedisConfig</code>,将redis配置文件复制进去</p></li><li><p>redis默认不是后台启动,修改配置文件</p></li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20211026174049969.png" alt="image-20211026174049969"></p><ol start="7"><li>通过定制的配置文件启动redis服务(tgkRedisConfig&#x2F;redis.conf)</li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20211026174136141.png" alt="image-20211026174136141"></p><ol start="8"><li>使用redis-cli连接指定的端口号测试，Redis的默认端口6379</li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20211026174256669.png" alt="image-20211026174256669"></p><ol start="9"><li>查看redis进程是否开启</li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20211026174345715.png" alt="image-20211026174345715"></p><ol start="10"><li>关闭redis服务<code>shutdown</code></li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20211026174413068.png" alt="image-20211026174413068"></p><hr><h2 id="2-3-测试性能"><a href="#2-3-测试性能" class="headerlink" title="2.3 测试性能"></a>2.3 测试性能</h2><p><strong>redis-benchmark：</strong>Redis官方提供的性能测试工具，参数选项如下：</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20211026174538269.png" alt="image-20211026174538269"></p><p><strong>简单测试</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">测试：100个并发连接 100000请求</span><br>redis-benchmark -h localhost -p 6379 -c 100 -n 100000<br>12<br></code></pre></td></tr></table></figure><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20211026174833284.png" alt="image-20211026174833284"></p><hr><h1 id="3-Redis基础知识"><a href="#3-Redis基础知识" class="headerlink" title="3. Redis基础知识"></a>3. Redis基础知识</h1><blockquote><p>redis默认有16个数据库</p></blockquote><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20220312152622326.png" alt="image-20220312152622326"></p><p>默认使用的是第0个,</p><p><strong>可以使用select进行切换数据库</strong></p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">6379</span>&gt; select <span class="hljs-number">3</span> // 切换数据库<br>OK<br><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">6379</span>[<span class="hljs-number">3</span>]&gt; dbsize // 查看当前数据库大小<br>(integer) <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p><strong>清空数据库</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[3]&gt; flushall<br>OK<br></code></pre></td></tr></table></figure><p><strong>情况全部数据库内容</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[3]&gt; flushdb<br>OK<br></code></pre></td></tr></table></figure><p><strong>redis是单线程的</strong></p><p>redis很快,基于内存,cpu不是redis的性能瓶颈,redis的瓶颈是内存和网络带宽</p><p><strong>redis是c语言写的</strong>,官方提供的数据为100000+QPS,比同样是key-value的memecache差</p><p><strong>为什么单线程那么快</strong></p><p>&#x3D;&#x3D;误区&#x3D;&#x3D;:</p><ol><li>高性能的服务器不一定是多线程</li><li>多线程(CPU上下文切换)不一定比单线程效率高</li></ol><p>redis将所有数据放入内存,肯定是单线程最快</p><p><strong>查看所有key</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">keys *<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379&gt; keys *<br> 1) &quot;sys_dict:sys_job_group&quot;<br> 2) &quot;sys_config:sys.index.skinName&quot;<br> 3) &quot;sys_dict:sys_common_status&quot;<br> 4) &quot;sys_dict:sys_normal_disable&quot;<br> 5) &quot;sys_config:sys.index.sideTheme&quot;<br> 6) &quot;sys_dict:sys_job_status&quot;<br> 7) &quot;sys_config:sys.user.initPassword&quot;<br> 8) &quot;mylist&quot;<br> 9) &quot;counter:__rand_int__&quot;<br>10) &quot;sys_config:sys.account.captchaOnOff&quot;<br>11) &quot;sys_config:sys.account.registerUser&quot;<br>12) &quot;sys_dict:sys_oper_type&quot;<br>13) &quot;myhash&quot;<br>14) &quot;sys_dict:sys_notice_status&quot;<br>15) &quot;name&quot;<br>16) &quot;sys_dict:sys_notice_type&quot;<br>17) &quot;sys_dict:sys_yes_no&quot;<br>18) &quot;key:__rand_int__&quot;<br>19) &quot;sys_dict:sys_show_hide&quot;<br>20) &quot;sys_dict:sys_user_sex&quot;<br></code></pre></td></tr></table></figure><h1 id="4-redis五个数据类型"><a href="#4-redis五个数据类型" class="headerlink" title="4. redis五个数据类型"></a>4. redis五个数据类型</h1><h2 id="4-1-Redis-Key"><a href="#4-1-Redis-Key" class="headerlink" title="4.1 Redis-Key"></a>4.1 Redis-Key</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379&gt; keys * # 查看所有的key<br>(empty list or set)<br>127.0.0.1:6379&gt; set name kuangshen # set key<br>OK<br>127.0.0.1:6379&gt; keys *<br>1) &quot;name&quot;<br>127.0.0.1:6379&gt; set age 1<br>OK<br>127.0.0.1:6379&gt; keys *<br>1) &quot;age&quot;<br>2) &quot;name&quot;<br>127.0.0.1:6379&gt; EXISTS name # 判断当前的key是否存在<br>(integer) 1<br>127.0.0.1:6379&gt; EXISTS name1<br>(integer) 0<br>127.0.0.1:6379&gt; move name 1 # 移除当前数据库的key 1代表数据库<br>(integer) 1<br>127.0.0.1:6379&gt; keys *<br>1) &quot;age&quot;<br>127.0.0.1:6379&gt; set name qinjiang<br>OK<br>127.0.0.1:6379&gt; keys *<br>1) &quot;age&quot;<br>2) &quot;name&quot;<br>127.0.0.1:6379&gt; clear<br>127.0.0.1:6379&gt; keys *<br>1) &quot;age&quot;<br>2) &quot;name&quot;<br>127.0.0.1:6379&gt; get name<br>&quot;qinjiang&quot;<br>127.0.0.1:6379&gt; EXPIRE name 10 # 设置key的过期时间，单位是秒<br>(integer) 1<br>127.0.0.1:6379&gt; ttl name # 查看当前key的剩余时间<br>(integer) 4<br>127.0.0.1:6379&gt; ttl name<br>(integer) 3<br>127.0.0.1:6379&gt; ttl name<br>(integer) 2<br>127.0.0.1:6379&gt; ttl name<br>(integer) 1<br>127.0.0.1:6379&gt; ttl name<br>(integer) -2<br>127.0.0.1:6379&gt; get name<br>(nil)<br>127.0.0.1:6379&gt; type name # 查看当前key的一个类型！<br>string<br>127.0.0.1:6379&gt; type age<br>string<br></code></pre></td></tr></table></figure><h2 id="4-2-String（字符串）"><a href="#4-2-String（字符串）" class="headerlink" title="4.2 String（字符串）"></a>4.2 String（字符串）</h2><p><strong>90% 的 java程序员使用 redis 只会使用一个String类型！</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#########################################################################</span></span><br>127.0.0.1:6379&gt; set key1 v1 # 设置值<br>OK<br>127.0.0.1:6379&gt; get key1 # 获得值<br>&quot;v1&quot;<br>127.0.0.1:6379&gt; keys * # 获得所有的key<br>1) &quot;key1&quot;<br>127.0.0.1:6379&gt; EXISTS key1 # 判断某一个key是否存在<br>(integer) 1<br>127.0.0.1:6379&gt; APPEND key1 &quot;hello&quot; # 追加字符串，如果当前key不存在，就相当于setkey<br>(integer) 7<br>127.0.0.1:6379&gt; get key1<br>&quot;v1hello&quot;<br>127.0.0.1:6379&gt; STRLEN key1 # 获取字符串的长度！<br>(integer) 7<br>127.0.0.1:6379&gt; APPEND key1 &quot;,kaungshen&quot;<br>(integer) 17<br>127.0.0.1:6379&gt; STRLEN key1<br>(integer) 17<br>127.0.0.1:6379&gt; get key1<br>&quot;v1hello,kaungshen&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#########################################################################</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">i++</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">步长 i+=</span><br>127.0.0.1:6379&gt; set views 0 # 初始浏览量为0<br>OK<br>127.0.0.1:6379&gt; get views<br>&quot;0&quot;<br>127.0.0.1:6379&gt; incr views # 自增1 浏览量变为1<br>(integer) 1<br>127.0.0.1:6379&gt; incr views<br>(integer) 2<br>127.0.0.1:6379&gt; get views<br>&quot;2&quot;<br>127.0.0.1:6379&gt; decr views # 自减1 浏览量-1<br>(integer) 1<br>127.0.0.1:6379&gt; decr views<br>(integer) 0<br>127.0.0.1:6379&gt; decr views<br>(integer) -1<br>127.0.0.1:6379&gt; get views<br>&quot;-1&quot;<br>127.0.0.1:6379&gt; INCRBY views 10 # 可以设置步长，指定增量！<br>(integer) 9<br>127.0.0.1:6379&gt; INCRBY views 10<br>(integer) 19<br>127.0.0.1:6379&gt; DECRBY views 5<br>(integer) 14<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#########################################################################</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">字符串范围 range</span><br>127.0.0.1:6379&gt; set key1 &quot;hello,kuangshen&quot; # 设置 key1 的值<br>OK<br>127.0.0.1:6379&gt; get key1<br>&quot;hello,kuangshen&quot;<br>127.0.0.1:6379&gt; GETRANGE key1 0 3 # 截取字符串 [0,3]<br>&quot;hell&quot;<br>127.0.0.1:6379&gt; GETRANGE key1 0 -1 # 获取全部的字符串 和 get key是一样的<br>&quot;hello,kuangshen&quot;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">替换！</span><br>127.0.0.1:6379&gt; set key2 abcdefg<br>OK<br>127.0.0.1:6379&gt; get key2<br>&quot;abcdefg&quot;<br>127.0.0.1:6379&gt; SETRANGE key2 1 xx # 替换指定位置开始的字符串！<br>(integer) 7<br>127.0.0.1:6379&gt; get key2<br>&quot;axxdefg&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#########################################################################</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">setex (<span class="hljs-built_in">set</span> with expire) <span class="hljs-comment"># 设置过期时间</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">setnx (<span class="hljs-built_in">set</span> <span class="hljs-keyword">if</span> not exist) <span class="hljs-comment"># 不存在,再设置 （在分布式锁中会常常使用！）</span></span><br>127.0.0.1:6379&gt; setex key3 30 &quot;hello&quot; # 设置key3 的值为 hello,30秒后过期<br>OK<br>127.0.0.1:6379&gt; ttl key3<br>(integer) 26<br>127.0.0.1:6379&gt; get key3<br>&quot;hello&quot;<br>127.0.0.1:6379&gt; setnx mykey &quot;redis&quot; # 如果mykey 不存在，创建mykey<br>(integer) 1<br>127.0.0.1:6379&gt; keys *<br>1) &quot;key2&quot;<br>2) &quot;mykey&quot;<br>3) &quot;key1&quot;<br>127.0.0.1:6379&gt; ttl key3<br>(integer) -2<br>127.0.0.1:6379&gt; setnx mykey &quot;MongoDB&quot; # 如果mykey存在，创建失败！<br>(integer) 0<br>127.0.0.1:6379&gt; get mykey<br>&quot;redis&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#########################################################################</span></span><br>mset<br>mget<br>127.0.0.1:6379&gt; mset k1 v1 k2 v2 k3 v3 # 同时设置多个值<br>OK<br>127.0.0.1:6379&gt; keys *<br>1) &quot;k1&quot;<br>2) &quot;k2&quot;<br>3) &quot;k3&quot;<br>127.0.0.1:6379&gt; mget k1 k2 k3 # 同时获取多个值<br>1) &quot;v1&quot;<br>2) &quot;v2&quot;<br>3) &quot;v3&quot;<br>127.0.0.1:6379&gt; msetnx k1 v1 k4 v4 # msetnx 是一个原子性的操作，要么一起成功，要么一起<br>失败！<br>(integer) 0<br>127.0.0.1:6379&gt; get k4<br>(nil)<br><span class="hljs-meta prompt_"># </span><span class="language-bash">对象</span><br>set user:1 &#123;name:zhangsan,age:3&#125; # 设置一个user:1 对象 值为 json字符来保存一个对象！<br><span class="hljs-meta prompt_"># </span><span class="language-bash">这里的key是一个巧妙的设计： user:&#123;<span class="hljs-built_in">id</span>&#125;:&#123;filed&#125; , 如此设计在Redis中是完全OK了！</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">但是完全可以用<span class="hljs-built_in">hash</span>做,<span class="hljs-built_in">hash</span>专门存键值对的</span><br>127.0.0.1:6379&gt; mset user:1:name zhangsan user:1:age 2<br>OK<br>127.0.0.1:6379&gt; mget user:1:name user:1:age<br>1) &quot;zhangsan&quot;<br>2) &quot;2&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#########################################################################</span></span><br>getset # 先get然后在set<br>127.0.0.1:6379&gt; getset db redis # 如果不存在值，则返回 nil<br>(nil)<br>127.0.0.1:6379&gt; get db<br>&quot;redis<br>127.0.0.1:6379&gt; getset db mongodb # 如果存在值，获取原来的值，并设置新的值<br>&quot;redis&quot;<br>127.0.0.1:6379&gt; get db<br>&quot;mongodb&quot;<br><br></code></pre></td></tr></table></figure><p>数据结构是相同的！ String类似的使用场景：value除了是我们的字符串还可以是我们的数字！</p><ul><li>计数器</li><li>统计多单位的数量</li><li>粉丝数</li><li>对象缓存存储！</li></ul><h2 id="4-3-list-列表"><a href="#4-3-list-列表" class="headerlink" title="4.3 list 列表"></a>4.3 list 列表</h2><p>基本的数据类型,列表</p><p>在redis里面,可以把list完成栈,队列,阻塞队列</p><p>所有的list命令都死用l开头的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[2]&gt; lpush list one  # 从列表头部插入<br>(integer) 1<br>127.0.0.1:6379[2]&gt; lpush list two<br>(integer) 2<br>127.0.0.1:6379[2]&gt; lpush list three<br>(integer) 3<br>127.0.0.1:6379[2]&gt; lrange list 0 -1<br>1) &quot;three&quot;<br>2) &quot;two&quot;<br>3) &quot;one&quot;<br>127.0.0.1:6379[2]&gt; rpush list four  # 从尾部插入<br>(integer) 4<br>127.0.0.1:6379[2]&gt; lrange list 0 -1<br>1) &quot;three&quot;<br>2) &quot;two&quot;<br>3) &quot;one&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#########################################################################</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">移除 lpop rpop</span><br>127.0.0.1:6379[2]&gt; lpop list  # 移除头部第一个<br>&quot;three&quot;<br>127.0.0.1:6379[2]&gt; rpop list # 移除尾部的第一个<br>&quot;four&quot;<br>127.0.0.1:6379[2]&gt; lrange list 0 -1<br>1) &quot;two&quot;<br>2) &quot;one&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#########################################################################</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">下表 lidenx</span><br>127.0.0.1:6379[2]&gt; lindex list 0 # 通过下标获取<br>&quot;two&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#########################################################################</span></span><br>127.0.0.1:6379[2]&gt; llen list # 查看长度<br>(integer) 2<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#########################################################################</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">移除指定的值 lrem</span><br>127.0.0.1:6379[2]&gt; lrem list 1 one # 移除list值为one的值,只移除1个<br>(integer) 1<br>127.0.0.1:6379[2]&gt; lrange list 0 -1<br>1) &quot;two&quot;<br><br>127.0.0.1:6379[2]&gt; lpush list two<br>(integer) 2<br>127.0.0.1:6379[2]&gt; lrange list 0 -1<br>1) &quot;two&quot;<br>2) &quot;two&quot;<br><br>127.0.0.1:6379[2]&gt; lrem list 2 two  # 移除list值为two的值,只移除2个<br>(integer) 2<br>127.0.0.1:6379[2]&gt; lrange list 0 -1<br>(empty array)<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#########################################################################</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">trim 通过下标截取指定的长度</span><br><br>127.0.0.1:6379[2]&gt; lrange list 0 -1<br>1) &quot;hello&quot;<br>2) &quot;hello2&quot;<br>3) &quot;hello3&quot;<br>127.0.0.1:6379[2]&gt; ltrim list 1 2 # 截取下标<br>OK<br>127.0.0.1:6379[2]&gt; lrange list 0 -1<br>1) &quot;hello2&quot;<br>2) &quot;hello3&quot;<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#########################################################################</span></span><br>rpoplpush 移除列表的最后一个元素,并添加到另一个列表中<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#########################################################################</span></span><br>lset 通过下标修改值  # 如果下标不存在会报错<br>127.0.0.1:6379[2]&gt; lrange list 0 -1<br>1) &quot;hello2&quot;<br>2) &quot;hello3&quot;<br>127.0.0.1:6379[2]&gt; lset list 0 tgk # 修改下标为0的,改为tgk<br>OK<br>127.0.0.1:6379[2]&gt; lrange list 0 -1<br>1) &quot;tgk&quot;<br>2) &quot;hello3&quot;<br>127.0.0.1:6379[2]&gt;<br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment">#########################################################################</span></span><br>linsert 往某一个值前面或者后面添加值<br>127.0.0.1:6379[2]&gt; lrange list 0 -1<br>1) &quot;tgk&quot;<br>2) &quot;hello3&quot;<br>127.0.0.1:6379[2]&gt; linsert list before tgk zxy # 往list中 tgk的前面插入zxy<br>(integer) 3<br>127.0.0.1:6379[2]&gt; lrange list 0 -1<br>1) &quot;zxy&quot;<br>2) &quot;tgk&quot;<br>3) &quot;hello3&quot;<br>127.0.0.1:6379[2]&gt; linsert list after tgk zxy2 # 往list中 tgk的后面插入zxy<br>(integer) 4<br>127.0.0.1:6379[2]&gt; lrange list 0 -1<br>1) &quot;zxy&quot;<br>2) &quot;tgk&quot;<br>3) &quot;zxy2&quot;<br>4) &quot;hello3&quot;<br></code></pre></td></tr></table></figure><p><strong>总结:</strong></p><ul><li>list本质是个链表</li></ul><h2 id="4-4-set-集合"><a href="#4-4-set-集合" class="headerlink" title="4.4 set 集合"></a>4.4 set 集合</h2><p>set中的值不可重复</p><ul><li><strong>添加</strong> sadd</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[2]&gt; sadd myset tgk<br>(integer) 1<br></code></pre></td></tr></table></figure><ul><li><strong>查看</strong>指定set的所有值  smembers</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[2]&gt; smembers myset<br>1) &quot;tgk&quot;<br></code></pre></td></tr></table></figure><ul><li>**判断一个值在不在set集合中 ** sismember</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[2]&gt; sismember myset tgk<br>(integer) 1<br></code></pre></td></tr></table></figure><ul><li><strong>个数</strong> 获取集合中元素个数  scard</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[2]&gt; scard myset<br>(integer) 2<br></code></pre></td></tr></table></figure><ul><li><strong>移除</strong>指定元素 srem</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[2]&gt; srem myset tgk<br>(integer) 1<br></code></pre></td></tr></table></figure><p><strong>set是无序不重复集合</strong></p><ul><li><strong>随机抽选一个元素</strong>  SRANDMEMBER</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[2]&gt; SRANDMEMBER myset<br>&quot;zxy&quot;<br>127.0.0.1:6379[2]&gt; SRANDMEMBER myset<br>&quot;tgk&quot;<br></code></pre></td></tr></table></figure><ul><li><strong>随机抽选出指定个数元素</strong></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[2]&gt; SRANDMEMBER myset 2<br>1) &quot;tgk&quot;<br>2) &quot;zxy&quot;<br></code></pre></td></tr></table></figure><ul><li><strong>随机删除一个元素</strong>   spop</li></ul><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span><span class="hljs-string">[2]</span>&gt; spop myset<br><span class="hljs-string">&quot;tgk&quot;</span><br></code></pre></td></tr></table></figure><p><strong>将一个指定的值,移动到另外一个set中</strong>   smove</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[2]&gt; sadd myset2 1<br>(integer) 1<br>127.0.0.1:6379[2]&gt; sadd myset2 2<br>(integer) 1<br>127.0.0.1:6379[2]&gt; sadd myset2 3<br>(integer) 1<br>127.0.0.1:6379[2]&gt; smove myset myset2 zxy  #把myset的zxy移动到myset2<br>(integer) 1<br>127.0.0.1:6379[2]&gt; SMEMBERS myset2<br>1) &quot;3&quot;<br>2) &quot;zxy&quot;   # 多了个zxy<br>3) &quot;2&quot;<br>4) &quot;1&quot;<br>127.0.0.1:6379[2]&gt; SMEMBERS myset <br>(empty array)  #移走了<br></code></pre></td></tr></table></figure><ul><li><strong>差集</strong>  sdiff</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[2]&gt; SMEMBERS myset<br>1) &quot;1&quot;<br>2) &quot;2&quot;<br>127.0.0.1:6379[2]&gt; SMEMBERS myset2<br>1) &quot;3&quot;<br>2) &quot;zxy&quot;<br>3) &quot;2&quot;<br>4) &quot;1&quot;<br><br>127.0.0.1:6379[2]&gt; sdiff myset2 myset # myset2-myset的元素<br>1) &quot;3&quot;<br>2) &quot;zxy&quot;<br></code></pre></td></tr></table></figure><ul><li><strong>交集</strong>   sinter    共同好友可以这么实现</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[2]&gt; sinter myset myset2<br>1) &quot;1&quot;<br>2) &quot;2&quot;<br></code></pre></td></tr></table></figure><ul><li><strong>并集</strong>  sunion</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[2]&gt; sunion myset myset2<br>1) &quot;zxy&quot;<br>2) &quot;2&quot;<br>3) &quot;1&quot;<br>4) &quot;3&quot;<br></code></pre></td></tr></table></figure><h2 id="4-5-hash-哈希"><a href="#4-5-hash-哈希" class="headerlink" title="4.5 hash 哈希"></a>4.5 hash 哈希</h2><p><strong>就是key-value的string类型,string的方法都能用</strong></p><p><strong>hash更适合存对象,string更适合存字符串</strong></p><p>map集合,key-map,存的值是个map集合(存键值对,等于string套娃)</p><ul><li><strong>存值</strong> hset</li><li><strong>取值</strong>  hget</li><li><strong>设置多个值</strong> hmset</li><li><strong>取出多个值</strong> hmget</li><li><strong>取出所有key-value</strong> hgetall</li><li><strong>删除hash中指定的key</strong> hdel</li><li><strong>查看key的数量</strong> hlen</li><li><strong>判断某个key是否存在</strong> hexists</li><li><strong>获得所有的key</strong> hkeys</li><li><strong>获取所有的vlaue</strong> hvals</li><li><strong>自增</strong> hincrby</li></ul><h2 id="4-6-zset-有序集合"><a href="#4-6-zset-有序集合" class="headerlink" title="4.6 zset 有序集合"></a>4.6 zset 有序集合</h2><p><strong>在set的基础上增加了一个排序</strong></p><ul><li><strong>增加 zadd</strong></li></ul><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:6379</span>&gt; zadd myzset <span class="hljs-number">1</span> one<br>(integer) <span class="hljs-number">1</span><br><span class="hljs-number">127.0.0.1:6379</span>&gt; zadd myzset <span class="hljs-number">2</span> two <span class="hljs-number">3</span> three<br>(integer) <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><ul><li><strong>查看所有值</strong> zrange xxx 0 -1   和list很像</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379&gt; zrange myzset 0 -1<br>1) &quot;one&quot;<br>2) &quot;two&quot;<br>3) &quot;three&quot;<br></code></pre></td></tr></table></figure><ul><li>**正序筛选 ** ZRANGEBYSCORE</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379&gt; zrange myzset 0 -1  #现在里面的值<br>1) &quot;one&quot;<br>2) &quot;two&quot;<br>3) &quot;three&quot;<br>4) &quot;four&quot;<br>5) &quot;five&quot;<br>127.0.0.1:6379&gt; ZRANGEBYSCORE myzset -inf +inf   #筛选,从小到大,-inf是负无穷,+inf是正无穷,闭区间<br>1) &quot;one&quot;<br>2) &quot;two&quot;<br>3) &quot;three&quot;<br>4) &quot;four&quot;<br>5) &quot;five&quot;<br>127.0.0.1:6379&gt; ZRANGEBYSCORE myzset 2 +inf  #筛选,从小到大,-inf是负无穷,+inf是正无穷<br>1) &quot;two&quot;<br>2) &quot;three&quot;<br>3) &quot;four&quot;<br>4) &quot;five&quot;<br></code></pre></td></tr></table></figure><ul><li><strong>倒序筛选</strong>   ZREVRANGEBYSCORE</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379&gt; ZREVRANGEBYSCORE myzset +inf -inf<br>1) &quot;five&quot;<br>2) &quot;four&quot;<br>3) &quot;three&quot;<br>4) &quot;two&quot;<br>5) &quot;one&quot;<br></code></pre></td></tr></table></figure><ul><li><strong>移除元素</strong> zrem</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379&gt; zrem myzset three<br>(integer) 1<br>127.0.0.1:6379&gt; zrange myzset 0 -1<br>1) &quot;one&quot;<br>2) &quot;two&quot;<br>3) &quot;four&quot;<br>4) &quot;five&quot;<br></code></pre></td></tr></table></figure><ul><li><strong>获取个数</strong>   zcard</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379&gt; zcard myzset<br>(integer) 4<br></code></pre></td></tr></table></figure><ul><li><strong>获取指定区间的数量</strong>   ZCOUNT</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379&gt; ZCOUNT myzset 1 3<br>(integer) 2<br></code></pre></td></tr></table></figure><h1 id="5-三种特殊类型"><a href="#5-三种特殊类型" class="headerlink" title="5. 三种特殊类型"></a>5. 三种特殊类型</h1><h2 id="5-1-geospatial"><a href="#5-1-geospatial" class="headerlink" title="5.1 geospatial"></a>5.1 geospatial</h2><p>可以用来距离计算</p><ul><li><p><strong>添加地理位置</strong> geoadd</p></li><li><p><strong>获取指定的城市的精度和维度</strong>  geopos</p></li><li><p><strong>获取两个位置之间的距离</strong> geodist</p></li><li><p><strong>以给定的经纬度为中心,找出某一半径内的元素</strong>  deoradius</p></li><li><p><strong>找元素半径xxx内的其他元素</strong> georadiusbymember</p></li></ul><hr><p>ps: geo底层原理是zset 我们完全可以用zset操作geo</p><h2 id="5-2-hyperloglog"><a href="#5-2-hyperloglog" class="headerlink" title="5.2 hyperloglog"></a>5.2 hyperloglog</h2><p>后续更新</p><h2 id="5-3-bitmap"><a href="#5-3-bitmap" class="headerlink" title="5.3 bitmap"></a>5.3 bitmap</h2><p>后续更新</p><h1 id="6-事务"><a href="#6-事务" class="headerlink" title="6. 事务"></a>6. 事务</h1><p><strong>redis的事务很像批处理</strong></p><p>redis单条命令是可以保证原子性的</p><p>但是redis的<strong>事务不保证原子性,同时没有没有隔离级别概念</strong></p><p>事务的本质就是一组命令一块执行</p><p><strong>redis事务:</strong></p><ul><li>开启事务 multi</li><li>命令入队  redis命令</li><li>执行事务  exec</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379&gt; multi<br>OK<br>127.0.0.1:6379(TX)&gt; set name tgk<br>QUEUED<br>127.0.0.1:6379(TX)&gt; get name<br>QUEUED<br>127.0.0.1:6379(TX)&gt; set key1 value1<br>QUEUED<br>127.0.0.1:6379(TX)&gt; get key1<br>QUEUED<br>127.0.0.1:6379(TX)&gt; exec<br>1) OK<br>2) &quot;tgk&quot;<br>3) OK<br></code></pre></td></tr></table></figure><ul><li>放弃事务 discard    事务中的命令全取消</li></ul><p>redis可以实现乐观锁</p><h2 id="6-1-事务异常情况"><a href="#6-1-事务异常情况" class="headerlink" title="6.1 事务异常情况"></a>6.1 事务异常情况</h2><ul><li>编译时异常</li></ul><p>命令写错了,get写错git,事务全不能执行</p><ul><li>运行时错误</li></ul><p>比如让string类型的tgk加1,那只有错的命令不执行,其他的命令还是正常执行</p><hr><h1 id="7-监控"><a href="#7-监控" class="headerlink" title="7. 监控"></a>7. 监控</h1><ul><li><strong>悲观锁</strong></li></ul><p>认为什么时候都会出问题,所有操作都加锁</p><ul><li><strong>乐观锁</strong></li></ul><p>认为什么时候都不会出问题,所以不会上锁,更新数据的时候判断一下是否有人改动数据,version</p><p>获取version</p><p>更新的时候比较version是否变化</p><blockquote><p>监测</p></blockquote><p>watch 一个key</p><p>正常操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379&gt; set money 100<br>OK<br>127.0.0.1:6379&gt; set out 0<br>OK<br>127.0.0.1:6379&gt; watch money<br>OK<br>127.0.0.1:6379&gt; multi<br>OK<br>127.0.0.1:6379(TX)&gt; decrby money 20<br>QUEUED<br>127.0.0.1:6379(TX)&gt; incrby out 20<br>QUEUED<br>127.0.0.1:6379(TX)&gt; exec<br>1) (integer) 80<br>2) (integer) 20<br></code></pre></td></tr></table></figure><p>异常操作,再开一个客户端同时修改这个值</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">事务</span><br>127.0.0.1:6379&gt; watch money<br>OK<br>127.0.0.1:6379&gt; multi<br>OK<br>127.0.0.1:6379(TX)&gt; incrby money 20<br>QUEUED<br>127.0.0.1:6379(TX)&gt; exec #报错<br>(nil)<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">在还没有<span class="hljs-built_in">exec</span>的时候开另一个客户端修改</span><br>127.0.0.1:6379&gt; decrby money 30<br>(integer) 320<br></code></pre></td></tr></table></figure><p>**解锁 **unwatch  如果事务执行失败了就先解锁,然后再加锁执行事务 这个watch就是乐观锁的获取version</p><hr><h1 id="8-Jedis"><a href="#8-Jedis" class="headerlink" title="8. Jedis"></a>8. Jedis</h1><p>使用java操作redis</p><p>Jedis是redis官方的java连接开发工具,等于数据库的jdbc</p><ul><li>导依赖包</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.2.0-m1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>测试</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> tengguokun</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/3/14 23:35</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JedisLearn</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-comment">// 获取连接</span><br>        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">&quot;110.110.110.128&quot;</span>,<span class="hljs-number">6379</span>);<br>        <span class="hljs-comment">// 验证密码</span><br>        jedis.auth(<span class="hljs-string">&quot;tgk123&quot;</span>);<br>        <span class="hljs-comment">// ping一下</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">ping</span> <span class="hljs-operator">=</span> jedis.ping();<br>        System.out.println(ping);<br>        jedis.close();<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 返回</span><br>PONG<br><br>Process finished with exit code <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>可以看出,redis的命令在jedis就是方法,遵循小驼峰原则</p><h2 id="8-1-jedis使用事务"><a href="#8-1-jedis使用事务" class="headerlink" title="8.1 jedis使用事务"></a>8.1 jedis使用事务</h2><p>最好加上try catch</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><span class="hljs-keyword">import</span> redis.clients.jedis.Response;<br><span class="hljs-keyword">import</span> redis.clients.jedis.Transaction;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> tengguokun</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/3/14 23:35</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JedisLearn</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">&quot;110.110.110.128&quot;</span>,<span class="hljs-number">6379</span>);<br>        jedis.auth(<span class="hljs-string">&quot;tgk123&quot;</span>);<br>        <span class="hljs-type">Transaction</span> <span class="hljs-variable">multi</span> <span class="hljs-operator">=</span> jedis.multi();<br>        <span class="hljs-keyword">try</span>&#123;<br>            multi.set(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;tgk&quot;</span>);<br>            Response&lt;String&gt; name = multi.get(<span class="hljs-string">&quot;name&quot;</span>);<br>            System.out.println(multi.exec());<br>        &#125;<br>        <span class="hljs-keyword">catch</span> (Exception e)&#123;<br>            <span class="hljs-comment">// 放弃事务</span><br>            multi.discard();<br>        &#125;<br>        <span class="hljs-keyword">finally</span> &#123;<br>            jedis.close();<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="9-springboot整合"><a href="#9-springboot整合" class="headerlink" title="9. springboot整合"></a>9. springboot整合</h1><h2 id="9-1-简单使用"><a href="#9-1-简单使用" class="headerlink" title="9.1 简单使用"></a>9.1 简单使用</h2><p>在springboot 2.x后 jedis被替换成了lettuce</p><ul><li><p>jsdis:直连,多线程操作不安全,一般使用jedis连接池,但是问题很多,</p></li><li><p>lettuce底层采用netty,实例可以在多个线程内共享,不存在线程不安全</p></li></ul><p><strong>使用:</strong></p><ul><li>导入依赖</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">spring.redis.host</span><br><span class="hljs-attr">spring.redis.port</span><br></code></pre></td></tr></table></figure><ul><li>测试</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AutoWired</span><br><span class="hljs-keyword">private</span> RedisTemplate redisTemplate<br></code></pre></td></tr></table></figure><h2 id="9-2-存储对象"><a href="#9-2-存储对象" class="headerlink" title="9.2 存储对象"></a>9.2 存储对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.tgk.redis02springboot.pojo;<br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> tengguokun</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022/3/19 17:52</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserPojo</span> &#123;<br>    String name;<br>    Integer age;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br>RedisTemplate redisTemplate;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">myTest</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">UserPojo</span> <span class="hljs-variable">userPojo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserPojo</span>(<span class="hljs-string">&quot;滕国坤&quot;</span>,<span class="hljs-number">23</span>);<br>    redisTemplate.opsForValue().set(<span class="hljs-string">&quot;user1&quot;</span>,userPojo);<br>    System.out.println(redisTemplate.opsForValue().get(<span class="hljs-string">&quot;user1&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure><p>会报错</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">org.springframework.data.redis.serializer.SerializationException: Cannot serialize; nested <span class="hljs-keyword">exception</span> is org.springframework.core.serializer.support.SerializationFailedException: Failed <span class="hljs-keyword">to</span> serialize <span class="hljs-keyword">object</span> using DefaultSerializer; nested <span class="hljs-keyword">exception</span> is java.lang.IllegalArgumentException: DefaultSerializer requires a Serializable payload but received an <span class="hljs-keyword">object</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">type</span> <span class="hljs-literal">[<span class="hljs-identifier">com</span>.<span class="hljs-identifier">tgk</span>.<span class="hljs-identifier">redis02springboot</span>.<span class="hljs-identifier">pojo</span>.U<span class="hljs-identifier">serPojo</span>]</span><br><br>at org.springframework.data.redis.serializer.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">JdkSerializationRedisSerializer</span>.</span></span>serialize(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">JdkSerializationRedisSerializer</span>.</span></span>java:<span class="hljs-number">96</span>)<br>at org.springframework.data.redis.core.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AbstractOperations</span>.</span></span>raw<span class="hljs-constructor">Value(AbstractOperations.<span class="hljs-params">java</span>:128)</span><br>at org.springframework.data.redis.core.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DefaultValueOperations</span>.</span></span>set(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DefaultValueOperations</span>.</span></span>java:<span class="hljs-number">304</span>)<br>at com.tgk.redis02springboot.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Redis02SpringbootApplicationTests</span>.</span></span>my<span class="hljs-constructor">Test(Redis02SpringbootApplicationTests.<span class="hljs-params">java</span>:21)</span><br>at sun.reflect.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NativeMethodAccessorImpl</span>.</span></span>invoke0(Native Method)<br>at sun.reflect.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NativeMethodAccessorImpl</span>.</span></span>invoke(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NativeMethodAccessorImpl</span>.</span></span>java:<span class="hljs-number">62</span>)<br>at sun.reflect.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DelegatingMethodAccessorImpl</span>.</span></span>invoke(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DelegatingMethodAccessorImpl</span>.</span></span>java:<span class="hljs-number">43</span>)<br>at java.lang.reflect.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Method</span>.</span></span>invoke(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Method</span>.</span></span>java:<span class="hljs-number">497</span>)<br>at org.junit.platform.commons.util.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ReflectionUtils</span>.</span></span>invoke<span class="hljs-constructor">Method(ReflectionUtils.<span class="hljs-params">java</span>:725)</span><br>at org.junit.jupiter.engine.execution.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">MethodInvocation</span>.</span></span>proceed(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">MethodInvocation</span>.</span></span>java:<span class="hljs-number">60</span>)<br>at org.junit.jupiter.engine.execution.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvocationInterceptorChain$ValidatingInvocation</span>.</span></span>proceed(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvocationInterceptorChain</span>.</span></span>java:<span class="hljs-number">131</span>)<br>at org.junit.jupiter.engine.extension.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TimeoutExtension</span>.</span></span>intercept(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TimeoutExtension</span>.</span></span>java:<span class="hljs-number">149</span>)<br>at org.junit.jupiter.engine.extension.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TimeoutExtension</span>.</span></span>intercept<span class="hljs-constructor">TestableMethod(TimeoutExtension.<span class="hljs-params">java</span>:140)</span><br>at org.junit.jupiter.engine.extension.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TimeoutExtension</span>.</span></span>intercept<span class="hljs-constructor">TestMethod(TimeoutExtension.<span class="hljs-params">java</span>:84)</span><br>at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor$$Lambda$<span class="hljs-number">122</span>/<span class="hljs-number">1310540333.</span>apply(Unknown Source)<br>at org.junit.jupiter.engine.execution.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ExecutableInvoker$ReflectiveInterceptorCall</span>.</span></span>lambda<span class="hljs-constructor">$ofVoidMethod$0(ExecutableInvoker.<span class="hljs-params">java</span>:115)</span><br>at org.junit.jupiter.engine.execution.ExecutableInvoker$ReflectiveInterceptorCall$$Lambda$<span class="hljs-number">123</span>/<span class="hljs-number">1589683045.</span>apply(Unknown Source)<br>at org.junit.jupiter.engine.execution.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ExecutableInvoker</span>.</span></span>lambda<span class="hljs-constructor">$invoke$0(ExecutableInvoker.<span class="hljs-params">java</span>:105)</span><br>at org.junit.jupiter.engine.execution.ExecutableInvoker$$Lambda$<span class="hljs-number">368</span>/<span class="hljs-number">2077742806.</span>apply(Unknown Source)<br>at org.junit.jupiter.engine.execution.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvocationInterceptorChain$InterceptedInvocation</span>.</span></span>proceed(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvocationInterceptorChain</span>.</span></span>java:<span class="hljs-number">106</span>)<br>at org.junit.jupiter.engine.execution.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvocationInterceptorChain</span>.</span></span>proceed(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvocationInterceptorChain</span>.</span></span>java:<span class="hljs-number">64</span>)<br>at org.junit.jupiter.engine.execution.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvocationInterceptorChain</span>.</span></span>chain<span class="hljs-constructor">AndInvoke(InvocationInterceptorChain.<span class="hljs-params">java</span>:45)</span><br>at org.junit.jupiter.engine.execution.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvocationInterceptorChain</span>.</span></span>invoke(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InvocationInterceptorChain</span>.</span></span>java:<span class="hljs-number">37</span>)<br>at org.junit.jupiter.engine.execution.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ExecutableInvoker</span>.</span></span>invoke(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ExecutableInvoker</span>.</span></span>java:<span class="hljs-number">104</span>)<br>at org.junit.jupiter.engine.execution.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ExecutableInvoker</span>.</span></span>invoke(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ExecutableInvoker</span>.</span></span>java:<span class="hljs-number">98</span>)<br>at org.junit.jupiter.engine.descriptor.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TestMethodTestDescriptor</span>.</span></span>lambda<span class="hljs-constructor">$invokeTestMethod$7(TestMethodTestDescriptor.<span class="hljs-params">java</span>:214)</span><br>at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor$$Lambda$<span class="hljs-number">1004</span>/<span class="hljs-number">1613729684.</span>execute(Unknown Source)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ThrowableCollector</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ThrowableCollector</span>.</span></span>java:<span class="hljs-number">73</span>)<br>at org.junit.jupiter.engine.descriptor.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TestMethodTestDescriptor</span>.</span></span>invoke<span class="hljs-constructor">TestMethod(TestMethodTestDescriptor.<span class="hljs-params">java</span>:210)</span><br>at org.junit.jupiter.engine.descriptor.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TestMethodTestDescriptor</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TestMethodTestDescriptor</span>.</span></span>java:<span class="hljs-number">135</span>)<br>at org.junit.jupiter.engine.descriptor.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TestMethodTestDescriptor</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TestMethodTestDescriptor</span>.</span></span>java:<span class="hljs-number">66</span>)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>lambda<span class="hljs-constructor">$executeRecursively$6(NodeTestTask.<span class="hljs-params">java</span>:151)</span><br>at org.junit.platform.engine.support.hierarchical.NodeTestTask$$Lambda$<span class="hljs-number">224</span>/<span class="hljs-number">1414147750.</span>execute(Unknown Source)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ThrowableCollector</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ThrowableCollector</span>.</span></span>java:<span class="hljs-number">73</span>)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>lambda<span class="hljs-constructor">$executeRecursively$8(NodeTestTask.<span class="hljs-params">java</span>:141)</span><br>at org.junit.platform.engine.support.hierarchical.NodeTestTask$$Lambda$<span class="hljs-number">223</span>/<span class="hljs-number">1920387277.</span>invoke(Unknown Source)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Node</span>.</span></span>around(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Node</span>.</span></span>java:<span class="hljs-number">137</span>)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>lambda<span class="hljs-constructor">$executeRecursively$9(NodeTestTask.<span class="hljs-params">java</span>:139)</span><br>at org.junit.platform.engine.support.hierarchical.NodeTestTask$$Lambda$<span class="hljs-number">222</span>/<span class="hljs-number">2015781843.</span>execute(Unknown Source)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ThrowableCollector</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ThrowableCollector</span>.</span></span>java:<span class="hljs-number">73</span>)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>execute<span class="hljs-constructor">Recursively(NodeTestTask.<span class="hljs-params">java</span>:138)</span><br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>java:<span class="hljs-number">95</span>)<br>at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService$$Lambda$<span class="hljs-number">228</span>/<span class="hljs-number">1884122755.</span>accept(Unknown Source)<br>at java.util.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ArrayList</span>.</span></span><span class="hljs-keyword">for</span><span class="hljs-constructor">Each(ArrayList.<span class="hljs-params">java</span>:1249)</span><br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SameThreadHierarchicalTestExecutorService</span>.</span></span>invoke<span class="hljs-constructor">All(SameThreadHierarchicalTestExecutorService.<span class="hljs-params">java</span>:41)</span><br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>lambda<span class="hljs-constructor">$executeRecursively$6(NodeTestTask.<span class="hljs-params">java</span>:155)</span><br>at org.junit.platform.engine.support.hierarchical.NodeTestTask$$Lambda$<span class="hljs-number">224</span>/<span class="hljs-number">1414147750.</span>execute(Unknown Source)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ThrowableCollector</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ThrowableCollector</span>.</span></span>java:<span class="hljs-number">73</span>)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>lambda<span class="hljs-constructor">$executeRecursively$8(NodeTestTask.<span class="hljs-params">java</span>:141)</span><br>at org.junit.platform.engine.support.hierarchical.NodeTestTask$$Lambda$<span class="hljs-number">223</span>/<span class="hljs-number">1920387277.</span>invoke(Unknown Source)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Node</span>.</span></span>around(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Node</span>.</span></span>java:<span class="hljs-number">137</span>)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>lambda<span class="hljs-constructor">$executeRecursively$9(NodeTestTask.<span class="hljs-params">java</span>:139)</span><br>at org.junit.platform.engine.support.hierarchical.NodeTestTask$$Lambda$<span class="hljs-number">222</span>/<span class="hljs-number">2015781843.</span>execute(Unknown Source)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ThrowableCollector</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ThrowableCollector</span>.</span></span>java:<span class="hljs-number">73</span>)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>execute<span class="hljs-constructor">Recursively(NodeTestTask.<span class="hljs-params">java</span>:138)</span><br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>java:<span class="hljs-number">95</span>)<br>at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService$$Lambda$<span class="hljs-number">228</span>/<span class="hljs-number">1884122755.</span>accept(Unknown Source)<br>at java.util.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ArrayList</span>.</span></span><span class="hljs-keyword">for</span><span class="hljs-constructor">Each(ArrayList.<span class="hljs-params">java</span>:1249)</span><br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SameThreadHierarchicalTestExecutorService</span>.</span></span>invoke<span class="hljs-constructor">All(SameThreadHierarchicalTestExecutorService.<span class="hljs-params">java</span>:41)</span><br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>lambda<span class="hljs-constructor">$executeRecursively$6(NodeTestTask.<span class="hljs-params">java</span>:155)</span><br>at org.junit.platform.engine.support.hierarchical.NodeTestTask$$Lambda$<span class="hljs-number">224</span>/<span class="hljs-number">1414147750.</span>execute(Unknown Source)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ThrowableCollector</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ThrowableCollector</span>.</span></span>java:<span class="hljs-number">73</span>)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>lambda<span class="hljs-constructor">$executeRecursively$8(NodeTestTask.<span class="hljs-params">java</span>:141)</span><br>at org.junit.platform.engine.support.hierarchical.NodeTestTask$$Lambda$<span class="hljs-number">223</span>/<span class="hljs-number">1920387277.</span>invoke(Unknown Source)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Node</span>.</span></span>around(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Node</span>.</span></span>java:<span class="hljs-number">137</span>)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>lambda<span class="hljs-constructor">$executeRecursively$9(NodeTestTask.<span class="hljs-params">java</span>:139)</span><br>at org.junit.platform.engine.support.hierarchical.NodeTestTask$$Lambda$<span class="hljs-number">222</span>/<span class="hljs-number">2015781843.</span>execute(Unknown Source)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ThrowableCollector</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ThrowableCollector</span>.</span></span>java:<span class="hljs-number">73</span>)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>execute<span class="hljs-constructor">Recursively(NodeTestTask.<span class="hljs-params">java</span>:138)</span><br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NodeTestTask</span>.</span></span>java:<span class="hljs-number">95</span>)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SameThreadHierarchicalTestExecutorService</span>.</span></span>submit(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SameThreadHierarchicalTestExecutorService</span>.</span></span>java:<span class="hljs-number">35</span>)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HierarchicalTestExecutor</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HierarchicalTestExecutor</span>.</span></span>java:<span class="hljs-number">57</span>)<br>at org.junit.platform.engine.support.hierarchical.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HierarchicalTestEngine</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">HierarchicalTestEngine</span>.</span></span>java:<span class="hljs-number">54</span>)<br>at org.junit.platform.launcher.core.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EngineExecutionOrchestrator</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EngineExecutionOrchestrator</span>.</span></span>java:<span class="hljs-number">107</span>)<br>at org.junit.platform.launcher.core.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EngineExecutionOrchestrator</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EngineExecutionOrchestrator</span>.</span></span>java:<span class="hljs-number">88</span>)<br>at org.junit.platform.launcher.core.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EngineExecutionOrchestrator</span>.</span></span>lambda<span class="hljs-constructor">$execute$0(EngineExecutionOrchestrator.<span class="hljs-params">java</span>:54)</span><br>at org.junit.platform.launcher.core.EngineExecutionOrchestrator$$Lambda$<span class="hljs-number">166</span>/<span class="hljs-number">1568059495.</span>accept(Unknown Source)<br>at org.junit.platform.launcher.core.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EngineExecutionOrchestrator</span>.</span></span><span class="hljs-keyword">with</span><span class="hljs-constructor">InterceptedStreams(EngineExecutionOrchestrator.<span class="hljs-params">java</span>:67)</span><br>at org.junit.platform.launcher.core.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EngineExecutionOrchestrator</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EngineExecutionOrchestrator</span>.</span></span>java:<span class="hljs-number">52</span>)<br>at org.junit.platform.launcher.core.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DefaultLauncher</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DefaultLauncher</span>.</span></span>java:<span class="hljs-number">114</span>)<br>at org.junit.platform.launcher.core.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DefaultLauncher</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DefaultLauncher</span>.</span></span>java:<span class="hljs-number">86</span>)<br>at org.junit.platform.launcher.core.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DefaultLauncherSession$DelegatingLauncher</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DefaultLauncherSession</span>.</span></span>java:<span class="hljs-number">86</span>)<br>at org.junit.platform.launcher.core.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SessionPerRequestLauncher</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SessionPerRequestLauncher</span>.</span></span>java:<span class="hljs-number">53</span>)<br>at com.intellij.junit5.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">JUnit5IdeaTestRunner</span>.</span></span>start<span class="hljs-constructor">RunnerWithArgs(JUnit5IdeaTestRunner.<span class="hljs-params">java</span>:71)</span><br>at com.intellij.rt.junit.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IdeaTestRunner$Repeater$1</span>.</span></span>execute(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IdeaTestRunner</span>.</span></span>java:<span class="hljs-number">38</span>)<br>at com.intellij.rt.execution.junit.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TestsRepeater</span>.</span></span>repeat(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TestsRepeater</span>.</span></span>java:<span class="hljs-number">11</span>)<br>at com.intellij.rt.junit.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IdeaTestRunner$Repeater</span>.</span></span>start<span class="hljs-constructor">RunnerWithArgs(IdeaTestRunner.<span class="hljs-params">java</span>:35)</span><br>at com.intellij.rt.junit.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">JUnitStarter</span>.</span></span>prepare<span class="hljs-constructor">StreamsAndStart(JUnitStarter.<span class="hljs-params">java</span>:235)</span><br>at com.intellij.rt.junit.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">JUnitStarter</span>.</span></span>main(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">JUnitStarter</span>.</span></span>java:<span class="hljs-number">54</span>)<br>Caused by: org.springframework.core.serializer.support.SerializationFailedException: Failed <span class="hljs-keyword">to</span> serialize <span class="hljs-keyword">object</span> using DefaultSerializer; nested <span class="hljs-keyword">exception</span> is java.lang.IllegalArgumentException: DefaultSerializer requires a Serializable payload but received an <span class="hljs-keyword">object</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">type</span> <span class="hljs-literal">[<span class="hljs-identifier">com</span>.<span class="hljs-identifier">tgk</span>.<span class="hljs-identifier">redis02springboot</span>.<span class="hljs-identifier">pojo</span>.U<span class="hljs-identifier">serPojo</span>]</span><br>at org.springframework.core.serializer.support.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SerializingConverter</span>.</span></span>convert(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SerializingConverter</span>.</span></span>java:<span class="hljs-number">64</span>)<br>at org.springframework.core.serializer.support.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SerializingConverter</span>.</span></span>convert(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SerializingConverter</span>.</span></span>java:<span class="hljs-number">33</span>)<br>at org.springframework.data.redis.serializer.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">JdkSerializationRedisSerializer</span>.</span></span>serialize(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">JdkSerializationRedisSerializer</span>.</span></span>java:<span class="hljs-number">94</span>)<span class="hljs-operator"></span><br><span class="hljs-operator">... </span><span class="hljs-number">88</span> more<br>Caused by: java.lang.IllegalArgumentException: DefaultSerializer requires a Serializable payload but received an <span class="hljs-keyword">object</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">type</span> <span class="hljs-literal">[<span class="hljs-identifier">com</span>.<span class="hljs-identifier">tgk</span>.<span class="hljs-identifier">redis02springboot</span>.<span class="hljs-identifier">pojo</span>.U<span class="hljs-identifier">serPojo</span>]</span><br>at org.springframework.core.serializer.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DefaultSerializer</span>.</span></span>serialize(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DefaultSerializer</span>.</span></span>java:<span class="hljs-number">43</span>)<br>at org.springframework.core.serializer.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Serializer</span>.</span></span>serialize<span class="hljs-constructor">ToByteArray(Serializer.<span class="hljs-params">java</span>:56)</span><br>at org.springframework.core.serializer.support.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SerializingConverter</span>.</span></span>convert(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SerializingConverter</span>.</span></span>java:<span class="hljs-number">60</span>)<span class="hljs-operator"></span><br><span class="hljs-operator">... </span><span class="hljs-number">90</span> more<br></code></pre></td></tr></table></figure><p>报错原因是不能&#x3D;&#x3D;序列化&#x3D;&#x3D;</p><p><strong>解决方法:存入的对象类实现序列化</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserPojo</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    String name;<br>    Integer age;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>java读出来了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">2022</span>-<span class="hljs-number">03</span>-<span class="hljs-number">19</span> <span class="hljs-number">19</span>:<span class="hljs-number">47</span>:<span class="hljs-number">33.133</span>  INFO <span class="hljs-number">14404</span> --- [           main] c.t.r.Redis02SpringbootApplicationTests  : Starting Redis02SpringbootApplicationTests using Java <span class="hljs-number">1.8</span><span class="hljs-number">.0_40</span> on Alan-laptop with PID <span class="hljs-number">14404</span> (started by TGK in D:\IDEA_work\redis-lern\redis-<span class="hljs-number">02</span>-springboot)<br><span class="hljs-number">2022</span>-<span class="hljs-number">03</span>-<span class="hljs-number">19</span> <span class="hljs-number">19</span>:<span class="hljs-number">47</span>:<span class="hljs-number">33.135</span>  INFO <span class="hljs-number">14404</span> --- [           main] c.t.r.Redis02SpringbootApplicationTests  : No active profile set, falling back to <span class="hljs-number">1</span> <span class="hljs-keyword">default</span> profile: <span class="hljs-string">&quot;default&quot;</span><br><span class="hljs-number">2022</span>-<span class="hljs-number">03</span>-<span class="hljs-number">19</span> <span class="hljs-number">19</span>:<span class="hljs-number">47</span>:<span class="hljs-number">34.084</span>  INFO <span class="hljs-number">14404</span> --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode!<br><span class="hljs-number">2022</span>-<span class="hljs-number">03</span>-<span class="hljs-number">19</span> <span class="hljs-number">19</span>:<span class="hljs-number">47</span>:<span class="hljs-number">34.089</span>  INFO <span class="hljs-number">14404</span> --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.<br><span class="hljs-number">2022</span>-<span class="hljs-number">03</span>-<span class="hljs-number">19</span> <span class="hljs-number">19</span>:<span class="hljs-number">47</span>:<span class="hljs-number">34.120</span>  INFO <span class="hljs-number">14404</span> --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in <span class="hljs-number">9</span> ms. Found <span class="hljs-number">0</span> Redis repository interfaces.<br><span class="hljs-number">2022</span>-<span class="hljs-number">03</span>-<span class="hljs-number">19</span> <span class="hljs-number">19</span>:<span class="hljs-number">47</span>:<span class="hljs-number">36.020</span>  INFO <span class="hljs-number">14404</span> --- [           main] c.t.r.Redis02SpringbootApplicationTests  : Started Redis02SpringbootApplicationTests in <span class="hljs-number">3.383</span> seconds (JVM running <span class="hljs-keyword">for</span> <span class="hljs-number">5.508</span>)<br>UserPojo(name=滕国坤, age=<span class="hljs-number">23</span>) <span class="hljs-comment">// 这里读出来了</span><br></code></pre></td></tr></table></figure><p>但是我们发现,使用redis-cli访问,是乱码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379[3]&gt; keys *<br>1) &quot;\xac\xed\x00\x05t\x00\x05user1&quot;<br>127.0.0.1:6379[3]&gt; get &quot;\xac\xed\x00\x05t\x00\x05user1&quot;<br>&quot;\xac\xed\x00\x05sr\x00&#x27;com.tgk.redis02springboot.pojo.UserPojoqv+\xb07\x8c\xa4\xa4\x02\x00\x02L\x00\x03aget\x00\x13Ljava/lang/Integer;L\x00\x04namet\x00\x12Ljava/lang/String;xpsr\x00\x11java.lang.Integer\x12\xe2\xa0\xa4\xf7\x81\x878\x02\x00\x01I\x00\x05valuexr\x00\x10java.lang.Number\x86\xac\x95\x1d\x0b\x94\xe0\x8b\x02\x00\x00xp\x00\x00\x00\x17t\x00\t\xe6\xbb\x95\xe5\x9b\xbd\xe5\x9d\xa4&quot;<br></code></pre></td></tr></table></figure><h2 id="9-3-实用的RedisUtil工具类"><a href="#9-3-实用的RedisUtil工具类" class="headerlink" title="9.3 实用的RedisUtil工具类"></a>9.3 实用的RedisUtil工具类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.kuang.utils;<br><br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.util.CollectionUtils;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><span class="hljs-keyword">import</span> java.util.Set;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br><br><span class="hljs-comment">// 在我们真实的分发中，或者你们在公司，一般都可以看到一个公司自己封装RedisUtil</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisUtil</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;<br>    <br>    <span class="hljs-comment">// =============================common============================</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 指定缓存失效时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time 时间(秒)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">expire</span><span class="hljs-params">(String key, <span class="hljs-type">long</span> time)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>) &#123;<br>                redisTemplate.expire(key, time, TimeUnit.SECONDS);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据key 获取过期时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 时间(秒) 返回0代表为永久有效</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">getExpire</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 判断key是否存在</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 存在 false不存在</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasKey</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.hasKey(key);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除缓存</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 可以传一个值 或多个</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">del</span><span class="hljs-params">(String... key)</span> &#123;<br>        <span class="hljs-keyword">if</span> (key != <span class="hljs-literal">null</span> &amp;&amp; key.length &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> (key.length == <span class="hljs-number">1</span>) &#123;<br>                redisTemplate.delete(key[<span class="hljs-number">0</span>]);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                redisTemplate.delete(CollectionUtils.arrayToList(key));<br>            &#125;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">// ============================String=============================</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 普通缓存获取</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">return</span> key == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : redisTemplate.opsForValue().get(key);<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 普通缓存放入</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true成功 false失败</span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, Object value)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForValue().set(key, value);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 普通缓存放入并设置时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time  时间(秒) time要大于0 如果time小于等于0 将设置无限期</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true成功 false 失败</span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, Object value, <span class="hljs-type">long</span> time)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>) &#123;<br>                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                set(key, value);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 递增</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> delta 要增加几(大于0)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">incr</span><span class="hljs-params">(String key, <span class="hljs-type">long</span> delta)</span> &#123;<br>        <span class="hljs-keyword">if</span> (delta &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;递增因子必须大于0&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForValue().increment(key, delta);<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 递减</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> delta 要减少几(小于0)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">decr</span><span class="hljs-params">(String key, <span class="hljs-type">long</span> delta)</span> &#123;<br>        <span class="hljs-keyword">if</span> (delta &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;递减因子必须大于0&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForValue().increment(key, -delta);<br>    &#125;<br><br><br>    <span class="hljs-comment">// ================================Map=================================</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * HashGet</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项 不能为null</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">hget</span><span class="hljs-params">(String key, String item)</span> &#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().get(key, item);<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取hashKey对应的所有键值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 对应的多个键值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Map&lt;Object, Object&gt; <span class="hljs-title function_">hmget</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().entries(key);<br>    &#125;<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * HashSet</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> map 对应多个键值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hmset</span><span class="hljs-params">(String key, Map&lt;String, Object&gt; map)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForHash().putAll(key, map);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * HashSet 并设置时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> map  对应多个键值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time 时间(秒)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true成功 false失败</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hmset</span><span class="hljs-params">(String key, Map&lt;String, Object&gt; map, <span class="hljs-type">long</span> time)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForHash().putAll(key, map);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>) &#123;<br>                expire(key, time);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 向一张hash表中放入数据,如果不存在将创建</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item  项</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 成功 false失败</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hset</span><span class="hljs-params">(String key, String item, Object value)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForHash().put(key, item, value);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 向一张hash表中放入数据,如果不存在将创建</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item  项</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time  时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 成功 false失败</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hset</span><span class="hljs-params">(String key, String item, Object value, <span class="hljs-type">long</span> time)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForHash().put(key, item, value);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>) &#123;<br>                expire(key, time);<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除hash表中的值</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项 可以使多个 不能为null</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hdel</span><span class="hljs-params">(String key, Object... item)</span> &#123;<br>        redisTemplate.opsForHash().delete(key, item);<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 判断hash表中是否有该项的值</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项 不能为null</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 存在 false不存在</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hHasKey</span><span class="hljs-params">(String key, String item)</span> &#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().hasKey(key, item);<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> by   要增加几(大于0)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">hincr</span><span class="hljs-params">(String key, String item, <span class="hljs-type">double</span> by)</span> &#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().increment(key, item, by);<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * hash递减</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key  键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> item 项</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> by   要减少记(小于0)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">hdecr</span><span class="hljs-params">(String key, String item, <span class="hljs-type">double</span> by)</span> &#123;<br>        <span class="hljs-keyword">return</span> redisTemplate.opsForHash().increment(key, item, -by);<br>    &#125;<br><br><br>    <span class="hljs-comment">// ============================set=============================</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据key获取Set中的所有值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title function_">sGet</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForSet().members(key);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据value从一个set中查询,是否存在</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> true 存在 false不存在</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">sHasKey</span><span class="hljs-params">(String key, Object value)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForSet().isMember(key, value);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将数据放入set缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key    键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> values 值 可以是多个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 成功个数</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">sSet</span><span class="hljs-params">(String key, Object... values)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForSet().add(key, values);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将set数据放入缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key    键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time   时间(秒)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> values 值 可以是多个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 成功个数</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">sSetAndTime</span><span class="hljs-params">(String key, <span class="hljs-type">long</span> time, Object... values)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> redisTemplate.opsForSet().add(key, values);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>)<br>                expire(key, time);<br>            <span class="hljs-keyword">return</span> count;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取set缓存的长度</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">sGetSetSize</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForSet().size(key);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 移除值为value的</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key    键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> values 值 可以是多个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 移除的个数</span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">setRemove</span><span class="hljs-params">(String key, Object... values)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> redisTemplate.opsForSet().remove(key, values);<br>            <span class="hljs-keyword">return</span> count;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// ===============================list=================================</span><br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取list缓存的内容</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> start 开始</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> end   结束 0 到 -1代表所有值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> List&lt;Object&gt; <span class="hljs-title function_">lGet</span><span class="hljs-params">(String key, <span class="hljs-type">long</span> start, <span class="hljs-type">long</span> end)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForList().range(key, start, end);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取list缓存的长度</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key 键</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">lGetListSize</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForList().size(key);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 通过索引 获取list中的值</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> index 索引 index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">lGetIndex</span><span class="hljs-params">(String key, <span class="hljs-type">long</span> index)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> redisTemplate.opsForList().index(key, index);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将list放入缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">lSet</span><span class="hljs-params">(String key, Object value)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().rightPush(key, value);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将list放入缓存</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time  时间(秒)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">lSet</span><span class="hljs-params">(String key, Object value, <span class="hljs-type">long</span> time)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().rightPush(key, value);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>)<br>                expire(key, time);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br><br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将list放入缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">lSet</span><span class="hljs-params">(String key, List&lt;Object&gt; value)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().rightPushAll(key, value);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br><br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将list放入缓存</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> time  时间(秒)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">lSet</span><span class="hljs-params">(String key, List&lt;Object&gt; value, <span class="hljs-type">long</span> time)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().rightPushAll(key, value);<br>            <span class="hljs-keyword">if</span> (time &gt; <span class="hljs-number">0</span>)<br>                expire(key, time);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 根据索引修改list中的某条数据</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> index 索引</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">lUpdateIndex</span><span class="hljs-params">(String key, <span class="hljs-type">long</span> index, Object value)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            redisTemplate.opsForList().set(key, index, value);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 移除N个值为value</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key   键</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> count 移除多少个</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> value 值</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 移除的个数</span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">lRemove</span><span class="hljs-params">(String key, <span class="hljs-type">long</span> count, Object value)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">remove</span> <span class="hljs-operator">=</span> redisTemplate.opsForList().remove(key, count, value);<br>            <span class="hljs-keyword">return</span> remove;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br><br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="10-redis-conf配置"><a href="#10-redis-conf配置" class="headerlink" title="10. redis.conf配置"></a>10. redis.conf配置</h1><ul><li>单位</li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20220315222745781.png" alt="image-20220315222745781"></p><ul><li>包含</li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20220315222800612.png" alt="image-20220315222800612"></p><ul><li>网络</li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20220315222829767.png" alt="image-20220315222829767"></p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20220315222901088.png" alt="image-20220315222901088"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">bind<span class="hljs-built_in"> ip</span><br><span class="hljs-built_in"></span>protected-mode <span class="hljs-literal">yes</span>/<span class="hljs-literal">no</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span><br></code></pre></td></tr></table></figure><ul><li>通用</li></ul><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20220315222934380.png" alt="image-20220315222934380"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">daemonize        #默认守护进程,后台运行<br>pidfile /var/run/redis_6379.pid  # 如果以后台方式运行,需要制定一个pid文件<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">日志级别</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Specify the server verbosity level.</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">This can be one of:</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">debug (a lot of information, useful <span class="hljs-keyword">for</span> development/testing)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">verbose (many rarely useful info, but not a mess like the debug level)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">notice (moderately verbose, what you want <span class="hljs-keyword">in</span> production probably)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">warning (only very important / critical messages are logged)</span><br>loglevel notice<br><br>logfile &quot;&quot;   # 日志文件名, &quot;&quot;的时候就是标准化输出<br><br>databases 16  # 数据库数量<br></code></pre></td></tr></table></figure><ul><li>持久化</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"></span><br><span class="language-bash"><span class="hljs-comment"># save 3600 1   6000s内,有一个key修改了,就持久化</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">save 300 100  300s内,有100个key修改,就持久化</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">save 60 10000</span><br><br>stop-writes-on-bgsave-error yes  #  持久化出错,是否继续工作<br>rdbcompression yes  # 是否压缩rdb文件,需要消耗cpu资源<br>rdbchecksum yes #保存rdb文件时候,进行错误校验<br>dir ./   #rdb文件保存目录<br></code></pre></td></tr></table></figure><ul><li>安全</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">requirepass tgk123 # 设置密码<br></code></pre></td></tr></table></figure><ul><li>客户端</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">maxclients 10000   #最多10000个客户端<br>maxmemory &lt;bytes&gt;  # 使用最大内存<br>maxmemory-policy noeviction  # 内存达到上限后的处理策略,网上有<br></code></pre></td></tr></table></figure><ul><li>APPEND ONLY模式   aof模式</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs SHELL">appendonly no #  默认不开启aof模式,因为默认rbd模式<br>appendfilename &quot;appendonly.aof&quot;  # 持久化文件名<br>appendfsync everysec   # 每秒执行一次<br>appendfsync always  #每次修改同步<br>appendfsync no  # 不同步,操作系统自己同步,速度最快<br></code></pre></td></tr></table></figure><h1 id="11-持久化"><a href="#11-持久化" class="headerlink" title="11. 持久化"></a>11. 持久化</h1><h2 id="11-1-RDB-redis-database"><a href="#11-1-RDB-redis-database" class="headerlink" title="11.1 RDB  redis database"></a>11.1 RDB  redis database</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20220315225729241.png" alt="image-20220315225729241"></p><hr><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20220315225745985.png" alt="image-20220315225745985"></p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20220315225845478.png" alt="image-20220315225845478"></p><blockquote><p>触发机制</p></blockquote><ul><li>满足save规则</li><li>执行flushall</li><li>shutdown</li></ul><p><strong>如何恢复rbd?</strong></p><ul><li><p>rdb放到redis启动目录下就行,redis启动会自己执行</p></li><li><p>查看redis启动目录</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379&gt; config get dir<br>1) &quot;dir&quot;<br>2) &quot;/opt/redis-6.2.6&quot;  # 如果目录下有.rdb文件,就自动恢复<br></code></pre></td></tr></table></figure><h2 id="11-2-AOF-append-only-file"><a href="#11-2-AOF-append-only-file" class="headerlink" title="11.2 AOF  append only file"></a>11.2 AOF  append only file</h2><p>将所有的命令记录下来,恢复的时候再把文件执行一遍</p>]]></content>
    
    
    <categories>
      
      <category>中间件</category>
      
    </categories>
    
    
    <tags>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>word导出</title>
    <link href="/2022/09/14/word%E5%AF%BC%E5%87%BA/"/>
    <url>/2022/09/14/word%E5%AF%BC%E5%87%BA/</url>
    
    <content type="html"><![CDATA[<p>利用java动态导出word,根据数据行数在word中动态生成表格,并在表格中显示图片</p><span id="more"></span><h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h1><p>作为CRUD的后端程序员,业务中难免会遇到有报表,报告等需求,导出格式多为Excel和Word.</p><p>导出Excel有EasyPoi,EasyExcel等优秀的开源工具,使用方式简单.</p><p>但是在遇上word导出的需求时,常见的方式有</p><ul><li>将word转存为xml,利用freemarker模板引擎写入数据(繁琐复杂,需求更改后几乎要重写所有)</li><li>使用hutool等开源工具,生成简单的word(几乎没啥用)</li><li>帆软等第三方报表工具(需要单独部署帆软服务,操作类似低代码)</li></ul><p>以上方式均有各自的缺点,我们可以利用<code>XDocReport</code>、<code>POI</code>、<code>Freemarker</code>实现我们的需求(自定义word模板,根据数据动态生成表格,表格中可插入图片)</p><p><strong>导出效果如下所示:</strong></p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20220913160837573.png" alt="image-20220913160837573"></p><h1 id="2-快速开始"><a href="#2-快速开始" class="headerlink" title="2. 快速开始"></a>2. 快速开始</h1><h2 id="2-1-maven依赖"><a href="#2-1-maven依赖" class="headerlink" title="2.1 maven依赖"></a>2.1 maven依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencys</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.poi<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>poi<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.poi<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>poi-ooxml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jxls<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jxls<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jxls<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jxls-poi<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>fr.opensagres.xdocreport<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fr.opensagres.xdocreport.core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>fr.opensagres.xdocreport<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fr.opensagres.xdocreport.document<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>fr.opensagres.xdocreport<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fr.opensagres.xdocreport.template<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>fr.opensagres.xdocreport<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fr.opensagres.xdocreport.document.docx<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>fr.opensagres.xdocreport<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fr.opensagres.xdocreport.template.freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.23<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencys</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="2-2-制作word模板"><a href="#2-2-制作word模板" class="headerlink" title="2.2 制作word模板"></a>2.2 制作word模板</h2><p><strong>我们需要的样式如下,上面可自定义替换的字段,下面的表格根据数据动态生成对应的行数</strong></p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20220913160647575.png" alt="image-20220913160647575"></p><p>如上图所示,我们所要填充的字段都用对应的占位符所表示,导出的时候根据对应的model替换占位符就行了(有点像JSP).模板的具体制作方式如下:</p><ol><li>根据自身需要制作好word样式</li><li>将需要替换的字段选中,按下ctrl+F9将其设置为”域”,可以看见字段被大括号所包裹</li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20220913161303725.png" alt="image-20220913161303725"></p><ol start="3"><li>右键”域”,选则编辑域</li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20220913161346336.png" alt="image-20220913161346336"></p><ol start="4"><li>选择邮件合并,MergeField,域名设置${xxx}   (xxx为自定义的名字)</li></ol><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/markDown/image-20220913161614714.png"></p><p>这样一个简单的模板就好了,但是如果想要动态生成表格,域的名字就需要改一下了,改为${xxx.yy}这种形式.可以理解为,表格的每一行对应Java List数组中的每一个下标对应的对象,一行中的每一列为该对象的各种属性.</p><h2 id="2-3-导出代码"><a href="#2-3-导出代码" class="headerlink" title="2.3 导出代码"></a>2.3 导出代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// word报告数据,从数据库读取,这部分自行定义</span><br>        <span class="hljs-type">InspectReportView</span> <span class="hljs-variable">inspectReport</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getInspectReport(query);<br>        <span class="hljs-comment">//获取Word模板，模板存放路径在项目的resources目录下的word文件夹下</span><br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">ins</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.getClass().getResourceAsStream(<span class="hljs-string">&quot;/word/巡视报告模板.docx&quot;</span>);<br>        <span class="hljs-comment">//注册xdocreport实例并加载FreeMarker模板引擎</span><br>        <span class="hljs-type">IXDocReport</span> <span class="hljs-variable">report</span> <span class="hljs-operator">=</span> XDocReportRegistry.getRegistry().loadReport(ins,<br>                TemplateEngineKind.Freemarker);<br>        <span class="hljs-comment">//创建xdocreport上下文对象</span><br>        <span class="hljs-type">IContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> report.createContext();<br>        <span class="hljs-comment">// 单个字段插值</span><br>        context.put(<span class="hljs-string">&quot;subName&quot;</span>, inspectReport.getSubName());<br>        context.put(<span class="hljs-string">&quot;voltage&quot;</span>, inspectReport.getVoltage());<br>        context.put(<span class="hljs-string">&quot;inspectDate&quot;</span>, inspectReport.getInspectDate());<br>        context.put(<span class="hljs-string">&quot;subType&quot;</span>, inspectReport.getSubType());<br>        context.put(<span class="hljs-string">&quot;taskName&quot;</span>, inspectReport.getTaskName());<br>        context.put(<span class="hljs-string">&quot;envInfo&quot;</span>, inspectReport.getEnvInfo());<br>        context.put(<span class="hljs-string">&quot;checkUser&quot;</span>, inspectReport.getCheckUser());<br>        context.put(<span class="hljs-string">&quot;checkTime&quot;</span>, inspectReport.getCheckTime());<br>        context.put(<span class="hljs-string">&quot;startTime&quot;</span>, inspectReport.getStartTime());<br>        context.put(<span class="hljs-string">&quot;endTime&quot;</span>, inspectReport.getEndTime());<br>        context.put(<span class="hljs-string">&quot;inspectStatistical&quot;</span>, inspectReport.getInspectStatistical());<br>        context.put(<span class="hljs-string">&quot;inspectConclusion&quot;</span>, inspectReport.getInspectConclusion());<br>        context.put(<span class="hljs-string">&quot;normalDataList&quot;</span>, inspectReport.getNormalDataList());<br>        context.put(<span class="hljs-string">&quot;abNormalDataList&quot;</span>, inspectReport.getAbnormalDataList());<br>        context.put(<span class="hljs-string">&quot;notConfirmDataList&quot;</span>, inspectReport.getNotConfirmDataList());<br>        <span class="hljs-comment">//创建字段元数据</span><br>        <span class="hljs-type">FieldsMetadata</span> <span class="hljs-variable">fm</span> <span class="hljs-operator">=</span> report.createFieldsMetadata();<br>        <span class="hljs-comment">//Word模板中的表格插值</span><br>        fm.load(<span class="hljs-string">&quot;normalDataList&quot;</span>, InspectReportNormalDto.class, <span class="hljs-literal">true</span>);<br>        fm.load(<span class="hljs-string">&quot;abNormalDataList&quot;</span>, InspectReportAbnormalDto.class, <span class="hljs-literal">true</span>);<br>        fm.load(<span class="hljs-string">&quot;notConfirmDataList&quot;</span>, InspectReportNotConfirmDto.class, <span class="hljs-literal">true</span>);<br>        <span class="hljs-comment">//输出到本地目录作为临时文件</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;巡视报告-cache-&quot;</span>+IdUtil.fastSimpleUUID()+<span class="hljs-string">&quot;.docx&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;user.dir&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">wordPath</span> <span class="hljs-operator">=</span> path + <span class="hljs-string">&quot;/word-cache/&quot;</span>+fileName;<br>        <span class="hljs-comment">// 输出地址为项目工程目录下的cache文件夹下,这时候的表格中还没有存入图片</span><br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(wordPath);<br><span class="hljs-comment">// 写入本地</span><br>        report.process(context, out);<br>        out.close();<br>        <span class="hljs-comment">// 把图片插入word中的列表</span><br>        <span class="hljs-built_in">this</span>.insertPictureIntoWord(wordPath,inspectReport,response);<br></code></pre></td></tr></table></figure><p>插入图片</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 将图片插入word</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> filePathName  文件路径</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> inspectReport 报告数据</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> response</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertPictureIntoWord</span><span class="hljs-params">(String filePathName,InspectReportView inspectReport,</span><br><span class="hljs-params">                                       HttpServletResponse response)</span>&#123;<br>        <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">wordInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">XWPFDocument</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 读取word临时文件</span><br>            wordInputStream = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(filePathName);<br>            <span class="hljs-comment">// 读取word封装的doc</span><br>            doc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XWPFDocument</span>(wordInputStream);<br>            <span class="hljs-comment">// word中所有的表格</span><br>            List&lt;XWPFTable&gt; tables = doc.getTables();<br>            <span class="hljs-comment">// 正常点位列表</span><br>            List&lt;InspectReportNormalDto&gt; normalDataList = inspectReport.getNormalDataList();<br>            <span class="hljs-keyword">if</span> (normalDataList.size() != <span class="hljs-number">0</span>)&#123;<br>                <span class="hljs-comment">// word中的第二个表格是正常点位表</span><br>                <span class="hljs-type">XWPFTable</span> <span class="hljs-variable">table</span> <span class="hljs-operator">=</span> tables.get(<span class="hljs-number">1</span>);<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; normalDataList.size(); i++) &#123;<br>                    <span class="hljs-type">InspectReportNormalDto</span> <span class="hljs-variable">normalData</span> <span class="hljs-operator">=</span> normalDataList.get(i);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">imageUrl</span> <span class="hljs-operator">=</span> normalData.getImageUrl();<br>                    <span class="hljs-comment">// 该数据在表中的行数的index,+1是因为表头占了一行</span><br>                    <span class="hljs-type">int</span> <span class="hljs-variable">rowIndex</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>+i;<br>                    <span class="hljs-comment">// 图片列在表格的第十列</span><br>                    <span class="hljs-type">int</span> <span class="hljs-variable">columnIndex</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;<br>                    <span class="hljs-comment">// 根据行列获取单元格</span><br>                    <span class="hljs-type">XWPFParagraph</span> <span class="hljs-variable">cell</span> <span class="hljs-operator">=</span> table.getRow(rowIndex).getCell(columnIndex).addParagraph();<br>                    <span class="hljs-comment">// 根据imageUrl获取图片</span><br>                    <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> (HttpURLConnection) <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(imageUrl).openConnection();<br>                    connection.setReadTimeout(<span class="hljs-number">2000</span>);<br>                    connection.setConnectTimeout(<span class="hljs-number">2000</span>);<br>                    connection.setRequestMethod(<span class="hljs-string">&quot;GET&quot;</span>);<br>                    InputStream imageInputStream;<br>                    <span class="hljs-comment">// 请求成功</span><br>                    <span class="hljs-keyword">if</span> (connection.getResponseCode() == HttpURLConnection.HTTP_OK) &#123;<br>                        imageInputStream = connection.getInputStream();<br>                        <span class="hljs-comment">// cell的执行对象</span><br>                        <span class="hljs-type">XWPFRun</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> cell.createRun();<br>                        run.addPicture(imageInputStream, XWPFDocument.PICTURE_TYPE_JPEG,<br>                                <span class="hljs-string">&quot;图片&quot;</span>, Units.toEMU(<span class="hljs-number">128</span>), Units.toEMU(<span class="hljs-number">72</span>));<br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-comment">// 异常点位列表</span><br>            List&lt;InspectReportAbnormalDto&gt; abnormalDataList = inspectReport.getAbnormalDataList();<br>            <span class="hljs-keyword">if</span> (abnormalDataList.size() != <span class="hljs-number">0</span>)&#123;<br>                <span class="hljs-comment">// word中的第三个表格是异常点位表</span><br>                <span class="hljs-type">XWPFTable</span> <span class="hljs-variable">table</span> <span class="hljs-operator">=</span> tables.get(<span class="hljs-number">2</span>);<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; abnormalDataList.size(); i++) &#123;<br>                    <span class="hljs-type">InspectReportAbnormalDto</span> <span class="hljs-variable">abNormalData</span> <span class="hljs-operator">=</span> abnormalDataList.get(i);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">imageUrl</span> <span class="hljs-operator">=</span> abNormalData.getImageUrl();<br>                    <span class="hljs-comment">// 该数据在表中的行数的index,+1是因为表头占了一行</span><br>                    <span class="hljs-type">int</span> <span class="hljs-variable">rowIndex</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>+i;<br>                    <span class="hljs-comment">// 图片列在表格的第十列</span><br>                    <span class="hljs-type">int</span> <span class="hljs-variable">columnIndex</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;<br>                    <span class="hljs-comment">// 根据行列获取单元格</span><br>                    <span class="hljs-type">XWPFParagraph</span> <span class="hljs-variable">cell</span> <span class="hljs-operator">=</span> table.getRow(rowIndex).getCell(columnIndex).addParagraph();<br>                    <span class="hljs-comment">// 根据imageUrl获取图片</span><br>                    <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> (HttpURLConnection) <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(imageUrl).openConnection();<br>                    connection.setReadTimeout(<span class="hljs-number">2000</span>);<br>                    connection.setConnectTimeout(<span class="hljs-number">2000</span>);<br>                    connection.setRequestMethod(<span class="hljs-string">&quot;GET&quot;</span>);<br>                    InputStream imageInputStream;<br>                    <span class="hljs-comment">// 请求成功</span><br>                    <span class="hljs-keyword">if</span> (connection.getResponseCode() == HttpURLConnection.HTTP_OK) &#123;<br>                        imageInputStream = connection.getInputStream();<br>                        <span class="hljs-comment">// cell的执行对象</span><br>                        <span class="hljs-type">XWPFRun</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> cell.createRun();<br>                        run.addPicture(imageInputStream, XWPFDocument.PICTURE_TYPE_JPEG,<br>                                <span class="hljs-string">&quot;图片&quot;</span>, Units.toEMU(<span class="hljs-number">128</span>), Units.toEMU(<span class="hljs-number">72</span>));<br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-comment">// 待人工确认列表</span><br>            List&lt;InspectReportNotConfirmDto&gt; notConfirmDataList = inspectReport.getNotConfirmDataList();<br>            <span class="hljs-keyword">if</span> (abnormalDataList.size() != <span class="hljs-number">0</span>)&#123;<br>                <span class="hljs-comment">// word中的第四个表格是带人工确认点位表</span><br>                <span class="hljs-type">XWPFTable</span> <span class="hljs-variable">table</span> <span class="hljs-operator">=</span> tables.get(<span class="hljs-number">3</span>);<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; notConfirmDataList.size(); i++) &#123;<br>                    <span class="hljs-type">InspectReportNotConfirmDto</span> <span class="hljs-variable">notConfirmData</span> <span class="hljs-operator">=</span> notConfirmDataList.get(i);<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">imageUrl</span> <span class="hljs-operator">=</span> notConfirmData.getImageUrl();<br>                    <span class="hljs-comment">// 该数据在表中的行数的index,+1是因为表头占了一行</span><br>                    <span class="hljs-type">int</span> <span class="hljs-variable">rowIndex</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>+i;<br>                    <span class="hljs-comment">// 图片列在表格的第十列</span><br>                    <span class="hljs-type">int</span> <span class="hljs-variable">columnIndex</span> <span class="hljs-operator">=</span> <span class="hljs-number">9</span>;<br>                    <span class="hljs-comment">// 根据行列获取单元格</span><br>                    <span class="hljs-type">XWPFParagraph</span> <span class="hljs-variable">cell</span> <span class="hljs-operator">=</span> table.getRow(rowIndex).getCell(columnIndex).addParagraph();<br>                    <span class="hljs-comment">// 根据imageUrl获取图片</span><br>                    <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> (HttpURLConnection) <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(imageUrl).openConnection();<br>                    connection.setReadTimeout(<span class="hljs-number">2000</span>);<br>                    connection.setConnectTimeout(<span class="hljs-number">2000</span>);<br>                    connection.setRequestMethod(<span class="hljs-string">&quot;GET&quot;</span>);<br>                    InputStream imageInputStream;<br>                    <span class="hljs-comment">// 请求成功</span><br>                    <span class="hljs-keyword">if</span> (connection.getResponseCode() == HttpURLConnection.HTTP_OK) &#123;<br>                        imageInputStream = connection.getInputStream();<br>                        <span class="hljs-comment">// cell的执行对象</span><br>                        <span class="hljs-type">XWPFRun</span> <span class="hljs-variable">run</span> <span class="hljs-operator">=</span> cell.createRun();<br>                        run.addPicture(imageInputStream, XWPFDocument.PICTURE_TYPE_JPEG,<br>                                <span class="hljs-string">&quot;图片&quot;</span>, Units.toEMU(<span class="hljs-number">128</span>), Units.toEMU(<span class="hljs-number">72</span>));<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">catch</span> (Exception e)&#123;<br><br>        &#125;<br>        <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">try</span>&#123;<br>                <span class="hljs-type">ServletOutputStream</span> <span class="hljs-variable">responseOutputStream</span> <span class="hljs-operator">=</span> response.getOutputStream();<br>                response.setCharacterEncoding(<span class="hljs-string">&quot;utf-8&quot;</span>);<br>                response.setContentType(<span class="hljs-string">&quot;application/msword&quot;</span>);<br>                <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;巡视报告.docx&quot;</span>;<br>                response.setHeader(<span class="hljs-string">&quot;Content-Disposition&quot;</span>, <span class="hljs-string">&quot;attachment;filename=&quot;</span><br>                .concat(String.valueOf(URLEncoder.encode(fileName, <span class="hljs-string">&quot;UTF-8&quot;</span>))));<br>                <span class="hljs-comment">// word写入response</span><br>                doc.write(responseOutputStream);<br>                <span class="hljs-comment">// 关闭流</span><br>                wordInputStream.close();<br>                doc.close();<br>                <span class="hljs-comment">// 删除cache文件</span><br>                <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(filePathName);<br>                file.delete();<br>            &#125;<br>            <span class="hljs-keyword">catch</span> (IOException e)&#123;<br><br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="3-原理"><a href="#3-原理" class="headerlink" title="3. 原理"></a>3. 原理</h1><p>先利用<code>IXDocReport</code>将动态数据写入word,作为中间结果,再利用<code>XWPFDocument</code>手动根据数据行数遍历word中的表格,将图片插入表格中的每一行中</p>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>导出</tag>
      
      <tag>word</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>FTPSClient 522 SSL connection failed错误</title>
    <link href="/2022/08/26/FTPSClient/"/>
    <url>/2022/08/26/FTPSClient/</url>
    
    <content type="html"><![CDATA[<p>使用FTPSClient上传文件时出现<br>522 SSL connection failed; session reuse required: see require_ssl_reuse option in vsftpd.conf man page<br>的解决办法</p><span id="more"></span><h1 id="1-FTPSClient正常用法"><a href="#1-FTPSClient正常用法" class="headerlink" title="1.FTPSClient正常用法"></a>1.FTPSClient正常用法</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alan;<br><br><span class="hljs-keyword">import</span> org.apache.commons.net.ftp.FTP;<br><span class="hljs-keyword">import</span> org.apache.commons.net.ftp.FTPSClient;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 正常的FTPSClient写法</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> tengguokun</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022-08-26 10:56:18</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestFTPSClient</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">upload</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">FTPSClient</span> <span class="hljs-variable">ftpClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FTPSClient</span>();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 设置编码</span><br>            ftpClient.setControlEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>            <span class="hljs-comment">// 连接ftp服务器 ip和端口</span><br>            ftpClient.connect(<span class="hljs-string">&quot;192.168.1.100&quot;</span>, <span class="hljs-number">21</span>);<br>            <span class="hljs-comment">// 登录ftp服务器 用户名和用户密码</span><br>            ftpClient.login(<span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>            <span class="hljs-comment">// 被动模式</span><br>            ftpClient.enterLocalPassiveMode();<br>            <span class="hljs-comment">// 文件类型</span><br>            ftpClient.setFileType(FTP.STREAM_TRANSFER_MODE);<br>            <span class="hljs-comment">// 私密连接</span><br>            ftpClient.execPROT(<span class="hljs-string">&quot;P&quot;</span>);<br>            <span class="hljs-comment">// PBSZ命令必须在PROT命令之后</span><br>            ftpClient.execPBSZ(<span class="hljs-number">0</span>);<br>            <span class="hljs-comment">// 设置工作目录</span><br>            ftpClient.changeWorkingDirectory(<span class="hljs-string">&quot;/opt/data&quot;</span>);<br>            <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;E:/xxx.png&quot;</span>);<br>            <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(file);<br>            <span class="hljs-comment">// 上传文件</span><br>            ftpClient.storeFile(file.getName(), inputStream);<br>        &#125; <span class="hljs-keyword">catch</span> (MalformedURLException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>当我们按照这种方式上传文件的时候,控制台却报错了</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">522 </span>SSL connection failed; session reuse required: see require_ssl_reuse <span class="hljs-keyword">option</span> in vsftpd.conf man page<br></code></pre></td></tr></table></figure><p>同时可以看见FTPS服务器有上传的文件,但是文件大小为0kb</p><h1 id="2-错误原因"><a href="#2-错误原因" class="headerlink" title="2. 错误原因"></a>2. 错误原因</h1><p>从报错内容可以发现服务器使用的是vsftpd,</p><p>通过搜索得知vsftpd（和大多数其他 FTPS 服务器）需要在控制和数据连接之间重用SSL session作为安全措施.</p><p>这可确保最初进行身份验证的一方与发送或检索数据的一方相同，从而防止有人在经典的中间人攻击中通过身份验证后劫持数据连接</p><p><a href="https://scarybeastsecurity.blogspot.com/2009/02/vsftpd-210-released.html">vsftpd官网内容</a></p><p>但是我们使用Apache的<code>commons-net</code>依赖下的<code>FTPSClient</code>类却不支持SSL session 重用</p><p>Java Secure Socket Extension  (JSSE) 代码足够智能，可以为同一主机和端口重用 SSL 会话，但由于数据端口与控制端口不同，因此在生成新的 SSL 会话之前,需要人为地将控制会话存储到检查的 JSSE 缓存中</p><h1 id="3-解决方法"><a href="#3-解决方法" class="headerlink" title="3. 解决方法"></a>3. 解决方法</h1><ul><li>我创建了<code>MyFTPSClient</code>,继承<code>FTPSClient</code>并重写<code>_prepareDataSocket_</code>方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.glens.biz.common.utils.client;<br><br><span class="hljs-keyword">import</span> com.google.common.base.Throwables;<br><span class="hljs-keyword">import</span> org.apache.commons.net.ftp.FTPSClient;<br><br><span class="hljs-keyword">import</span> javax.net.ssl.SSLSession;<br><span class="hljs-keyword">import</span> javax.net.ssl.SSLSessionContext;<br><span class="hljs-keyword">import</span> javax.net.ssl.SSLSocket;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><span class="hljs-keyword">import</span> java.net.Socket;<br><span class="hljs-keyword">import</span> java.util.Locale;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> tengguokun</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022-08-26 14:58:24</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span></span><br><span class="hljs-comment"> * FTPSClient客户端&lt;br/&gt;</span><br><span class="hljs-comment"> * 这里重写了FTPSClient的_prepareDataSocket_方法&lt;br/&gt;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFtpsClient</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FTPSClient</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">_prepareDataSocket_</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Socket socket)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-keyword">if</span>(socket <span class="hljs-keyword">instanceof</span> SSLSocket) &#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">SSLSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> ((SSLSocket) _socket_).getSession();<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">SSLSessionContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> session.getSessionContext();<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">Field</span> <span class="hljs-variable">sessionHostPortCache</span> <span class="hljs-operator">=</span> context.getClass().getDeclaredField(<span class="hljs-string">&quot;sessionHostPortCache&quot;</span>);<br>                sessionHostPortCache.setAccessible(<span class="hljs-literal">true</span>);<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> sessionHostPortCache.get(context);<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">Method</span> <span class="hljs-variable">putMethod</span> <span class="hljs-operator">=</span> cache.getClass().getDeclaredMethod(<span class="hljs-string">&quot;put&quot;</span>, Object.class, Object.class);<br>                putMethod.setAccessible(<span class="hljs-literal">true</span>);<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">Method</span> <span class="hljs-variable">getHostMethod</span> <span class="hljs-operator">=</span> socket.getClass().getDeclaredMethod(<span class="hljs-string">&quot;getHost&quot;</span>);<br>                getHostMethod.setAccessible(<span class="hljs-literal">true</span>);<br>                <span class="hljs-type">Object</span> <span class="hljs-variable">host</span> <span class="hljs-operator">=</span> getHostMethod.invoke(socket);<br>                <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;%s:%s&quot;</span>, host, String.valueOf(socket.getPort())).toLowerCase(Locale.ROOT);<br>                putMethod.invoke(cache, key, session);<br>            &#125; <span class="hljs-keyword">catch</span>(Exception e) &#123;<br>                <span class="hljs-keyword">throw</span> Throwables.propagate(e);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li>接着使用我们自己的<code>MyFtpsClient</code>类实现功能</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.glens;<br><br><span class="hljs-keyword">import</span> com.glens.biz.common.utils.client.MyFtpsClient;<br><span class="hljs-keyword">import</span> org.apache.commons.net.ftp.FTP;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 正常的FTPSClient写法</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> tengguokun</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2022-08-26 10:56:18</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@description</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestFTPSClient</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">upload</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">MyFtpsClient</span> <span class="hljs-variable">ftpClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyFtpsClient</span>();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 设置jdk属性</span><br>            System.setProperty(<span class="hljs-string">&quot;jdk.tls.useExtendedMasterSecret&quot;</span>, <span class="hljs-string">&quot;false&quot;</span>);<br>            <span class="hljs-comment">// 设置编码</span><br>            ftpClient.setControlEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>            <span class="hljs-comment">// 连接ftp服务器 ip和端口</span><br>            ftpClient.connect(<span class="hljs-string">&quot;192.168.1.100&quot;</span>, <span class="hljs-number">21</span>);<br>            <span class="hljs-comment">// 登录ftp服务器 用户名和用户密码</span><br>            ftpClient.login(<span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;123456&quot;</span>);<br>            <span class="hljs-comment">// 被动模式</span><br>            ftpClient.enterLocalPassiveMode();<br>            <span class="hljs-comment">// 文件类型</span><br>            ftpClient.setFileType(FTP.STREAM_TRANSFER_MODE);<br>            <span class="hljs-comment">// 私密连接</span><br>            ftpClient.execPROT(<span class="hljs-string">&quot;P&quot;</span>);<br>            <span class="hljs-comment">// PBSZ命令必须在PROT命令之后</span><br>            ftpClient.execPBSZ(<span class="hljs-number">0</span>);<br>            <span class="hljs-comment">// 设置工作目录</span><br>            ftpClient.changeWorkingDirectory(<span class="hljs-string">&quot;/opt/data&quot;</span>);<br>            <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;E:/xxx.png&quot;</span>);<br>            <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(file);<br>            <span class="hljs-comment">// 上传文件</span><br>            ftpClient.storeFile(file.getName(), inputStream);<br>        &#125; <span class="hljs-keyword">catch</span> (MalformedURLException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>至此,该问题完美解决了</p><hr><p>参考原文:<a href="https://eng.wealthfront.com/2016/06/10/connecting-to-an-ftps-server-with-ssl-session-reuse-in-java-7-and-8/">Connecting to an FTPS Server with SSL Session Reuse in Java 7 and 8</a></p>]]></content>
    
    
    <categories>
      
      <category>报错解决</category>
      
    </categories>
    
    
    <tags>
      
      <tag>FTPS</tag>
      
      <tag>FTPSClient</tag>
      
      <tag>常见报错</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>本站搭建指南</title>
    <link href="/2022/08/25/%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/"/>
    <url>/2022/08/25/%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<p>本站搭建十分简单,主要依赖hexo网站框架和hexo-theme-fluid主题,无需写代码即可搭建精美的博客站点</p><span id="more"></span><h1 id="1-Hexo"><a href="#1-Hexo" class="headerlink" title="1. Hexo"></a>1. Hexo</h1><h2 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h2><p><a href="https://hexo.io/zh-cn/docs/">Hexo官网</a></p><p>Hexo 是一个快速、简洁且高效的博客框架。Hexo 使用 <a href="http://daringfireball.net/projects/markdown/">Markdown</a>（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。</p><ul><li><strong>超快速度</strong></li></ul><p>Node.js 所带来的超快生成速度，让上百个页面在几秒内瞬间完成渲染。</p><ul><li><strong>支持 Markdown</strong></li></ul><p>Hexo 支持 GitHub Flavored Markdown 的所有功能，甚至可以整合 Octopress 的大多数插件。</p><ul><li><strong>一键部署</strong></li></ul><p>只需一条指令即可部署到 GitHub Pages, Heroku 或其他平台。</p><ul><li><strong>插件和可扩展性</strong></li></ul><p>强大的 API 带来无限的可能，与数种模板引擎（EJS，Pug，Nunjucks）和工具（Babel，PostCSS，Less&#x2F;Sass）轻易集成</p><h2 id="1-2-安装"><a href="#1-2-安装" class="headerlink" title="1.2 安装"></a>1.2 安装</h2><p>安装 Hexo 相当简单，只需要先安装下列应用程序即可：</p><ul><li><a href="http://nodejs.org/">Node.js</a> (Node.js 版本需不低于 10.13，建议使用 Node.js 12.0 及以上版本)</li><li><a href="http://git-scm.com/">Git</a></li></ul><p>所有必备的应用程序安装完成后，即可使用 npm 安装 Hexo。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">npm install -g hexo-cli</span><br></code></pre></td></tr></table></figure><h2 id="1-3-创建Hexo应用"><a href="#1-3-创建Hexo应用" class="headerlink" title="1.3 创建Hexo应用"></a>1.3 创建Hexo应用</h2><p>安装 Hexo 完成后，请执行下列命令，Hexo 将会在指定文件夹中新建所需要的文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">hexo init &lt;folder&gt;</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> &lt;folder&gt;</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">npm install</span><br></code></pre></td></tr></table></figure><p>或者新建文件夹,进入文件夹执行命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">hexo init</span> <br><span class="hljs-meta prompt_">$ </span><span class="language-bash">npm install</span><br></code></pre></td></tr></table></figure><p>这样Hexo就安装完成,并已经生成好了一个网站模板</p><h2 id="1-4-目录结构"><a href="#1-4-目录结构" class="headerlink" title="1.4 目录结构"></a>1.4 目录结构</h2><p>新建完成后，文件夹的目录如下：</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sqf">.<br>├── <span class="hljs-variable">_config</span>.yml<br>├── package.json<br>├── scaffolds<br>├── source<br>|   ├── <span class="hljs-variable">_drafts</span><br>|   └── <span class="hljs-variable">_posts</span><br>└── themes<br></code></pre></td></tr></table></figure><h3 id="config-yml"><a href="#config-yml" class="headerlink" title="_config.yml"></a>_config.yml</h3><p>网站的 <a href="https://hexo.io/zh-cn/docs/configuration">配置</a> 信息，您可以在此配置大部分的参数。</p><h3 id="source"><a href="#source" class="headerlink" title="source"></a>source</h3><p>资源文件夹是存放用户资源的地方。除 <code>_posts</code> 文件夹之外，开头命名为 <code>_</code> (下划线)的文件 &#x2F; 文件夹和隐藏的文件将会被忽略。Markdown 和 HTML 文件会被解析并放到 <code>public</code> 文件夹，而其他文件会被拷贝过去。</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">package</span>.json&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;hexo-site&quot;</span>,<br>  <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;0.0.0&quot;</span>,<br>  <span class="hljs-string">&quot;private&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;hexo&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;dependencies&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;hexo&quot;</span>: <span class="hljs-string">&quot;^3.8.0&quot;</span>,<br>    <span class="hljs-string">&quot;hexo-generator-archive&quot;</span>: <span class="hljs-string">&quot;^0.1.5&quot;</span>,<br>    <span class="hljs-string">&quot;hexo-generator-category&quot;</span>: <span class="hljs-string">&quot;^0.1.3&quot;</span>,<br>    <span class="hljs-string">&quot;hexo-generator-index&quot;</span>: <span class="hljs-string">&quot;^0.2.1&quot;</span>,<br>    <span class="hljs-string">&quot;hexo-generator-tag&quot;</span>: <span class="hljs-string">&quot;^0.2.0&quot;</span>,<br>    <span class="hljs-string">&quot;hexo-renderer-ejs&quot;</span>: <span class="hljs-string">&quot;^0.3.1&quot;</span>,<br>    <span class="hljs-string">&quot;hexo-renderer-stylus&quot;</span>: <span class="hljs-string">&quot;^0.3.3&quot;</span>,<br>    <span class="hljs-string">&quot;hexo-renderer-marked&quot;</span>: <span class="hljs-string">&quot;^0.3.2&quot;</span>,<br>    <span class="hljs-string">&quot;hexo-server&quot;</span>: <span class="hljs-string">&quot;^0.3.3&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h1 id="2-Fluid"><a href="#2-Fluid" class="headerlink" title="2. Fluid"></a>2. Fluid</h1><h2 id="2-1-简介"><a href="#2-1-简介" class="headerlink" title="2.1 简介"></a>2.1 简介</h2><p>一款 Material Design 风格的主题</p><p><a href="https://github.com/fluid-dev/hexo-theme-fluid">Fluid官方仓库</a></p><h2 id="2-2-安装"><a href="#2-2-安装" class="headerlink" title="2.2 安装"></a>2.2 安装</h2><p>通过 npm 直接安装</p><p>进入博客目录执行命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install --save hexo-theme-fluid<br></code></pre></td></tr></table></figure><p>然后在博客目录下创建 <code>_config.fluid.yml</code>,这是Fluid主题的配置文件</p><p>全部的配置项如下</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># Hexo Theme Fluid</span><br><span class="hljs-comment"># Author: Fluid-dev</span><br><span class="hljs-comment"># Github: https://github.com/fluid-dev/hexo-theme-fluid</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># 配置指南: https://hexo.fluid-dev.com/docs/guide/</span><br><span class="hljs-comment"># 你可以从指南中获得更详细的说明</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Guide: https://hexo.fluid-dev.com/docs/en/guide/</span><br><span class="hljs-comment"># You can get more detailed help from the guide</span><br><span class="hljs-comment">#---------------------------</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 全局</span><br><span class="hljs-comment"># Global</span><br><span class="hljs-comment">#---------------------------</span><br><br><span class="hljs-comment"># 用于浏览器标签的图标</span><br><span class="hljs-comment"># Icon for browser tab</span><br><span class="hljs-attr">favicon:</span> <span class="hljs-string">/img/fluid.png</span><br><br><span class="hljs-comment"># 用于苹果设备的图标</span><br><span class="hljs-comment"># Icon for Apple touch</span><br><span class="hljs-attr">apple_touch_icon:</span> <span class="hljs-string">/img/fluid.png</span><br><br><span class="hljs-comment"># 浏览器标签页中的标题分隔符，效果： 文章名 - 站点名</span><br><span class="hljs-comment"># Title separator in browser tab, eg: article - site</span><br><span class="hljs-attr">tab_title_separator:</span> <span class="hljs-string">&quot; - &quot;</span><br><br><span class="hljs-comment"># 强制所有链接升级为 HTTPS（适用于图片等资源出现 HTTP 混入报错）</span><br><span class="hljs-comment"># Force all links to be HTTPS (applicable to HTTP mixed error)</span><br><span class="hljs-attr">force_https:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-comment"># 代码块的增强配置</span><br><span class="hljs-comment"># Enhancements to code blocks</span><br><span class="hljs-attr">code:</span><br>  <span class="hljs-comment"># 是否开启复制代码的按钮</span><br>  <span class="hljs-comment"># Enable copy code button</span><br>  <span class="hljs-attr">copy_btn:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># 代码语言</span><br>  <span class="hljs-comment"># Code language</span><br>  <span class="hljs-attr">language:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">default:</span> <span class="hljs-string">&quot;TEXT&quot;</span><br><br>  <span class="hljs-comment"># 代码高亮</span><br>  <span class="hljs-comment"># Code highlight</span><br>  <span class="hljs-attr">highlight:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># 代码块是否显示行号</span><br>    <span class="hljs-comment"># If true, the code block display line numbers</span><br>    <span class="hljs-attr">line_number:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># 实现高亮的库，对应下面的设置</span><br>    <span class="hljs-comment"># Highlight library</span><br>    <span class="hljs-comment"># Options: highlightjs | prismjs</span><br>    <span class="hljs-attr">lib:</span> <span class="hljs-string">&quot;highlightjs&quot;</span><br><br>    <span class="hljs-attr">highlightjs:</span><br>      <span class="hljs-comment"># 在链接中挑选 style 填入</span><br>      <span class="hljs-comment"># Select a style in the link</span><br>      <span class="hljs-comment"># See: https://highlightjs.org/static/demo/</span><br>      <span class="hljs-attr">style:</span> <span class="hljs-string">&quot;github gist&quot;</span><br>      <span class="hljs-attr">style_dark:</span> <span class="hljs-string">&quot;dark&quot;</span><br><br>    <span class="hljs-attr">prismjs:</span><br>      <span class="hljs-comment"># 在下方链接页面右侧的圆形按钮挑选 style 填入，也可以直接填入 css 链接</span><br>      <span class="hljs-comment"># Select the style button on the right side of the link page, you can also set the CSS link</span><br>      <span class="hljs-comment"># See: https://prismjs.com/</span><br>      <span class="hljs-attr">style:</span> <span class="hljs-string">&quot;default&quot;</span><br>      <span class="hljs-attr">style_dark:</span> <span class="hljs-string">&quot;tomorrow night&quot;</span><br><br>      <span class="hljs-comment"># 设为 true 高亮将本地静态生成（但只支持部分 prismjs 插件），设为 false 高亮将在浏览器通过 js 生成</span><br>      <span class="hljs-comment"># If true, it will be generated locally (but some prismjs plugins are not supported). If false, it will be generated via JS in the browser</span><br>      <span class="hljs-attr">preprocess:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># 一些好玩的功能</span><br><span class="hljs-comment"># Some fun features</span><br><span class="hljs-attr">fun_features:</span><br>  <span class="hljs-comment"># 为 subtitle 添加打字机效果</span><br>  <span class="hljs-comment"># Typing animation for subtitle</span><br>  <span class="hljs-attr">typing:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># 打印速度，数字越大越慢</span><br>    <span class="hljs-comment"># Typing speed, the larger the number, the slower</span><br>    <span class="hljs-attr">typeSpeed:</span> <span class="hljs-number">70</span><br><br>    <span class="hljs-comment"># 游标字符</span><br>    <span class="hljs-comment"># Cursor character</span><br>    <span class="hljs-attr">cursorChar:</span> <span class="hljs-string">&quot;_&quot;</span><br><br>    <span class="hljs-comment"># 是否循环播放效果</span><br>    <span class="hljs-comment"># If true, loop animation</span><br>    <span class="hljs-attr">loop:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># 在指定页面开启，不填则在所有页面开启</span><br>    <span class="hljs-comment"># Enable in specified page, all pages by default</span><br>    <span class="hljs-comment"># Options: home | post | tag | category | about | links | page | 404</span><br>    <span class="hljs-attr">scope:</span> []<br><br>  <span class="hljs-comment"># 为文章内容中的标题添加锚图标</span><br>  <span class="hljs-comment"># Add an anchor icon to the title on the post page</span><br>  <span class="hljs-attr">anchorjs:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">element:</span> <span class="hljs-string">h1,h2,h3,h4,h5,h6</span><br>    <span class="hljs-comment"># Options: left | right</span><br>    <span class="hljs-attr">placement:</span> <span class="hljs-string">left</span><br>    <span class="hljs-comment"># Options: hover | always | touch</span><br>    <span class="hljs-attr">visible:</span> <span class="hljs-string">hover</span><br>    <span class="hljs-comment"># Options: § | # | ❡</span><br>    <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;&quot;</span><br><br>  <span class="hljs-comment"># 加载进度条</span><br>  <span class="hljs-comment"># Progress bar when loading</span><br>  <span class="hljs-attr">progressbar:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">height_px:</span> <span class="hljs-number">3</span><br>    <span class="hljs-attr">color:</span> <span class="hljs-string">&quot;#29d&quot;</span><br>    <span class="hljs-comment"># See: https://github.com/rstacruz/nprogress</span><br>    <span class="hljs-attr">options:</span> &#123; <span class="hljs-attr">showSpinner:</span> <span class="hljs-literal">false</span>, <span class="hljs-attr">trickleSpeed:</span> <span class="hljs-number">100</span> &#125;<br><br><span class="hljs-comment"># 主题暗色模式，开启后菜单中会出现切换按钮，用户浏览器会存储切换选项，并且会遵循 prefers-color-scheme 自动切换</span><br><span class="hljs-comment"># Theme dark mode. If enable, a switch button will appear on the menu, each of the visitor&#x27;s browser will store his switch option</span><br><span class="hljs-attr">dark_mode:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># 默认的选项（当用户手动切换后则不再按照默认模式），选择 `auto` 会优先遵循 prefers-color-scheme，其次按用户本地时间 18 点到次日 6 点之间进入暗色模式</span><br>  <span class="hljs-comment"># Default option (when the visitor switches manually, the default mode is no longer followed), choosing `auto` will give priority to prefers-color-scheme, and then enter the dark mode from 18:00 to 6:00 in the visitor’s local time</span><br>  <span class="hljs-comment"># Options: auto | light | dark</span><br>  <span class="hljs-attr">default:</span> <span class="hljs-string">auto</span><br><br><span class="hljs-comment"># 主题颜色配置，其他不生效的地方请使用自定义 css 解决，配色可以在下方链接中获得启发</span><br><span class="hljs-comment"># Theme color, please use custom CSS to solve other colors, color schema can be inspired by the links below</span><br><span class="hljs-comment"># See: https://www.webdesignrankings.com/resources/lolcolors/</span><br><span class="hljs-attr">color:</span><br>  <span class="hljs-comment"># body 背景色</span><br>  <span class="hljs-comment"># Color of body background</span><br>  <span class="hljs-attr">body_bg_color:</span> <span class="hljs-string">&quot;#eee&quot;</span><br>  <span class="hljs-comment"># 暗色模式下的 body 背景色，下同</span><br>  <span class="hljs-comment"># Color in dark mode, the same below</span><br>  <span class="hljs-attr">body_bg_color_dark:</span> <span class="hljs-string">&quot;#181c27&quot;</span><br><br>  <span class="hljs-comment"># 顶部菜单背景色</span><br>  <span class="hljs-comment"># Color of navigation bar background</span><br>  <span class="hljs-attr">navbar_bg_color:</span> <span class="hljs-string">&quot;#2f4154&quot;</span><br>  <span class="hljs-attr">navbar_bg_color_dark:</span> <span class="hljs-string">&quot;#1f3144&quot;</span><br><br>  <span class="hljs-comment"># 顶部菜单字体色</span><br>  <span class="hljs-comment"># Color of navigation bar text</span><br>  <span class="hljs-attr">navbar_text_color:</span> <span class="hljs-string">&quot;#fff&quot;</span><br>  <span class="hljs-attr">navbar_text_color_dark:</span> <span class="hljs-string">&quot;#d0d0d0&quot;</span><br><br>  <span class="hljs-comment"># 副标题字体色</span><br>  <span class="hljs-comment"># Color of navigation bar text</span><br>  <span class="hljs-attr">subtitle_color:</span> <span class="hljs-string">&quot;#fff&quot;</span><br>  <span class="hljs-attr">subtitle_color_dark:</span> <span class="hljs-string">&quot;#d0d0d0&quot;</span><br><br>  <span class="hljs-comment"># 全局字体色</span><br>  <span class="hljs-comment"># Color of global text</span><br>  <span class="hljs-attr">text_color:</span> <span class="hljs-string">&quot;#3c4858&quot;</span><br>  <span class="hljs-attr">text_color_dark:</span> <span class="hljs-string">&quot;#c4c6c9&quot;</span><br><br>  <span class="hljs-comment"># 全局次级字体色（摘要、简介等位置）</span><br>  <span class="hljs-comment"># Color of global secondary text (excerpt, introduction, etc.)</span><br>  <span class="hljs-attr">sec_text_color:</span> <span class="hljs-string">&quot;#718096&quot;</span><br>  <span class="hljs-attr">sec_text_color_dark:</span> <span class="hljs-string">&quot;#a7a9ad&quot;</span><br><br>  <span class="hljs-comment"># 主面板背景色</span><br>  <span class="hljs-comment"># Color of main board</span><br>  <span class="hljs-attr">board_color:</span> <span class="hljs-string">&quot;#fff&quot;</span><br>  <span class="hljs-attr">board_color_dark:</span> <span class="hljs-string">&quot;#252d38&quot;</span><br><br>  <span class="hljs-comment"># 文章正文字体色</span><br>  <span class="hljs-comment"># Color of post text</span><br>  <span class="hljs-attr">post_text_color:</span> <span class="hljs-string">&quot;#2c3e50&quot;</span><br>  <span class="hljs-attr">post_text_color_dark:</span> <span class="hljs-string">&quot;#c4c6c9&quot;</span><br><br>  <span class="hljs-comment"># 文章正文字体色（h1 h2 h3...）</span><br>  <span class="hljs-comment"># Color of Article heading (h1 h2 h3...)</span><br>  <span class="hljs-attr">post_heading_color:</span> <span class="hljs-string">&quot;#1a202c&quot;</span><br>  <span class="hljs-attr">post_heading_color_dark:</span> <span class="hljs-string">&quot;#c4c6c9&quot;</span><br><br>  <span class="hljs-comment"># 文章超链接字体色</span><br>  <span class="hljs-comment"># Color of post link</span><br>  <span class="hljs-attr">post_link_color:</span> <span class="hljs-string">&quot;#0366d6&quot;</span><br>  <span class="hljs-attr">post_link_color_dark:</span> <span class="hljs-string">&quot;#1589e9&quot;</span><br><br>  <span class="hljs-comment"># 超链接悬浮时字体色</span><br>  <span class="hljs-comment"># Color of link when hovering</span><br>  <span class="hljs-attr">link_hover_color:</span> <span class="hljs-string">&quot;#30a9de&quot;</span><br>  <span class="hljs-attr">link_hover_color_dark:</span> <span class="hljs-string">&quot;#30a9de&quot;</span><br><br>  <span class="hljs-comment"># 超链接悬浮背景色</span><br>  <span class="hljs-comment"># Color of link background when hovering</span><br>  <span class="hljs-attr">link_hover_bg_color:</span> <span class="hljs-string">&quot;#f8f9fa&quot;</span><br>  <span class="hljs-attr">link_hover_bg_color_dark:</span> <span class="hljs-string">&quot;#364151&quot;</span><br><br>  <span class="hljs-comment"># 分隔线和表格边线的颜色</span><br>  <span class="hljs-comment"># Color of horizontal rule and table border</span><br>  <span class="hljs-attr">line_color:</span> <span class="hljs-string">&quot;#eaecef&quot;</span><br>  <span class="hljs-attr">line_color_dark:</span> <span class="hljs-string">&quot;#435266&quot;</span><br><br>  <span class="hljs-comment"># 滚动条颜色</span><br>  <span class="hljs-comment"># Color of scrollbar</span><br>  <span class="hljs-attr">scrollbar_color:</span> <span class="hljs-string">&quot;#c4c6c9&quot;</span><br>  <span class="hljs-attr">scrollbar_color_dark:</span> <span class="hljs-string">&quot;#687582&quot;</span><br>  <span class="hljs-comment"># 滚动条悬浮颜色</span><br>  <span class="hljs-comment"># Color of scrollbar when hovering</span><br>  <span class="hljs-attr">scrollbar_hover_color:</span> <span class="hljs-string">&quot;#a6a6a6&quot;</span><br>  <span class="hljs-attr">scrollbar_hover_color_dark:</span> <span class="hljs-string">&quot;#9da8b3&quot;</span><br><br>  <span class="hljs-comment"># 按钮背景色</span><br>  <span class="hljs-comment"># Color of button</span><br>  <span class="hljs-attr">button_bg_color:</span> <span class="hljs-string">&quot;transparent&quot;</span><br>  <span class="hljs-attr">button_bg_color_dark:</span> <span class="hljs-string">&quot;transparent&quot;</span><br>  <span class="hljs-comment"># 按钮悬浮背景色</span><br>  <span class="hljs-comment"># Color of button when hovering</span><br>  <span class="hljs-attr">button_hover_bg_color:</span> <span class="hljs-string">&quot;#f2f3f5&quot;</span><br>  <span class="hljs-attr">button_hover_bg_color_dark:</span> <span class="hljs-string">&quot;#46647e&quot;</span><br><br><span class="hljs-comment"># 主题字体配置</span><br><span class="hljs-comment"># Font</span><br><span class="hljs-attr">font:</span><br>  <span class="hljs-attr">font_size:</span> <span class="hljs-string">16px</span><br>  <span class="hljs-attr">font_family:</span><br>  <span class="hljs-attr">letter_spacing:</span> <span class="hljs-number">0.</span><span class="hljs-string">02em</span><br>  <span class="hljs-attr">code_font_size:</span> <span class="hljs-number">85</span><span class="hljs-string">%</span><br><br><span class="hljs-comment"># 指定自定义 .js 文件路径，支持列表；路径是相对 source 目录，如 /js/custom.js 对应存放目录 source/js/custom.js</span><br><span class="hljs-comment"># Specify the path of your custom js file, support list. The path is relative to the source directory, such as `/js/custom.js` corresponding to the directory `source/js/custom.js`</span><br><span class="hljs-attr">custom_js:</span><br><br><span class="hljs-comment"># 指定自定义 .css 文件路径，用法和 custom_js 相同</span><br><span class="hljs-comment"># The usage is the same as custom_js</span><br><span class="hljs-attr">custom_css:</span><br><br><span class="hljs-comment"># 网页访问统计</span><br><span class="hljs-comment"># Analysis of website visitors</span><br><span class="hljs-attr">web_analytics:</span>  <span class="hljs-comment"># 网页访问统计</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br><br>  <span class="hljs-comment"># 遵循访客浏览器&quot;请勿追踪&quot;的设置，如果开启则不统计其访问</span><br>  <span class="hljs-comment"># Follow the &quot;Do Not Track&quot; setting of the visitor&#x27;s browser</span><br>  <span class="hljs-comment"># See: https://www.w3.org/TR/tracking-dnt/</span><br>  <span class="hljs-attr">follow_dnt:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># 百度统计的 Key，值需要获取下方链接中 `hm.js?` 后边的字符串</span><br>  <span class="hljs-comment"># Baidu analytics, get the string behind `hm.js?`</span><br>  <span class="hljs-comment"># See: https://tongji.baidu.com/sc-web/10000033910/home/site/getjs?siteId=13751376</span><br>  <span class="hljs-attr">baidu:</span><br><br>  <span class="hljs-comment"># Google 统计的 Tracking ID</span><br>  <span class="hljs-comment"># Google analytics, set Tracking ID</span><br>  <span class="hljs-comment"># See: https://developers.google.com/analytics/devguides/collection/analyticsjs</span><br>  <span class="hljs-attr">google:</span><br><br>  <span class="hljs-comment"># Google gtag.js 的媒体资源 ID</span><br>  <span class="hljs-comment"># Google gtag.js GA_MEASUREMENT_ID</span><br>  <span class="hljs-comment"># See: https://developers.google.com/analytics/devguides/collection/gtagjs/</span><br>  <span class="hljs-attr">gtag:</span><br><br>  <span class="hljs-comment"># 腾讯统计的 H5 App ID，开启高级功能才有cid</span><br>  <span class="hljs-comment"># Tencent analytics, set APP ID</span><br>  <span class="hljs-comment"># See: https://mta.qq.com/h5/manage/ctr_app_manage</span><br>  <span class="hljs-attr">tencent:</span><br>    <span class="hljs-attr">sid:</span><br>    <span class="hljs-attr">cid:</span><br><br>  <span class="hljs-comment"># 51.la 站点统计 ID</span><br>  <span class="hljs-comment"># 51.la analytics</span><br>  <span class="hljs-comment"># See: https://www.51.la/user/site/index</span><br>  <span class="hljs-attr">woyaola:</span>  <span class="hljs-comment"># 51.la 站点统计 ID，参见</span><br><br>  <span class="hljs-comment"># 友盟/cnzz 站点统计 web_id</span><br>  <span class="hljs-comment"># cnzz analytics</span><br>  <span class="hljs-comment"># See: https://web.umeng.com/main.php?c=site&amp;a=show</span><br>  <span class="hljs-attr">cnzz:</span><br><br>  <span class="hljs-comment"># LeanCloud 计数统计，可用于 PV UV 展示，如果 `web_analytics: enable` 没有开启，PV UV 展示只会查询不会增加</span><br>  <span class="hljs-comment"># LeanCloud count statistics, which can be used for PV UV display. If `web_analytics: enable` is false, PV UV display will only query and not increase</span><br>  <span class="hljs-attr">leancloud:</span><br>    <span class="hljs-attr">app_id:</span><br>    <span class="hljs-attr">app_key:</span><br>    <span class="hljs-comment"># REST API 服务器地址，国际版不填</span><br>    <span class="hljs-comment"># Only the Chinese mainland users need to set</span><br>    <span class="hljs-attr">server_url:</span><br>    <span class="hljs-comment"># 统计页面时获取路径的属性</span><br>    <span class="hljs-comment"># Get the attribute of the page path during statistics</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">window.location.pathname</span><br>    <span class="hljs-comment"># 开启后不统计本地路径( localhost 与 127.0.0.1 )</span><br>    <span class="hljs-comment"># If true, ignore localhost &amp; 127.0.0.1</span><br>    <span class="hljs-attr">ignore_local:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-comment"># 对页面中的图片和评论插件进行懒加载处理，可见范围外的元素不会提前加载</span><br><span class="hljs-comment"># Lazy loading of images and comment plugin on the page</span><br><span class="hljs-attr">lazyload:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># 加载时的占位图片</span><br>  <span class="hljs-comment"># The placeholder image when loading</span><br>  <span class="hljs-attr">loading_img:</span> <span class="hljs-string">/img/loading.gif</span><br><br>  <span class="hljs-comment"># 开启后懒加载仅在文章页生效，如果自定义页面需要使用，可以在 Front-matter 里指定 `lazyload: true`</span><br>  <span class="hljs-comment"># If true, only enable lazyload on the post page. For custom pages, you can set &#x27;lazyload: true&#x27; in front-matter</span><br>  <span class="hljs-attr">onlypost:</span> <span class="hljs-literal">false</span><br><br>  <span class="hljs-comment"># 触发加载的偏移倍数，基数是视窗高度，可根据部署环境的请求速度调节</span><br>  <span class="hljs-comment"># The factor of viewport height that triggers loading</span><br>  <span class="hljs-attr">offset_factor:</span> <span class="hljs-number">2</span><br><br><span class="hljs-comment"># 图标库，包含了大量社交类图标，主题依赖的不包含在内，因此可自行修改，详见 https://hexo.fluid-dev.com/docs/icon/</span><br><span class="hljs-comment"># Icon library, which includes many social icons, does not include those theme dependent, so your can modify link by yourself. See: https://hexo.fluid-dev.com/docs/en/icon/</span><br><span class="hljs-attr">iconfont:</span> <span class="hljs-string">//at.alicdn.com/t/font_1736178_lbnruvf0jn.css</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 页头</span><br><span class="hljs-comment"># Header</span><br><span class="hljs-comment">#---------------------------</span><br><br><span class="hljs-comment"># 导航栏的相关配置</span><br><span class="hljs-comment"># Navigation bar</span><br><span class="hljs-attr">navbar:</span><br>  <span class="hljs-comment"># 导航栏左侧的标题，为空则按 hexo config 中 `title` 显示</span><br>  <span class="hljs-comment"># The title on the left side of the navigation bar. If empty, it is based on `title` in hexo config</span><br>  <span class="hljs-attr">blog_title:</span> <span class="hljs-string">&quot;Fluid&quot;</span><br><br>  <span class="hljs-comment"># 导航栏毛玻璃特效，实验性功能，可能会造成页面滚动掉帧和抖动，部分浏览器不支持会自动不生效</span><br>  <span class="hljs-comment"># Navigation bar frosted glass special animation. It is an experimental feature</span><br>  <span class="hljs-attr">ground_glass:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># 模糊像素，只能为数字，数字越大模糊度越高</span><br>    <span class="hljs-comment"># Number of blurred pixel. the larger the number, the higher the blur</span><br>    <span class="hljs-attr">px:</span> <span class="hljs-number">3</span><br><br>    <span class="hljs-comment"># 不透明度，数字越大透明度越低，注意透明过度可能看不清菜单字体</span><br>    <span class="hljs-comment"># Ratio of opacity, 1.0 is completely opaque</span><br>    <span class="hljs-comment"># available: 0 - 1.0</span><br>    <span class="hljs-attr">alpha:</span> <span class="hljs-number">0.7</span><br><br>  <span class="hljs-comment"># 导航栏菜单，可自行增减，key 用来关联 languages/*.yml，如不存在关联则显示 key 本身的值；icon 是 css class，可以省略；增加 name 可以强制显示指定名称</span><br>  <span class="hljs-comment"># Navigation bar menu. `key` is used to associate languages/*.yml. If there is no association, the value of `key` itself will be displayed; if `icon` is a css class, it can be omitted; adding `name` can force the display of the specified name</span><br>  <span class="hljs-attr">menu:</span><br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;home&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-home-fill&quot;</span> &#125;<br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;archive&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/archives/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-archive-fill&quot;</span> &#125;<br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;category&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/categories/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-category-fill&quot;</span> &#125;<br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;tag&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/tags/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-tags-fill&quot;</span> &#125;<br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">key:</span> <span class="hljs-string">&quot;about&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;/about/&quot;</span>, <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-user-fill&quot;</span> &#125;<br>    <span class="hljs-comment">#- &#123; key: &quot;links&quot;, link: &quot;/links/&quot;, icon: &quot;iconfont icon-link-fill&quot; &#125;</span><br><br><span class="hljs-comment"># 搜索功能，基于 hexo-generator-search 插件，若已安装其他搜索插件请关闭此功能，以避免生成多余的索引文件</span><br><span class="hljs-comment"># Search feature, based on hexo-generator-search. If you have installed other search plugins, please disable this feature to avoid generating redundant index files</span><br><span class="hljs-attr">search:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># 搜索索引文件的路径，可以是相对路径或外站的绝对路径</span><br>  <span class="hljs-comment"># Path for search index file, it can be a relative path or an absolute path</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">/local-search.xml</span><br><br>  <span class="hljs-comment"># 文件生成在本地的位置，必须是相对路径</span><br>  <span class="hljs-comment"># The location where the index file is generated locally, it must be a relative location</span><br>  <span class="hljs-attr">generate_path:</span> <span class="hljs-string">/local-search.xml</span><br><br>  <span class="hljs-comment"># 搜索的范围</span><br>  <span class="hljs-comment"># Search field</span><br>  <span class="hljs-comment"># Options: post | page | all</span><br>  <span class="hljs-attr">field:</span> <span class="hljs-string">post</span><br><br>  <span class="hljs-comment"># 搜索是否扫描正文</span><br>  <span class="hljs-comment"># If true, search will scan the post content</span><br>  <span class="hljs-attr">content:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># 首屏图片的相关配置</span><br><span class="hljs-comment"># Config of the big image on the first screen</span><br><span class="hljs-attr">banner:</span><br>  <span class="hljs-comment"># 视差滚动，图片与板块会随着屏幕滚动产生视差效果</span><br>  <span class="hljs-comment"># Scrolling parallax</span><br>  <span class="hljs-attr">parallax:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># 图片最小的宽高比，以免图片两边被过度裁剪，适用于移动端竖屏时，如需关闭设为 0</span><br>  <span class="hljs-comment"># Minimum ratio of width to height, applicable to the vertical screen of mobile device, if you need to close it, set it to 0</span><br>  <span class="hljs-attr">width_height_ratio:</span> <span class="hljs-number">1.0</span><br><br><span class="hljs-comment"># 向下滚动的箭头</span><br><span class="hljs-comment"># Scroll down arrow</span><br><span class="hljs-attr">scroll_down_arrow:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># 头图高度不小于指定比例，才显示箭头</span><br>  <span class="hljs-comment"># Only the height of the banner image is greater than the ratio, the arrow is displayed</span><br>  <span class="hljs-comment"># Available: 0 - 100</span><br>  <span class="hljs-attr">banner_height_limit:</span> <span class="hljs-number">80</span><br><br>  <span class="hljs-comment"># 翻页后自动滚动</span><br>  <span class="hljs-comment"># Auto scroll after page turning</span><br>  <span class="hljs-attr">scroll_after_turning_page:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># 向顶部滚动的箭头</span><br><span class="hljs-comment"># Scroll top arrow</span><br><span class="hljs-attr">scroll_top_arrow:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br><span class="hljs-comment"># Open Graph metadata</span><br><span class="hljs-comment"># See: https://hexo.io/docs/helpers.html#open-graph</span><br><span class="hljs-attr">open_graph:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">twitter_card:</span> <span class="hljs-string">summary_large_image</span><br>  <span class="hljs-attr">twitter_id:</span><br>  <span class="hljs-attr">twitter_site:</span><br>  <span class="hljs-attr">google_plus:</span><br>  <span class="hljs-attr">fb_admins:</span><br>  <span class="hljs-attr">fb_app_id:</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 页脚</span><br><span class="hljs-comment"># Footer</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">footer:</span><br>  <span class="hljs-comment"># 页脚第一行文字的 HTML，建议保留 Fluid 的链接，用于向更多人推广本主题</span><br>  <span class="hljs-comment"># HTML of the first line of the footer, it is recommended to keep the Fluid link to promote this theme to more people</span><br>  <span class="hljs-attr">content:</span> <span class="hljs-string">&#x27;</span><br><span class="hljs-string">    &lt;a href=&quot;https://hexo.io&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span&gt;Hexo&lt;/span&gt;&lt;/a&gt;</span><br><span class="hljs-string">    &lt;i class=&quot;iconfont icon-love&quot;&gt;&lt;/i&gt;</span><br><span class="hljs-string">    &lt;a href=&quot;https://github.com/fluid-dev/hexo-theme-fluid&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;span&gt;Fluid&lt;/span&gt;&lt;/a&gt;</span><br><span class="hljs-string">  &#x27;</span><br><br>  <span class="hljs-comment"># 展示网站的 PV、UV 统计数</span><br>  <span class="hljs-comment"># Display website PV and UV statistics</span><br>  <span class="hljs-attr">statistics:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># 统计数据来源，使用 leancloud 需要设置 `web_analytics: leancloud` 中的参数；使用 busuanzi 不需要额外设置，但是有时不稳定，另外本地运行时 busuanzi 显示统计数据很大属于正常现象，部署后会正常</span><br>    <span class="hljs-comment"># Data source. If use leancloud, you need to set the parameter in `web_analytics: leancloud`</span><br>    <span class="hljs-comment"># Options: busuanzi | leancloud</span><br>    <span class="hljs-attr">source:</span> <span class="hljs-string">&quot;busuanzi&quot;</span><br><br>  <span class="hljs-comment"># 国内大陆服务器的备案信息</span><br>  <span class="hljs-comment"># For Chinese mainland website policy, other areas keep disable</span><br>  <span class="hljs-attr">beian:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># ICP证号</span><br>    <span class="hljs-attr">icp_text:</span> <span class="hljs-string">京ICP证123456号</span><br>    <span class="hljs-comment"># 公安备案号，不填则只显示ICP</span><br>    <span class="hljs-attr">police_text:</span> <span class="hljs-string">京公网安备12345678号</span><br>    <span class="hljs-comment"># 公安备案的编号，用于URL跳转查询</span><br>    <span class="hljs-attr">police_code:</span> <span class="hljs-number">12345678</span><br>    <span class="hljs-comment"># 公安备案的图片. 为空时不显示备案图片</span><br>    <span class="hljs-attr">police_icon:</span> <span class="hljs-string">/img/police_beian.png</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 首页</span><br><span class="hljs-comment"># Home Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">index:</span><br>  <span class="hljs-comment"># 首页 Banner 头图，可以是相对路径或绝对路径，以下相同</span><br>  <span class="hljs-comment"># Path of Banner image, can be a relative path or an absolute path, the same on other pages</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/img/default.png</span><br><br>  <span class="hljs-comment"># 头图高度，屏幕百分比</span><br>  <span class="hljs-comment"># Height ratio of banner image</span><br>  <span class="hljs-comment"># Available: 0 - 100</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">100</span><br><br>  <span class="hljs-comment"># 头图黑色蒙版的不透明度，available: 0 - 1.0， 1 是完全不透明</span><br>  <span class="hljs-comment"># Opacity of the banner mask, 1.0 is completely opaque</span><br>  <span class="hljs-comment"># Available: 0 - 1.0</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br><br>  <span class="hljs-comment"># 首页副标题的独立设置</span><br>  <span class="hljs-comment"># Independent config of home page subtitle</span><br>  <span class="hljs-attr">slogan:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># 为空则按 hexo config.subtitle 显示</span><br>    <span class="hljs-comment"># If empty, text based on `subtitle` in hexo config</span><br>    <span class="hljs-attr">text:</span> <span class="hljs-string">&quot;An elegant Material-Design theme for Hexo&quot;</span><br><br>    <span class="hljs-comment"># 通过 API 接口作为首页副标题的内容，必须返回的是 JSON 格式，如果请求失败则按 text 字段显示，该功能必须先开启 typing 打字机功能</span><br>    <span class="hljs-comment"># Subtitle of the homepage through the API, must be returned a JSON. If the request fails, it will be displayed in `text` value. This feature must first enable the typing animation</span><br>    <span class="hljs-attr">api:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br><br>      <span class="hljs-comment"># 请求地址</span><br>      <span class="hljs-comment"># Request url</span><br>      <span class="hljs-attr">url:</span> <span class="hljs-string">&quot;&quot;</span><br><br>      <span class="hljs-comment"># 请求方法</span><br>      <span class="hljs-comment"># Request method</span><br>      <span class="hljs-comment"># Available: GET | POST | PUT</span><br>      <span class="hljs-attr">method:</span> <span class="hljs-string">&quot;GET&quot;</span><br><br>      <span class="hljs-comment"># 请求头</span><br>      <span class="hljs-comment"># Request headers</span><br>      <span class="hljs-attr">headers:</span> &#123;&#125;<br><br>      <span class="hljs-comment"># 从请求结果获取字符串的取值字段，最终必须是一个字符串，例如返回结果为 &#123;&quot;data&quot;: &#123;&quot;author&quot;: &quot;fluid&quot;, &quot;content&quot;: &quot;An elegant theme&quot;&#125;&#125;, 则取值字段为 [&#x27;data&#x27;, &#x27;content&#x27;]；如果返回是列表则自动选择第一项</span><br>      <span class="hljs-comment"># The value field of the string obtained from the response. For example, the response content is &#123;&quot;data&quot;: &#123;&quot;author&quot;: &quot;fluid&quot;, &quot;content&quot;: &quot;An elegant theme&quot;&#125;&#125;, the expected `keys: [&#x27;data&#x27;,&#x27;content&#x27;]`; if the return is a list, the first item is automatically selected</span><br>      <span class="hljs-attr">keys:</span> []<br><br>  <span class="hljs-comment"># 自动截取文章摘要</span><br>  <span class="hljs-comment"># Auto extract post</span><br>  <span class="hljs-attr">auto_excerpt:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># 打开文章的标签方式</span><br>  <span class="hljs-comment"># The browser tag to open the post</span><br>  <span class="hljs-comment"># Available: _blank | _self</span><br>  <span class="hljs-attr">post_url_target:</span> <span class="hljs-string">_self</span><br><br>  <span class="hljs-comment"># 是否显示文章信息（时间、分类、标签）</span><br>  <span class="hljs-comment"># Meta information of post</span><br>  <span class="hljs-attr">post_meta:</span><br>    <span class="hljs-attr">date:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">category:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">tag:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># 文章通过 sticky 排序后，在首页文章标题前显示图标</span><br>  <span class="hljs-comment"># If the posts are sorted by `sticky`, an icon is displayed in front of the post title</span><br>  <span class="hljs-attr">post_sticky:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">icon:</span> <span class="hljs-string">&quot;iconfont icon-top&quot;</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 文章页</span><br><span class="hljs-comment"># Post Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">post:</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/img/default.png</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">70</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br><br>  <span class="hljs-comment"># 文章在首页的默认封面图，当没有指定 index_img 时会使用该图片，若两者都为空则不显示任何图片</span><br>  <span class="hljs-comment"># Path of the default post cover when `index_img` is not set. If both are empty, no image will be displayed</span><br>  <span class="hljs-attr">default_index_img:</span><br><br>  <span class="hljs-comment"># 文章标题下方的元信息</span><br>  <span class="hljs-comment"># Meta information below title</span><br>  <span class="hljs-attr">meta:</span><br>    <span class="hljs-comment"># 作者，优先根据 front-matter 里 author 字段，其次是 hexo 配置中 author 值</span><br>    <span class="hljs-comment"># Author, based on `author` field in front-matter, if not set, based on `author` value in hexo config</span><br>    <span class="hljs-attr">author:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># 文章日期，优先根据 front-matter 里 date 字段，其次是 md 文件日期</span><br>    <span class="hljs-comment"># Post date, based on `date` field in front-matter, if not set, based on create date of .md file</span><br>    <span class="hljs-attr">date:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-comment"># 格式参照 ISO-8601 日期格式化</span><br>      <span class="hljs-comment"># ISO-8601 date format</span><br>      <span class="hljs-comment"># See: http://momentjs.cn/docs/#/parsing/string-format/</span><br>      <span class="hljs-attr">format:</span> <span class="hljs-string">&quot;LL a&quot;</span><br><br>    <span class="hljs-comment"># 字数统计</span><br>    <span class="hljs-comment"># Word count</span><br>    <span class="hljs-attr">wordcount:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># 估计阅读全文需要的时长</span><br>    <span class="hljs-comment"># Estimated reading time</span><br>    <span class="hljs-attr">min2read:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-comment"># 每个字词的长度，建议：中文≈2，英文≈5，中英混合可自行调节</span><br>      <span class="hljs-comment"># Average word length (chars count in word), ZH ≈ 2, EN ≈ 5</span><br>      <span class="hljs-attr">awl:</span> <span class="hljs-number">2</span><br>      <span class="hljs-comment"># 每分钟阅读字数，如果大部分是技术文章可适度调低</span><br>      <span class="hljs-comment"># Words per minute</span><br>      <span class="hljs-attr">wpm:</span> <span class="hljs-number">60</span><br><br>    <span class="hljs-comment"># 浏览量计数</span><br>    <span class="hljs-comment"># Number of visits</span><br>    <span class="hljs-attr">views:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-comment"># 统计数据来源</span><br>      <span class="hljs-comment"># Data Source</span><br>      <span class="hljs-comment"># Options: busuanzi | leancloud</span><br>      <span class="hljs-attr">source:</span> <span class="hljs-string">&quot;busuanzi&quot;</span><br><br>  <span class="hljs-comment"># 在文章开头显示文章更新时间，该时间默认是 md 文件更新时间，可通过 front-matter 中 `updated` 手动指定（和 date 一样格式）</span><br>  <span class="hljs-comment"># Update date is displayed at the beginning of the post. The default date is the update date of the md file, which can be manually specified by `updated` in front-matter (same format as date)</span><br>  <span class="hljs-attr">updated:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># 格式参照 ISO-8601 日期格式化</span><br>    <span class="hljs-comment"># ISO-8601 date format</span><br>    <span class="hljs-comment"># See: http://momentjs.cn/docs/#/parsing/string-format/</span><br>    <span class="hljs-attr">date_format:</span> <span class="hljs-string">&quot;LL a&quot;</span><br><br>    <span class="hljs-comment"># 是否使用相对时间表示，比如：&quot;3 天前&quot;</span><br>    <span class="hljs-comment"># If true, it will be a relative time, such as: &quot;3 days ago&quot;</span><br>    <span class="hljs-attr">relative:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># 提示标签类型</span><br>    <span class="hljs-comment"># Note class</span><br>    <span class="hljs-comment"># Options: default | primary | info | success | warning | danger | light</span><br>    <span class="hljs-attr">note_class:</span> <span class="hljs-string">info</span><br><br>  <span class="hljs-comment"># 侧边栏展示当前分类下的文章</span><br>  <span class="hljs-comment"># Sidebar of category</span><br>  <span class="hljs-attr">category_bar:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># 开启后，只有在文章 Front-matter 里指定 `category_bar: true` 才会展示分类，也可以通过 `category_bar: [&quot;分类A&quot;]` 来指定分类</span><br>    <span class="hljs-comment"># If true, only set `category_bar: true` in Front-matter will enable sidebar of category, also set `category_bar: [&quot;CategoryA&quot;]` to specify categories</span><br>    <span class="hljs-attr">specific:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># 置于板块的左侧或右侧</span><br>    <span class="hljs-comment"># place in the board</span><br>    <span class="hljs-comment"># Options: left | right</span><br>    <span class="hljs-attr">placement:</span> <span class="hljs-string">left</span><br><br>    <span class="hljs-comment"># 文章的排序字段，前面带减号是倒序，不带减号是正序</span><br>    <span class="hljs-comment"># Sort field for posts, with a minus sign is reverse order</span><br>    <span class="hljs-comment"># Options: date | title | or other field of front-matter</span><br>    <span class="hljs-attr">post_order_by:</span> <span class="hljs-string">&quot;title&quot;</span><br><br>    <span class="hljs-comment"># 单个分类中折叠展示文章数的最大值，超过限制会显示 More，0 则不限制</span><br>    <span class="hljs-comment"># The maximum number of posts in a single category. If the limit is exceeded, it will be displayed More. If 0 no limit</span><br>    <span class="hljs-attr">post_limit:</span> <span class="hljs-number">0</span><br><br>  <span class="hljs-comment"># 侧边栏展示文章目录</span><br>  <span class="hljs-comment"># Table of contents (TOC) in the sidebar</span><br>  <span class="hljs-attr">toc:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># 置于板块的左侧或右侧</span><br>    <span class="hljs-comment"># place in the board</span><br>    <span class="hljs-comment"># Options: left | right</span><br>    <span class="hljs-attr">placement:</span> <span class="hljs-string">right</span><br><br>    <span class="hljs-comment"># 目录会选择这些节点作为标题</span><br>    <span class="hljs-comment"># TOC will select these nodes as headings</span><br>    <span class="hljs-attr">headingSelector:</span> <span class="hljs-string">&quot;h1,h2,h3,h4,h5,h6&quot;</span><br><br>    <span class="hljs-comment"># 层级的折叠深度，0 是全部折叠，大于 0 后如果存在下级标题则默认展开</span><br>    <span class="hljs-comment"># Collapse depth. If 0, all headings collapsed. If greater than 0, it will be expanded by default if there are sub headings</span><br>    <span class="hljs-attr">collapseDepth:</span> <span class="hljs-number">0</span><br><br>  <span class="hljs-comment"># 版权声明，会显示在每篇文章的结尾</span><br>  <span class="hljs-comment"># Copyright, will be displayed at the end of each post</span><br>  <span class="hljs-attr">copyright:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># CreativeCommons license</span><br>    <span class="hljs-comment"># Options: BY | BY-SA | BY-ND | BY-NC | BY-NC-SA | BY-NC-ND</span><br>    <span class="hljs-attr">license:</span> <span class="hljs-string">&#x27;BY&#x27;</span><br><br>    <span class="hljs-comment"># 显示作者</span><br>    <span class="hljs-attr">author:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># 显示发布日期</span><br>    <span class="hljs-comment"># Show post date</span><br>    <span class="hljs-attr">post_date:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">format:</span> <span class="hljs-string">&quot;LL&quot;</span><br><br>    <span class="hljs-comment"># 显示更新日期</span><br>    <span class="hljs-comment"># Show update date</span><br>    <span class="hljs-attr">update_date:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br>      <span class="hljs-attr">format:</span> <span class="hljs-string">&quot;LL&quot;</span><br><br>  <span class="hljs-comment"># 文章底部上一篇下一篇功能</span><br>  <span class="hljs-comment"># Link to previous/next post</span><br>  <span class="hljs-attr">prev_next:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># 文章图片标题</span><br>  <span class="hljs-comment"># Image caption</span><br>  <span class="hljs-attr">image_caption:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># 文章图片可点击放大</span><br>  <span class="hljs-comment"># Zoom feature of images</span><br>  <span class="hljs-attr">image_zoom:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-comment"># 放大后图片链接替换规则，可用于将压缩图片链接替换为原图片链接，如 [&#x27;-slim&#x27;, &#x27;&#x27;] 是将链接中 `-slim` 移除；如果想使用正则请使用 `re:` 前缀，如 [&#x27;re:\\d&#123;3,4&#125;\\/\\d&#123;3,4&#125;\\/&#x27;, &#x27;&#x27;]</span><br>    <span class="hljs-comment"># The image url replacement when zooming, the feature can be used to replace the compressed image to the original image, eg: [&#x27;-slim&#x27;, &#x27;&#x27;] removes `-slim` from the image url when zooming; if you want to use regular, use prefix `re:`, eg: [&#x27;re:\\d&#123;3,4&#125;\\/\\d&#123;3,4&#125;\\/&#x27;,&#x27;&#x27;]</span><br>    <span class="hljs-attr">img_url_replace:</span> [<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>]<br><br>  <span class="hljs-comment"># 脚注语法，会在文章底部生成脚注，如果 Markdown 渲染器本身支持，则建议关闭，否则可能会冲突</span><br>  <span class="hljs-comment"># Support footnote syntax, footnotes will be generated at the bottom of the post page. If the Markdown renderer itself supports it, please disable it, otherwise it may conflict</span><br>  <span class="hljs-attr">footnote:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-comment"># 脚注的节标题，也可以在 front-matter 中通过 `foot<span class="hljs-doctag">note:</span> &lt;h2&gt;Reference&lt;/h2&gt;` 这种形式修改单独页面的 header</span><br>    <span class="hljs-comment"># The section title of the footnote, you can also modify the header of a single page in the form of `foot<span class="hljs-doctag">note:</span> &lt;h2&gt;Reference&lt;/h2&gt;` in front-matter</span><br>    <span class="hljs-attr">header:</span> <span class="hljs-string">&#x27;&#x27;</span><br><br>  <span class="hljs-comment"># 数学公式，开启之前需要更换 Markdown 渲染器，否则复杂公式会有兼容问题，具体请见：https://hexo.fluid-dev.com/docs/guide/##latex-数学公式</span><br>  <span class="hljs-comment"># Mathematical formula. If enable, you need to change the Markdown renderer, see: https://hexo.fluid-dev.com/docs/en/guide/#math</span><br>  <span class="hljs-attr">math:</span><br>    <span class="hljs-comment"># 开启后文章默认可用，自定义页面如需使用，需在 Front-matter 中指定 `math: true`</span><br>    <span class="hljs-comment"># If you want to use math on the custom page, you need to set `math: true` in Front-matter</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># 开启后，只有在文章 Front-matter 里指定 `math: true` 才会在文章页启动公式转换，以便在页面不包含公式时提高加载速度</span><br>    <span class="hljs-comment"># If true, only set `math: true` in Front-matter will enable math, to load faster when the page does not contain math</span><br>    <span class="hljs-attr">specific:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># Options: mathjax | katex</span><br>    <span class="hljs-attr">engine:</span> <span class="hljs-string">mathjax</span><br><br>  <span class="hljs-comment"># 流程图，基于 mermaid-js，具体请见：https://hexo.fluid-dev.com/docs/guide/#mermaid-流程图</span><br>  <span class="hljs-comment"># Flow chart, based on mermaid-js, see: https://hexo.fluid-dev.com/docs/en/guide/#mermaid</span><br>  <span class="hljs-attr">mermaid:</span><br>    <span class="hljs-comment"># 开启后文章默认可用，自定义页面如需使用，需在 Front-matter 中指定 `mermaid: true`</span><br>    <span class="hljs-comment"># If you want to use mermaid on the custom page, you need to set `mermaid: true` in Front-matter</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># 开启后，只有在文章 Front-matter 里指定 `mermaid: true` 才会在文章页启动公式转换，以便在页面不包含公式时提高加载速度</span><br>    <span class="hljs-comment"># If true, only set `mermaid: true` in Front-matter will enable mermaid, to load faster when the page does not contain mermaid</span><br>    <span class="hljs-attr">specific:</span> <span class="hljs-literal">false</span><br><br>    <span class="hljs-comment"># See: http://mermaid-js.github.io/mermaid/</span><br>    <span class="hljs-attr">options:</span> &#123; <span class="hljs-attr">theme:</span> <span class="hljs-string">&#x27;default&#x27;</span> &#125;<br><br>  <span class="hljs-comment"># 评论插件</span><br>  <span class="hljs-comment"># Comment plugin</span><br>  <span class="hljs-attr">comments:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># 指定的插件，需要同时设置对应插件的必要参数</span><br>    <span class="hljs-comment"># The specified plugin needs to set the necessary parameters at the same time</span><br>    <span class="hljs-comment"># Options: utterances | disqus | gitalk | valine | waline | changyan | livere | remark42 | twikoo | cusdis | giscus</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">disqus</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 评论插件</span><br><span class="hljs-comment"># Comment plugins</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># 开启评论需要先设置上方 `post: comments: enable: true`，然后根据 `type` 设置下方对应的评论插件参数</span><br><span class="hljs-comment"># Enable comments need to be set `post: comments: enable: true`, then set the corresponding comment plugin parameters below according to `type`</span><br><span class="hljs-comment">#---------------------------</span><br><br><span class="hljs-comment"># Utterances</span><br><span class="hljs-comment"># 基于 GitHub Issues</span><br><span class="hljs-comment"># Based on GitHub Issues</span><br><span class="hljs-comment"># See: https://utteranc.es</span><br><span class="hljs-attr">utterances:</span><br>  <span class="hljs-attr">repo:</span><br>  <span class="hljs-attr">issue_term:</span> <span class="hljs-string">pathname</span><br>  <span class="hljs-attr">label:</span> <span class="hljs-string">utterances</span><br>  <span class="hljs-attr">theme:</span> <span class="hljs-string">github-light</span><br>  <span class="hljs-attr">theme_dark:</span> <span class="hljs-string">github-dark</span><br><br><span class="hljs-comment"># Disqus</span><br><span class="hljs-comment"># 基于第三方的服务，国内用户直接使用容易被墙，建议配合 Disqusjs</span><br><span class="hljs-comment"># Based on third-party service</span><br><span class="hljs-comment"># See: https://disqus.com</span><br><span class="hljs-attr">disqus:</span><br>  <span class="hljs-attr">shortname:</span><br>  <span class="hljs-comment"># 以下为 Disqusjs 支持, 国内用户如果想使用 Disqus 建议配合使用</span><br>  <span class="hljs-comment"># The following are Disqusjs configurations, please ignore if DisqusJS is not required</span><br>  <span class="hljs-comment"># See: https://github.com/SukkaW/DisqusJS</span><br>  <span class="hljs-attr">disqusjs:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">apikey:</span><br><br><span class="hljs-comment"># Gitalk</span><br><span class="hljs-comment"># 基于 GitHub Issues</span><br><span class="hljs-comment"># Based on GitHub Issues</span><br><span class="hljs-comment"># See: https://github.com/gitalk/gitalk#options</span><br><span class="hljs-attr">gitalk:</span><br>  <span class="hljs-attr">clientID:</span><br>  <span class="hljs-attr">clientSecret:</span><br>  <span class="hljs-attr">repo:</span><br>  <span class="hljs-attr">owner:</span><br>  <span class="hljs-attr">admin:</span> [<span class="hljs-string">&#x27;name&#x27;</span>]<br>  <span class="hljs-attr">language:</span> <span class="hljs-string">zh-CN</span><br>  <span class="hljs-attr">labels:</span> [<span class="hljs-string">&#x27;Gitalk&#x27;</span>]<br>  <span class="hljs-attr">perPage:</span> <span class="hljs-number">10</span><br>  <span class="hljs-attr">pagerDirection:</span> <span class="hljs-string">last</span><br>  <span class="hljs-attr">distractionFreeMode:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">createIssueManually:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># 默认 proxy 可能会失效，解决方法请见下方链接</span><br>  <span class="hljs-comment"># The default proxy may be invalid, refer to the links for solutions</span><br>  <span class="hljs-comment"># https://github.com/gitalk/gitalk/issues/429</span><br>  <span class="hljs-comment"># https://github.com/Zibri/cloudflare-cors-anywhere</span><br>  <span class="hljs-attr">proxy:</span> <span class="hljs-string">https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token</span><br><br><span class="hljs-comment"># Valine</span><br><span class="hljs-comment"># 基于 LeanCloud</span><br><span class="hljs-comment"># Based on LeanCloud</span><br><span class="hljs-comment"># See: https://valine.js.org/</span><br><span class="hljs-attr">valine:</span><br>  <span class="hljs-attr">appId:</span><br>  <span class="hljs-attr">appKey:</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">window.location.pathname</span><br>  <span class="hljs-attr">placeholder:</span><br>  <span class="hljs-attr">avatar:</span> <span class="hljs-string">&#x27;retro&#x27;</span><br>  <span class="hljs-attr">meta:</span> [<span class="hljs-string">&#x27;nick&#x27;</span>, <span class="hljs-string">&#x27;mail&#x27;</span>, <span class="hljs-string">&#x27;link&#x27;</span>]<br>  <span class="hljs-attr">requiredFields:</span> []<br>  <span class="hljs-attr">pageSize:</span> <span class="hljs-number">10</span><br>  <span class="hljs-attr">lang:</span> <span class="hljs-string">&#x27;zh-CN&#x27;</span><br>  <span class="hljs-attr">highlight:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">recordIP:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">serverURLs:</span> <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-attr">emojiCDN:</span><br>  <span class="hljs-attr">emojiMaps:</span><br>  <span class="hljs-attr">enableQQ:</span> <span class="hljs-literal">false</span><br><br><span class="hljs-comment"># Waline</span><br><span class="hljs-comment"># 从 Valine 衍生而来，额外增加了服务端和多种功能</span><br><span class="hljs-comment"># Derived from Valine, with self-hosted service and new features</span><br><span class="hljs-comment"># See: https://waline.js.org/</span><br><span class="hljs-attr">waline:</span><br>  <span class="hljs-attr">serverURL:</span> <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">window.location.pathname</span><br>  <span class="hljs-attr">meta:</span> [<span class="hljs-string">&#x27;nick&#x27;</span>, <span class="hljs-string">&#x27;mail&#x27;</span>, <span class="hljs-string">&#x27;link&#x27;</span>]<br>  <span class="hljs-attr">requiredMeta:</span> [<span class="hljs-string">&#x27;nick&#x27;</span>]<br>  <span class="hljs-attr">lang:</span> <span class="hljs-string">&#x27;zh-CN&#x27;</span><br>  <span class="hljs-attr">emoji:</span> [<span class="hljs-string">&#x27;https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo&#x27;</span>]<br>  <span class="hljs-attr">dark:</span> <span class="hljs-string">&#x27;html[data-user-color-scheme=&quot;dark&quot;]&#x27;</span><br>  <span class="hljs-attr">wordLimit:</span> <span class="hljs-number">0</span><br>  <span class="hljs-attr">pageSize:</span> <span class="hljs-number">10</span><br><br><span class="hljs-comment"># 畅言 Changyan</span><br><span class="hljs-comment"># 基于第三方的服务</span><br><span class="hljs-comment"># Based on third-party service, insufficient support for regions outside China</span><br><span class="hljs-comment"># http://changyan.kuaizhan.com</span><br><span class="hljs-attr">changyan:</span><br>  <span class="hljs-attr">appid:</span> <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-attr">appkey:</span> <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-comment"># 来必力 Livere</span><br><span class="hljs-comment"># 基于第三方的服务</span><br><span class="hljs-comment"># Based on third-party service</span><br><span class="hljs-comment"># See: https://www.livere.com</span><br><span class="hljs-attr">livere:</span><br>  <span class="hljs-attr">uid:</span> <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-comment"># Remark42</span><br><span class="hljs-comment"># 需要自托管服务端</span><br><span class="hljs-comment"># Based on self-hosted service</span><br><span class="hljs-comment"># See: https://remark42.com</span><br><span class="hljs-attr">remark42:</span><br>  <span class="hljs-attr">host:</span><br>  <span class="hljs-attr">site_id:</span><br>  <span class="hljs-attr">max_shown_comments:</span> <span class="hljs-number">10</span><br>  <span class="hljs-attr">locale:</span> <span class="hljs-string">zh</span><br>  <span class="hljs-attr">components:</span> [<span class="hljs-string">&#x27;embed&#x27;</span>]<br><br><span class="hljs-comment"># Twikoo</span><br><span class="hljs-comment"># 基于腾讯云开发</span><br><span class="hljs-comment"># Based on Tencent CloudBase</span><br><span class="hljs-comment"># See: https://twikoo.js.org</span><br><span class="hljs-attr">twikoo:</span><br>  <span class="hljs-attr">envId:</span><br>  <span class="hljs-attr">region:</span> <span class="hljs-string">ap-shanghai</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">window.location.pathname</span><br><br><span class="hljs-comment"># Cusdis</span><br><span class="hljs-comment"># 基于第三方服务或自托管服务</span><br><span class="hljs-comment"># Based on third-party or self-hosted service</span><br><span class="hljs-comment"># See https://cusdis.com</span><br><span class="hljs-attr">cusdis:</span><br>  <span class="hljs-attr">host:</span><br>  <span class="hljs-attr">app_id:</span><br>  <span class="hljs-attr">lang:</span> <span class="hljs-string">zh-cn</span><br><br><span class="hljs-comment"># Giscus</span><br><span class="hljs-comment"># 基于 GitHub Discussions，类似于 Utterances</span><br><span class="hljs-comment"># Based on GitHub Discussions, similar to Utterances</span><br><span class="hljs-comment"># See: https://giscus.app/</span><br><span class="hljs-attr">giscus:</span><br>  <span class="hljs-attr">repo:</span><br>  <span class="hljs-attr">repo-id:</span><br>  <span class="hljs-attr">category:</span><br>  <span class="hljs-attr">category-id:</span><br>  <span class="hljs-attr">theme-light:</span> <span class="hljs-string">light</span><br>  <span class="hljs-attr">theme-dark:</span> <span class="hljs-string">dark</span><br>  <span class="hljs-attr">mapping:</span> <span class="hljs-string">pathname</span><br>  <span class="hljs-attr">reactions-enabled:</span> <span class="hljs-number">1</span><br>  <span class="hljs-attr">emit-metadata:</span> <span class="hljs-number">0</span><br>  <span class="hljs-attr">input-position:</span> <span class="hljs-string">top</span><br>  <span class="hljs-attr">lang:</span> <span class="hljs-string">zh-CN</span><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 归档页</span><br><span class="hljs-comment"># Archive Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">archive:</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/img/default.png</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">60</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 分类页</span><br><span class="hljs-comment"># Category Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">category:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/img/default.png</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">60</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br><br>  <span class="hljs-comment"># 分类的排序字段，前面带减号是倒序，不带减号是正序</span><br>  <span class="hljs-comment"># Sort field for categories, with a minus sign is reverse order</span><br>  <span class="hljs-comment"># Options: length | name</span><br>  <span class="hljs-attr">order_by:</span> <span class="hljs-string">&quot;-length&quot;</span><br><br>  <span class="hljs-comment"># 层级的折叠深度，0 是全部折叠，大于 0 后如果存在子分类则默认展开</span><br>  <span class="hljs-comment"># Collapse depth. If 0, all posts collapsed. If greater than 0, it will be expanded by default if there are subcategories</span><br>  <span class="hljs-attr">collapse_depth:</span> <span class="hljs-number">0</span><br><br>  <span class="hljs-comment"># 文章的排序字段，前面带减号是倒序，不带减号是正序</span><br>  <span class="hljs-comment"># Sort field for posts, with a minus sign is reverse order</span><br>  <span class="hljs-comment"># Options: date | title | or other field of front-matter</span><br>  <span class="hljs-attr">post_order_by:</span> <span class="hljs-string">&quot;-date&quot;</span><br><br>  <span class="hljs-comment"># 单个分类中折叠展示文章数的最大值，超过限制会显示 More，0 则不限制</span><br>  <span class="hljs-comment"># The maximum number of posts in a single category. If the limit is exceeded, it will be displayed More. If 0 no limit</span><br>  <span class="hljs-attr">post_limit:</span> <span class="hljs-number">10</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 标签页</span><br><span class="hljs-comment"># Tag Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">tag:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/img/default.png</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">80</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br>  <span class="hljs-attr">tagcloud:</span><br>    <span class="hljs-attr">min_font:</span> <span class="hljs-number">15</span><br>    <span class="hljs-attr">max_font:</span> <span class="hljs-number">30</span><br>    <span class="hljs-attr">unit:</span> <span class="hljs-string">px</span><br>    <span class="hljs-attr">start_color:</span> <span class="hljs-string">&quot;#BBBBEE&quot;</span><br>    <span class="hljs-attr">end_color:</span> <span class="hljs-string">&quot;#337ab7&quot;</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 关于页</span><br><span class="hljs-comment"># About Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">about:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/img/default.png</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">60</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br>  <span class="hljs-attr">avatar:</span> <span class="hljs-string">/img/avatar.png</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;Fluid&quot;</span><br>  <span class="hljs-attr">intro:</span> <span class="hljs-string">&quot;An elegant theme for Hexo&quot;</span><br>  <span class="hljs-comment"># 更多图标可从 https://hexo.fluid-dev.com/docs/icon/ 查找，`class` 代表图标的 css class，添加 `qrcode` 后，图标不再是链接而是悬浮二维码</span><br>  <span class="hljs-comment"># More icons can be found from https://hexo.fluid-dev.com/docs/en/icon/  `class` is the css class of the icon. If adding `qrcode`, The icon is no longer a link, but a hovering QR code</span><br>  <span class="hljs-attr">icons:</span><br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">class:</span> <span class="hljs-string">&quot;iconfont icon-github-fill&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;https://github.com&quot;</span>, <span class="hljs-attr">tip:</span> <span class="hljs-string">&quot;GitHub&quot;</span> &#125;<br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">class:</span> <span class="hljs-string">&quot;iconfont icon-douban-fill&quot;</span>, <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;https://douban.com&quot;</span>, <span class="hljs-attr">tip:</span> <span class="hljs-string">&quot;豆瓣&quot;</span> &#125;<br>    <span class="hljs-bullet">-</span> &#123; <span class="hljs-attr">class:</span> <span class="hljs-string">&quot;iconfont icon-wechat-fill&quot;</span>, <span class="hljs-attr">qrcode:</span> <span class="hljs-string">&quot;/img/favicon.png&quot;</span> &#125;<br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 自定义页</span><br><span class="hljs-comment"># Custom Page</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># 通过 hexo new page 命令创建的页面</span><br><span class="hljs-comment"># Custom Page through `hexo new page`</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">page:</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/img/default.png</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">60</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 404页</span><br><span class="hljs-comment"># 404 Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">page404:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/img/default.png</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">85</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br>  <span class="hljs-comment"># 重定向到首页的延迟(毫秒)</span><br>  <span class="hljs-comment"># Delay in redirecting to home page (milliseconds)</span><br>  <span class="hljs-attr">redirect_delay:</span> <span class="hljs-number">5000</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 友链页</span><br><span class="hljs-comment"># Links Page</span><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-attr">links:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">banner_img:</span> <span class="hljs-string">/img/default.png</span><br>  <span class="hljs-attr">banner_img_height:</span> <span class="hljs-number">60</span><br>  <span class="hljs-attr">banner_mask_alpha:</span> <span class="hljs-number">0.3</span><br>  <span class="hljs-comment"># 友链的成员项</span><br>  <span class="hljs-comment"># Member item of page</span><br>  <span class="hljs-attr">items:</span><br>    <span class="hljs-bullet">-</span> &#123;<br>      <span class="hljs-attr">title:</span> <span class="hljs-string">&quot;Fluid Blog&quot;</span>,<br>      <span class="hljs-attr">intro:</span> <span class="hljs-string">&quot;主题博客&quot;</span>,<br>      <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;https://hexo.fluid-dev.com/&quot;</span>,<br>      <span class="hljs-attr">avatar:</span> <span class="hljs-string">&quot;/img/favicon.png&quot;</span><br>    &#125;<br>    <span class="hljs-bullet">-</span> &#123;<br>      <span class="hljs-attr">title:</span> <span class="hljs-string">&quot;Fluid Docs&quot;</span>,<br>      <span class="hljs-attr">intro:</span> <span class="hljs-string">&quot;主题使用指南&quot;</span>,<br>      <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;https://hexo.fluid-dev.com/docs/&quot;</span>,<br>      <span class="hljs-attr">avatar:</span> <span class="hljs-string">&quot;/img/favicon.png&quot;</span><br>    &#125;<br>    <span class="hljs-bullet">-</span> &#123;<br>      <span class="hljs-attr">title:</span> <span class="hljs-string">&quot;Fluid Repo&quot;</span>,<br>      <span class="hljs-attr">intro:</span> <span class="hljs-string">&quot;主题 GitHub 仓库&quot;</span>,<br>      <span class="hljs-attr">link:</span> <span class="hljs-string">&quot;https://github.com/fluid-dev/hexo-theme-fluid&quot;</span>,<br>      <span class="hljs-attr">avatar:</span> <span class="hljs-string">&quot;/img/favicon.png&quot;</span><br>    &#125;<br><br>  <span class="hljs-comment"># 当成员头像加载失败时，替换为指定图片</span><br>  <span class="hljs-comment"># When the member avatar fails to load, replace the specified image</span><br>  <span class="hljs-attr">onerror_avatar:</span> <span class="hljs-string">/img/avatar.png</span><br><br>  <span class="hljs-comment"># 友链下方自定义区域，支持 HTML，可插入例如申请友链的文字</span><br>  <span class="hljs-comment"># Custom content at the bottom of the links</span><br>  <span class="hljs-attr">custom:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">content:</span> <span class="hljs-string">&#x27;&lt;hr&gt;&lt;p&gt;在下方留言申请加入我的友链，按如下格式提供信息：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;博客名：Fluid&lt;/li&gt;&lt;li&gt;简介：Fluid 主题官方博客&lt;/li&gt;&lt;li&gt;链接：https://hexo.fluid-dev.com&lt;/li&gt;&lt;li&gt;图片：https://hexo.fluid-dev.com/img/favicon.png&lt;/li&gt;&lt;/ul&gt;&#x27;</span><br><br>  <span class="hljs-comment"># 评论插件</span><br>  <span class="hljs-comment"># Comment plugin</span><br>  <span class="hljs-attr">comments:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment"># 指定的插件，需要同时设置对应插件的必要参数</span><br>    <span class="hljs-comment"># The specified plugin needs to set the necessary parameters at the same time</span><br>    <span class="hljs-comment"># Options: utterances | disqus | gitalk | valine | waline | changyan | livere | remark42 | twikoo | cusdis | giscus</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">disqus</span><br><br><br><span class="hljs-comment">#---------------------------</span><br><span class="hljs-comment"># 以下是配置 JS CSS 等静态资源的 URL 前缀，可以自定义成 CDN 地址，</span><br><span class="hljs-comment"># 如果需要修改，最好使用与默认配置相同的版本，以避免潜在的问题，</span><br><span class="hljs-comment"># ** 如果你不知道如何设置，请不要做任何改动 **</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Here is the url prefix to configure the static assets. Set CDN addresses you want to customize.</span><br><span class="hljs-comment"># Be aware that you would better use the same version as default ones to avoid potential problems.</span><br><span class="hljs-comment"># DO NOT EDIT THE FOLLOWING SETTINGS UNLESS YOU KNOW WHAT YOU ARE DOING</span><br><span class="hljs-comment">#---------------------------</span><br><br><span class="hljs-attr">static_prefix:</span><br>  <span class="hljs-comment"># 内部静态</span><br>  <span class="hljs-comment"># Internal static</span><br>  <span class="hljs-attr">internal_js:</span> <span class="hljs-string">/js</span><br>  <span class="hljs-attr">internal_css:</span> <span class="hljs-string">/css</span><br>  <span class="hljs-attr">internal_img:</span> <span class="hljs-string">/img</span><br><br>  <span class="hljs-attr">anchor:</span> <span class="hljs-string">https://lib.baomitu.com/anchor-js/4.3.1/</span><br><br>  <span class="hljs-attr">github_markdown:</span> <span class="hljs-string">https://lib.baomitu.com/github-markdown-css/4.0.0/</span><br><br>  <span class="hljs-attr">jquery:</span> <span class="hljs-string">https://lib.baomitu.com/jquery/3.6.0/</span><br><br>  <span class="hljs-attr">bootstrap:</span> <span class="hljs-string">https://lib.baomitu.com/twitter-bootstrap/4.6.1/</span><br><br>  <span class="hljs-attr">prismjs:</span> <span class="hljs-string">https://lib.baomitu.com/prism/1.27.0/</span><br><br>  <span class="hljs-attr">tocbot:</span> <span class="hljs-string">https://lib.baomitu.com/tocbot/4.18.2/</span><br><br>  <span class="hljs-attr">typed:</span> <span class="hljs-string">https://lib.baomitu.com/typed.js/2.0.12/</span><br><br>  <span class="hljs-attr">fancybox:</span> <span class="hljs-string">https://lib.baomitu.com/fancybox/3.5.7/</span><br><br>  <span class="hljs-attr">nprogress:</span> <span class="hljs-string">https://lib.baomitu.com/nprogress/0.2.0/</span><br><br>  <span class="hljs-attr">mathjax:</span> <span class="hljs-string">https://lib.baomitu.com/mathjax/3.2.1/</span><br><br>  <span class="hljs-attr">katex:</span> <span class="hljs-string">https://lib.baomitu.com/KaTeX/0.15.6/</span><br><br>  <span class="hljs-attr">busuanzi:</span> <span class="hljs-string">https://busuanzi.ibruce.info/busuanzi/2.3/</span><br><br>  <span class="hljs-attr">clipboard:</span> <span class="hljs-string">https://lib.baomitu.com/clipboard.js/2.0.10/</span><br><br>  <span class="hljs-attr">mermaid:</span> <span class="hljs-string">https://lib.baomitu.com/mermaid/8.14.0/</span><br><br>  <span class="hljs-attr">valine:</span> <span class="hljs-string">https://lib.baomitu.com/valine/1.4.17/</span><br><br>  <span class="hljs-attr">waline:</span> <span class="hljs-string">https://lib.baomitu.com/waline/2.5.1/</span><br><br>  <span class="hljs-attr">gitalk:</span> <span class="hljs-string">https://lib.baomitu.com/gitalk/1.7.2/</span><br><br>  <span class="hljs-attr">disqusjs:</span> <span class="hljs-string">https://lib.baomitu.com/disqusjs/1.3.0/</span><br><br>  <span class="hljs-attr">twikoo:</span> <span class="hljs-string">https://lib.baomitu.com/twikoo/1.5.11/</span><br><br>  <span class="hljs-attr">hint:</span> <span class="hljs-string">https://lib.baomitu.com/hint.css/2.7.0/</span><br></code></pre></td></tr></table></figure><h2 id="2-3-指定主题"><a href="#2-3-指定主题" class="headerlink" title="2.3 指定主题"></a>2.3 指定主题</h2><p>修改 Hexo 博客目录中的 <code>_config.yml</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">theme: fluid  # 指定主题<br><br>language: zh-CN  # 指定语言，会影响主题显示的语言，按需修改<br></code></pre></td></tr></table></figure><h2 id="2-4-创建「关于页」"><a href="#2-4-创建「关于页」" class="headerlink" title="2.4 创建「关于页」"></a>2.4 创建「关于页」</h2><p>首次使用主题的「关于页」需要手动创建：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo new page about<br></code></pre></td></tr></table></figure><hr><h1 id="3-常用命令"><a href="#3-常用命令" class="headerlink" title="3. 常用命令"></a>3. 常用命令</h1><h2 id="3-1-hexo-server-启动Hexo服务"><a href="#3-1-hexo-server-启动Hexo服务" class="headerlink" title="3.1 hexo server 启动Hexo服务"></a>3.1 hexo server 启动Hexo服务</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo server<br></code></pre></td></tr></table></figure><h2 id="3-2-hexo-new-新建文章"><a href="#3-2-hexo-new-新建文章" class="headerlink" title="3.2 hexo new 新建文章"></a>3.2 hexo new 新建文章</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">hexo new post 文件名</span><br></code></pre></td></tr></table></figure><p>执行成功后会在source&#x2F;_posts目录下生成<code>文件名.md</code>文件,内容如下所示</p><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs md">---<br>title: 文章题目<br>date: 2022-08-26 10:17:20<br>tags: [标签1,标签2]<br><span class="hljs-section">categories: 分类</span><br><span class="hljs-section">---</span><br>文章描述<br>&lt;!--more--&gt;<br>正文内容<br></code></pre></td></tr></table></figure><h2 id="3-3-hexo-g-打包"><a href="#3-3-hexo-g-打包" class="headerlink" title="3.3 hexo g 打包"></a>3.3 hexo g 打包</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo g<br></code></pre></td></tr></table></figure><p>执行完成后会生成public文件夹,可以将此文件夹内容部署在nginx服务器上,实现网站的部署</p>]]></content>
    
    
    <categories>
      
      <category>关于本站</category>
      
    </categories>
    
    
    <tags>
      
      <tag>搭建指南</tag>
      
      <tag>blog</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBoot便捷的token验证方式</title>
    <link href="/2022/08/25/SpringBootToken/"/>
    <url>/2022/08/25/SpringBootToken/</url>
    
    <content type="html"><![CDATA[<p>在javaWeb中,我们常用JWT作为权限令牌,后端接口对token参数进行解析验证,判断token是否有效.<br>常用的方式有传递query参数,传递body参数,传递请求头参数…如果每个controller都要写代码进行token验证,将会是十分繁琐的工作. springboot中提供了<code>HandlerMethodArgumentResolver</code>参数解析器,配合自定义注解可以大大减少代码冗余.</p><span id="more"></span><h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h1><p>在javaWeb中,我们常用JWT(Java Web Token)作为权限令牌,客户端请求后台接口的时候需要携带token参数,后端接口在接收时对token参数进行解析验证,判断token是否有效.</p><p>但是我们的接口有很多,如果每个接口都要写验证功能,将会十分的麻烦.</p><p>springboot中提供了<code>HandlerMethodArgumentResolver</code>参数解析器,配合自定义注解可以大大减少代码冗余.</p><h1 id="2-快速开始"><a href="#2-快速开始" class="headerlink" title="2. 快速开始"></a>2. 快速开始</h1><h2 id="2-1-自定义注解"><a href="#2-1-自定义注解" class="headerlink" title="2.1 自定义注解"></a>2.1 自定义注解</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.PARAMETER&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> NeedToken &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">require</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-2-token对应的pojo类"><a href="#2-2-token对应的pojo类" class="headerlink" title="2.2 token对应的pojo类"></a>2.2 token对应的pojo类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenParam</span> &#123;<br>    <span class="hljs-keyword">private</span> String userName;<br>    <span class="hljs-keyword">private</span> String userId;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-3-自定义参数解析器"><a href="#2-3-自定义参数解析器" class="headerlink" title="2.3 自定义参数解析器"></a>2.3 自定义参数解析器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TokenResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter methodParameter)</span> &#123;<br>        <span class="hljs-keyword">return</span> methodParameter.hasParameterAnnotation(NeedToken.class);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter methodParameter, ModelAndViewContainer modelAndViewContainer, NativeWebRequest nativeWebRequest, WebDataBinderFactory webDataBinderFactory)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// 获取请求头token的内容</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> nativeWebRequest.getHeader(<span class="hljs-string">&quot;token&quot;</span>);<br>        <span class="hljs-comment">// 解析token</span><br><span class="hljs-comment">//        Claims claims = decodeToken(token);</span><br><span class="hljs-comment">//        if (ObjectUtils.isEmpty(claims)) &#123;</span><br><span class="hljs-comment">//            throw new JwtException(&quot;令牌错误或失效&quot;);</span><br><span class="hljs-comment">//        &#125;</span><br>        <span class="hljs-comment">// 用户信息</span><br><span class="hljs-comment">//        String info = claims.getSubject();</span><br>        <span class="hljs-type">NeedToken</span> <span class="hljs-variable">needToken</span> <span class="hljs-operator">=</span> methodParameter.getParameterAnnotation(NeedToken.class);<br>        <span class="hljs-type">TokenParam</span> <span class="hljs-variable">tokenParam</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TokenParam</span>();<br>        <span class="hljs-comment">//</span><br>        <span class="hljs-keyword">if</span> (needToken.require()) &#123;<br>            tokenParam.setUserId(<span class="hljs-string">&quot;1&quot;</span>);<br>            tokenParam.setUserName(<span class="hljs-string">&quot;tgk&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> tokenParam;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 解析token</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> token</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Claims <span class="hljs-title function_">decodeToken</span><span class="hljs-params">(String token)</span> &#123;<br>        <span class="hljs-keyword">if</span> (ObjectUtils.isEmpty(token)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> Jwts.parser().setSigningKey(<span class="hljs-string">&quot;token&quot;</span>).parseClaimsJws(token).getBody();<br>            <span class="hljs-keyword">return</span> claims;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-4-webmvc配置添加参数解析器"><a href="#2-4-webmvc配置添加参数解析器" class="headerlink" title="2.4 webmvc配置添加参数解析器"></a>2.4 webmvc配置添加参数解析器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> TokenResolver tokenResolver;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addArgumentResolvers</span><span class="hljs-params">(List&lt;HandlerMethodArgumentResolver&gt; argumentResolvers)</span> &#123;<br>        argumentResolvers.add(tokenResolver);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>springboot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>springboot</tag>
      
      <tag>token</tag>
      
      <tag>jwt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>软考中级-程序设计师</title>
    <link href="/2022/08/22/%E8%BD%AF%E8%80%83%E4%B8%AD%E7%BA%A7-%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%B8%88/"/>
    <url>/2022/08/22/%E8%BD%AF%E8%80%83%E4%B8%AD%E7%BA%A7-%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%B8%88/</url>
    
    <content type="html"><![CDATA[<p>计算机软考程序设计师学习笔记</p><span id="more"></span><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><h2 id="考试时间"><a href="#考试时间" class="headerlink" title="考试时间"></a>考试时间</h2><blockquote><p> 上午</p></blockquote><p>计算机与软件工程 150分钟 笔试 选择题</p><blockquote><p>下午</p></blockquote><p>软件设计150分钟  笔试 问答题</p><p>数据流图</p><p>数据库</p><p>UML</p><p>算法-一般用c语言</p><p>面向对象编程-以设计模式为背景 c++ java二选一</p><h2 id="分数占比"><a href="#分数占比" class="headerlink" title="分数占比"></a>分数占比</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/imgimage-20220813231108042.png" alt="image-20220813231108042"></p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220813231320703.png" alt="image-20220813231320703"></p><h1 id="1-计算机组成原理与体系结构"><a href="#1-计算机组成原理与体系结构" class="headerlink" title="1. 计算机组成原理与体系结构"></a>1. 计算机组成原理与体系结构</h1><h2 id="1-1-前言"><a href="#1-1-前言" class="headerlink" title="1.1 前言"></a>1.1 前言</h2><blockquote><p> 分值</p></blockquote><p>6分</p><blockquote><p>内容</p></blockquote><ul><li>数据的表示</li><li>计算机结构</li><li>Flynn分类法</li><li>CISC与RISC</li><li>流水线技术</li><li>存储系统</li><li>总线系统</li><li>可靠性</li><li>检验码</li></ul><h2 id="1-2-数据的表示-进制转换"><a href="#1-2-数据的表示-进制转换" class="headerlink" title="1.2 数据的表示(进制转换)"></a>1.2 数据的表示(进制转换)</h2><h3 id="1-2-1-各种进制转10进制"><a href="#1-2-1-各种进制转10进制" class="headerlink" title="1.2.1 各种进制转10进制"></a>1.2.1 各种进制转10进制</h3><p>如图所示</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220814171106987.png" alt="image-20220814171106987"></p><h3 id="1-2-2-十进制转其他进制"><a href="#1-2-2-十进制转其他进制" class="headerlink" title="1.2.2 十进制转其他进制"></a>1.2.2 十进制转其他进制</h3><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220814171425987.png" alt="image-20220814171425987"></p><h3 id="1-2-3-二进制-转-八进制和十六进制"><a href="#1-2-3-二进制-转-八进制和十六进制" class="headerlink" title="1.2.3 二进制 转 八进制和十六进制"></a>1.2.3 二进制 转 八进制和十六进制</h3><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220814172127598.png" alt="image-20220814172127598"></p><blockquote><p> 十六进制 双位数的表示</p></blockquote><ul><li>10 A</li><li>11 B</li><li>12 C</li><li>13 D</li><li>14 E</li><li>15 F</li></ul><h2 id="1-3-数据表示-原码反码补码移码"><a href="#1-3-数据表示-原码反码补码移码" class="headerlink" title="1.3 数据表示(原码反码补码移码)"></a>1.3 数据表示(原码反码补码移码)</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220814172635450.png" alt="image-20220814172635450"></p><h3 id="1-3-1-概念"><a href="#1-3-1-概念" class="headerlink" title="1.3.1 概念"></a>1.3.1 概念</h3><blockquote><p>原码</p></blockquote><p>一个字节8个bit,所以至少有8个数字</p><ul><li><strong>正数</strong></li></ul><p>开头是0</p><ul><li><strong>负数</strong></li></ul><p>开头是1</p><blockquote><p>反码</p></blockquote><ul><li><strong>正数</strong></li></ul><p>和原码一样</p><ul><li><strong>负数</strong></li></ul><p>除了第一个符号位,其它相对于原码取反</p><blockquote><p>补码</p></blockquote><ul><li><strong>正数</strong></li></ul><p>和原码一样</p><ul><li><strong>负数</strong></li></ul><p>比反码+1</p><blockquote><p>移码</p></blockquote><p>用处:作为浮点运算中的解码</p><ul><li><strong>正数</strong></li></ul><p>原码的首位取反</p><ul><li><strong>负数</strong></li></ul><p>补码的首位取反</p><hr><h3 id="1-3-2表示范围"><a href="#1-3-2表示范围" class="headerlink" title="1.3.2表示范围"></a>1.3.2表示范围</h3><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220814224640572.png" alt="image-20220814224640572"></p><hr><h2 id="1-4-浮点数运算"><a href="#1-4-浮点数运算" class="headerlink" title="1.4 浮点数运算"></a>1.4 浮点数运算</h2><h3 id="1-4-1-概念"><a href="#1-4-1-概念" class="headerlink" title="1.4.1 概念"></a>1.4.1 概念</h3><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220814225138122.png" alt="image-20220814225138122"></p><ul><li><p><strong>对阶</strong>–低的往高的对   10^2^变10^3^</p></li><li><p><strong>尾数计算</strong>–相加</p></li><li><p><strong>结果格式化</strong>  变成x.xxx</p></li></ul><hr><h2 id="1-5-计算机结构"><a href="#1-5-计算机结构" class="headerlink" title="1.5 计算机结构"></a>1.5 计算机结构</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220814225552143.png" alt="image-20220814225552143"></p><p>这里的主机只包含CPU和内存</p><hr><h2 id="1-6-计算机体系结构分类-Flynn"><a href="#1-6-计算机体系结构分类-Flynn" class="headerlink" title="1.6 计算机体系结构分类-Flynn"></a>1.6 计算机体系结构分类-Flynn</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220814230211871.png" alt="image-20220814230211871"></p><hr><h2 id="1-7-CISC和RISC"><a href="#1-7-CISC和RISC" class="headerlink" title="1.7 CISC和RISC"></a>1.7 CISC和RISC</h2><p><strong>针对特征考选择题</strong></p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220814231124623.png" alt="image-20220814231124623"></p><blockquote><p>CISC(复杂)</p></blockquote><blockquote><p>RISC(精简)</p></blockquote><hr><h2 id="1-8-流水线概念"><a href="#1-8-流水线概念" class="headerlink" title="1.8 流水线概念"></a>1.8 流水线概念</h2><p>必考-考计算的问题</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220820184336040.png" alt="image-20220820184336040"></p><p>取指,分析,执行用的是不同的部件,每个部件做专门的事情,使用流水线可以让各个部件不用等待上一个指令</p><h2 id="1-9-流水线计算"><a href="#1-9-流水线计算" class="headerlink" title="1.9 流水线计算"></a>1.9 流水线计算</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220820184815083.png" alt="image-20220820184815083"></p><p>**周期:**取指,分析,执行中用时最长的一个步骤所用的时间</p><p>**理论公式来源:**第一个流程走完,然后再进入流水线</p><p>**实际公式来源:**把每个步骤的执行时间都当做一个周期时间来计算,这里取指,分析,执行一共有三步,所以当做3个周期</p><p>总共就是102个周期</p><p>选答案的时候首先计算理论公式,其次使用实践公式</p><hr><h2 id="1-10-流水线吞吐率计算"><a href="#1-10-流水线吞吐率计算" class="headerlink" title="1.10 流水线吞吐率计算"></a>1.10 流水线吞吐率计算</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220820192204457.png" alt="image-20220820192204457"></p><p>单位时间内,流水线能完成的任务数量</p><p>100条指令,执行203毫秒,吞吐率 &#x3D; 100&#x2F;203</p><p>**最大吞吐率:**1&#x2F;周期</p><hr><h2 id="1-11-流水线的加速比"><a href="#1-11-流水线的加速比" class="headerlink" title="1.11 流水线的加速比"></a>1.11 流水线的加速比</h2><p>加速比 &#x3D; 不使用流水线的时间&#x2F;使用流水线的时间</p><hr><h2 id="1-12-流水线的效率"><a href="#1-12-流水线的效率" class="headerlink" title="1.12 流水线的效率"></a>1.12 流水线的效率</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220821223216663.png" alt="image-20220821223216663"></p><p>效率 &#x3D; 阴影部分除以全部部分</p><hr><h2 id="1-13-层次化存储结构"><a href="#1-13-层次化存储结构" class="headerlink" title="1.13 层次化存储结构"></a>1.13 层次化存储结构</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220821223732567.png" alt="image-20220821223732567"></p><h2 id="1-14-cache的基本概念"><a href="#1-14-cache的基本概念" class="headerlink" title="1.14 cache的基本概念"></a>1.14 cache的基本概念</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220821224204359.png" alt="image-20220821224204359"></p><p>用上cache 的平均周期 &#x3D; 命中率 乘上 cache周期+未命中率 乘上 内存周期</p><hr><h2 id="1-15-局部性原理"><a href="#1-15-局部性原理" class="headerlink" title="1.15 局部性原理"></a>1.15 局部性原理</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220821224822213.png" alt="image-20220821224822213"></p><p>时间局部性&#x3D;刚访问过的数据,存入cache,再次访问从cache取</p><p>空间局部性&#x3D;数组,访问了i[0],接下来访问i[1]很快</p><hr><h2 id="1-16-随机存储器和只读存储器"><a href="#1-16-随机存储器和只读存储器" class="headerlink" title="1.16 随机存储器和只读存储器"></a>1.16 随机存储器和只读存储器</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220821225048926.png" alt="image-20220821225048926"></p><blockquote><p>主存的编址</p></blockquote><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220821225942722.png" alt="image-20220821225942722"></p><h2 id="1-17-磁盘工作原理"><a href="#1-17-磁盘工作原理" class="headerlink" title="1.17 磁盘工作原理"></a>1.17 磁盘工作原理</h2><blockquote><p>磁盘结构与参数</p></blockquote><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220821232506844.png" alt="image-20220821232506844"></p><p>内容存储在磁道上,磁头先移到磁道上,然后旋转磁盘,转到相应的扇区,然后读取出信息</p><p>**等待时间:**磁盘转一圈的时间</p><blockquote><p>试题</p></blockquote><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/github-image/img/image-20220821233220278.png" alt="image-20220821233220278"></p><h2 id="1-18-计算机总线"><a href="#1-18-计算机总线" class="headerlink" title="1.18 计算机总线"></a>1.18 计算机总线</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220826223534565.png" alt="image-20220826223534565"></p><ul><li>内部总线</li><li>系统总线<ul><li>数据总线   32位系统就是数据总线有32个bit位</li><li>地址总线   32位系统就是地址有2^32^个,也就是4g</li><li>控制总线</li></ul></li><li>外部总线</li></ul><p>经常考察选择题</p><hr><h2 id="1-19串联系统和并联系统可靠性分析"><a href="#1-19串联系统和并联系统可靠性分析" class="headerlink" title="1.19串联系统和并联系统可靠性分析"></a>1.19串联系统和并联系统可靠性分析</h2><blockquote><p>串联</p></blockquote><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220826224211258.png" alt="image-20220826224211258"></p><p>可靠性&#x3D; 每个可靠度相乘</p><blockquote><p>并联</p></blockquote><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220826224913992.png" alt="image-20220826224913992"></p><p>失效率 &#x3D;1- ( 每个失效率相乘)</p><p><strong>模冗余系统与混合系统</strong></p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220826225204348.png" alt="image-20220826225204348"></p><blockquote><p>练习题</p></blockquote><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220826225318377.png" alt="image-20220826225318377"></p><p>求可靠度</p><p>总体是串联,右边两个是并联,先分层三块计算,最后再计算总体串联的</p><hr><h2 id="1-20-校验码的概念"><a href="#1-20-校验码的概念" class="headerlink" title="1.20 校验码的概念"></a>1.20 校验码的概念</h2><h3 id="查错控制-CRC与海明校验码"><a href="#查错控制-CRC与海明校验码" class="headerlink" title="查错控制-CRC与海明校验码"></a>查错控制-CRC与海明校验码</h3><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220826225436069.png" alt="image-20220826225436069"></p><p>码距:变化几个位才能从一个合法码字变成另一个合法码字</p><h3 id="校验码-循环校验码CRC"><a href="#校验码-循环校验码CRC" class="headerlink" title="校验码-循环校验码CRC"></a>校验码-循环校验码CRC</h3><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220826230606575.png" alt="image-20220826230606575"></p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220826231417124.png" alt="image-20220826231417124"></p><h3 id="海明校验码"><a href="#海明校验码" class="headerlink" title="海明校验码"></a>海明校验码</h3><p>考试难点,频率很高</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220826231530418.png" alt="image-20220826231530418"></p><hr><h1 id="2-操作系统原理"><a href="#2-操作系统原理" class="headerlink" title="2. 操作系统原理"></a>2. 操作系统原理</h1><p>分值占比:5-7分</p><h2 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220826232151517.png" alt="image-20220826232151517"></p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220826232230303.png" alt="image-20220826232230303"></p><h2 id="2-2-进程的状态"><a href="#2-2-进程的状态" class="headerlink" title="2.2 进程的状态"></a>2.2 进程的状态</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220826232331975.png" alt="image-20220826232331975"></p><hr><h2 id="2-3-前趋图"><a href="#2-3-前趋图" class="headerlink" title="2.3 前趋图"></a>2.3 前趋图</h2><p>经常考,和pv操作一起考</p><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220826232450469.png" alt="image-20220826232450469"></p><p>用前趋图可以表示事件的先后关系</p><hr><h2 id="2-4-进程的同步与互斥"><a href="#2-4-进程的同步与互斥" class="headerlink" title="2.4 进程的同步与互斥"></a>2.4 进程的同步与互斥</h2><p><img src="https://image-1306887402.cos.ap-nanjing.myqcloud.com/img/image-20220826232717862.png" alt="image-20220826232717862"></p><p>互斥:同一个资源在同一时间只能被一个进程访问</p>]]></content>
    
    
    <categories>
      
      <category>软考</category>
      
    </categories>
    
    
    <tags>
      
      <tag>软考</tag>
      
      <tag>计算机</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
